<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Utsaav â€” Event Organizer Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #0a0a0f;
  --surface: #11111a;
  --surface2: #1a1a28;
  --surface3: #22223a;
  --border: rgba(255,255,255,0.07);
  --border2: rgba(255,255,255,0.12);
  --accent: #c9a84c;
  --accent2: #7b5ea7;
  --accent3: #4c9ac9;
  --text: #f0ede8;
  --muted: #8a8698;
  --danger: #e05c5c;
  --success: #5cb85c;
  --glow: rgba(201,168,76,0.15);
  --glow2: rgba(123,94,167,0.15);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background:
    radial-gradient(ellipse 80% 60% at 20% -10%, rgba(123,94,167,0.18) 0%, transparent 60%),
    radial-gradient(ellipse 60% 50% at 80% 110%, rgba(201,168,76,0.12) 0%, transparent 55%);
  pointer-events: none;
  z-index: 0;
}

/* ====== HEADER ====== */
header {
  position: sticky;
  top: 0;
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 40px;
  border-bottom: 1px solid var(--border);
  backdrop-filter: blur(20px);
  background: rgba(10,10,15,0.8);
}
.logo { display: flex; align-items: center; gap: 10px; cursor: pointer; }
.logo-icon {
  width: 34px; height: 34px;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  border-radius: 9px;
  display: flex; align-items: center; justify-content: center;
  font-size: 16px;
}
.logo-text {
  font-family: 'Playfair Display', serif;
  font-size: 20px; font-weight: 700;
}
.logo-text span { color: var(--accent); }

.header-right { display: flex; align-items: center; gap: 10px; }
.user-chip {
  display: flex; align-items: center; gap: 8px;
  padding: 7px 14px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 20px;
  font-size: 13px;
  color: var(--muted);
}
.user-chip .dot {
  width: 7px; height: 7px;
  background: var(--success);
  border-radius: 50%;
}
.icon-btn {
  width: 36px; height: 36px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  font-size: 16px;
  transition: all 0.2s;
  color: var(--muted);
}
.icon-btn:hover { border-color: var(--accent); color: var(--accent); }

/* ====== PAGES ====== */
.page {
  position: relative;
  z-index: 5;
  min-height: calc(100vh - 67px);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
}
.hidden { display: none !important; }
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}
.fade-in { animation: fadeUp 0.45s ease forwards; }

/* ====== GLASS CARD ====== */
.glass-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 32px;
  box-shadow: 0 24px 64px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05);
}

/* ====== FORM ELEMENTS ====== */
.form-group { margin-bottom: 16px; }
.form-group label {
  display: block;
  font-size: 11px; font-weight: 600;
  letter-spacing: 1.4px;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 6px;
}
.form-group input,
.form-group textarea,
.form-group select {
  width: 100%;
  padding: 12px 15px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 10px;
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  font-size: 14px;
  transition: all 0.2s;
  outline: none;
  resize: vertical;
}
.form-group select option { background: var(--surface2); }
.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--glow);
}
.form-group input::placeholder,
.form-group textarea::placeholder { color: var(--muted); }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }

/* ====== BUTTONS ====== */
.btn-primary {
  display: inline-flex; align-items: center; justify-content: center; gap: 7px;
  width: 100%; padding: 13px;
  background: linear-gradient(135deg, var(--accent), #b8912f);
  color: #0a0a0f;
  border: none; border-radius: 10px;
  font-family: 'DM Sans', sans-serif;
  font-size: 15px; font-weight: 600;
  cursor: pointer; letter-spacing: 0.2px;
  transition: all 0.2s;
}
.btn-primary:hover { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(201,168,76,0.3); }
.btn-primary:active { transform: translateY(0); }

.btn-secondary {
  display: inline-flex; align-items: center; justify-content: center; gap: 7px;
  padding: 11px 20px;
  background: var(--surface2);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 10px;
  font-family: 'DM Sans', sans-serif;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s;
}
.btn-secondary:hover { border-color: var(--accent); color: var(--accent); }

.btn-purple {
  display: inline-flex; align-items: center; justify-content: center; gap: 7px;
  padding: 11px 20px;
  background: rgba(123,94,167,0.15);
  color: #b89fd4;
  border: 1px solid rgba(123,94,167,0.3);
  border-radius: 10px;
  font-family: 'DM Sans', sans-serif;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s;
}
.btn-purple:hover { background: rgba(123,94,167,0.25); border-color: var(--accent2); }

.btn-danger {
  display: inline-flex; align-items: center; justify-content: center; gap: 5px;
  padding: 8px 14px;
  background: transparent; color: var(--danger);
  border: 1px solid rgba(224,92,92,0.3);
  border-radius: 8px;
  font-family: 'DM Sans', sans-serif;
  font-size: 13px; cursor: pointer;
  transition: all 0.2s;
}
.btn-danger:hover { background: rgba(224,92,92,0.1); border-color: var(--danger); }

.btn-sm {
  padding: 7px 14px !important;
  font-size: 13px !important;
  width: auto !important;
}

/* ====== AUTH ====== */
.auth-wrap { width: 100%; max-width: 440px; }
.auth-head { margin-bottom: 28px; }
.auth-head h1 {
  font-family: 'Playfair Display', serif;
  font-size: 38px; font-weight: 900; line-height: 1.1; margin-bottom: 8px;
}
.auth-head h1 em { font-style: italic; color: var(--accent); }
.auth-head p { color: var(--muted); font-size: 14px; }
.showpass-label {
  display: flex; align-items: center; gap: 8px;
  font-size: 13px; color: var(--muted); cursor: pointer; margin-bottom: 14px;
}
.showpass-label input { width: auto; margin: 0; }
.error { color: #e07070; font-size: 12px; margin-bottom: 10px; min-height: 18px; }
.divider { height: 1px; background: var(--border); margin: 20px 0; }
.switch-link { text-align: center; font-size: 13px; color: var(--muted); }
.switch-link a { color: var(--accent); cursor: pointer; font-weight: 600; }
.switch-link a:hover { text-decoration: underline; }

/* ====== HOME ====== */
.home-wrap { width: 100%; max-width: 600px; text-align: center; }
.home-title {
  font-family: 'Playfair Display', serif;
  font-size: 52px; font-weight: 900; line-height: 1.05; margin-bottom: 12px;
}
.home-title em { font-style: italic; color: var(--accent); }
.home-sub { color: var(--muted); font-size: 15px; margin-bottom: 42px; font-weight: 300; }
.option-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 18px; }
.option-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 18px;
  padding: 30px 20px;
  cursor: pointer;
  transition: all 0.25s;
  position: relative; overflow: hidden;
}
.option-card::before {
  content: ''; position: absolute; inset: 0; opacity: 0; transition: opacity 0.25s;
}
.option-card.o-opt::before { background: radial-gradient(ellipse at 50% 0%, rgba(201,168,76,0.12) 0%, transparent 70%); }
.option-card.c-opt::before { background: radial-gradient(ellipse at 50% 0%, rgba(123,94,167,0.15) 0%, transparent 70%); }
.option-card:hover { transform: translateY(-3px); }
.option-card:hover::before { opacity: 1; }
.option-card.o-opt:hover { border-color: var(--accent); box-shadow: 0 12px 32px rgba(201,168,76,0.12); }
.option-card.c-opt:hover { border-color: var(--accent2); box-shadow: 0 12px 32px rgba(123,94,167,0.12); }
.opt-icon { font-size: 38px; margin-bottom: 12px; display: block; }
.opt-title { font-family: 'Playfair Display', serif; font-size: 18px; font-weight: 700; margin-bottom: 5px; }
.opt-desc { font-size: 12px; color: var(--muted); }

/* ===== CATEGORY CHIPS ===== */
.cat-chip {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 8px 14px; border-radius: 20px;
  background: var(--surface2); border: 1.5px solid var(--border);
  font-size: 13px; cursor: pointer; transition: all 0.2s;
  user-select: none; color: var(--text);
}
.cat-chip input[type=checkbox] { display: none; }
.cat-chip.selected {
  background: rgba(201,168,76,0.15);
  border-color: var(--accent);
  color: var(--accent);
  font-weight: 600;
}

/* ====== BADGE ====== */
.badge {
  display: inline-block; padding: 4px 12px;
  border-radius: 20px; font-size: 11px;
  letter-spacing: 0.5px; font-weight: 600;
  background: rgba(201,168,76,0.1);
  color: var(--accent);
  border: 1px solid rgba(201,168,76,0.2);
  margin-bottom: 14px;
}
.badge-purple {
  background: rgba(123,94,167,0.1);
  color: #b89fd4;
  border-color: rgba(123,94,167,0.25);
}
.badge-blue {
  background: rgba(76,154,201,0.1);
  color: #7fc3e8;
  border-color: rgba(76,154,201,0.25);
}
.badge-green {
  background: rgba(92,184,92,0.1);
  color: #7ed37e;
  border-color: rgba(92,184,92,0.25);
}

/* ====== PANEL LAYOUT ====== */
.panel-wrap { width: 100%; max-width: 560px; }
.panel-header { display: flex; align-items: center; gap: 14px; margin-bottom: 26px; }
.panel-back {
  width: 38px; height: 38px; flex-shrink: 0;
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 10px; display: flex; align-items: center; justify-content: center;
  cursor: pointer; transition: all 0.2s; font-size: 16px;
}
.panel-back:hover { border-color: var(--accent); color: var(--accent); }
.panel-title { font-family: 'Playfair Display', serif; font-size: 26px; font-weight: 900; }
.panel-title span { color: var(--accent); }

/* ====== TABS ====== */
.tabs {
  display: flex; gap: 4px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 4px;
  margin-bottom: 26px;
}
.tab {
  flex: 1; padding: 9px 14px;
  text-align: center; font-size: 13px; font-weight: 500;
  border-radius: 9px; cursor: pointer;
  transition: all 0.2s; color: var(--muted);
  border: none; background: transparent; font-family: 'DM Sans', sans-serif;
}
.tab.active { background: var(--surface); color: var(--text); box-shadow: 0 2px 8px rgba(0,0,0,0.3); }

/* ====== ORGANIZER DASHBOARD ====== */
.dash-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 12px; margin-bottom: 24px; }
.stat-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 14px; padding: 18px 16px;
  text-align: center; transition: all 0.2s;
}
.stat-card:hover { border-color: var(--border2); transform: translateY(-2px); }
.stat-num {
  font-family: 'Playfair Display', serif;
  font-size: 32px; font-weight: 900; color: var(--accent);
  line-height: 1;
}
.stat-label { font-size: 11px; color: var(--muted); margin-top: 5px; letter-spacing: 0.5px; text-transform: uppercase; }

/* ====== CUSTOMER VIEW ====== */
.customer-wrap { width: 100%; max-width: 900px; }
.search-sort-row { display: flex; gap: 12px; margin-bottom: 24px; align-items: center; }
.search-bar { position: relative; flex: 1; }
.search-bar input {
  width: 100%; padding: 12px 15px 12px 44px;
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 12px; color: var(--text);
  font-family: 'DM Sans', sans-serif; font-size: 14px;
  outline: none; transition: all 0.2s;
}
.search-bar input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--glow); }
.search-bar input::placeholder { color: var(--muted); }
.search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--muted); font-size: 16px; pointer-events: none; }
.sort-select {
  padding: 12px 15px;
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 12px; color: var(--text);
  font-family: 'DM Sans', sans-serif; font-size: 13px;
  outline: none; cursor: pointer; transition: all 0.2s;
}
.sort-select:focus { border-color: var(--accent); }

/* CATEGORY PILLS */
.cat-pills { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 22px; }
.cat-pill {
  padding: 6px 14px; border-radius: 20px;
  font-size: 12px; font-weight: 500; cursor: pointer;
  border: 1px solid var(--border); color: var(--muted);
  background: var(--surface); transition: all 0.18s;
}
.cat-pill:hover { border-color: var(--border2); color: var(--text); }
.cat-pill.active { background: var(--accent); color: #0a0a0f; border-color: var(--accent); font-weight: 600; }

/* ====== ORG CARDS ====== */
.org-grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap: 16px; }
.org-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 18px; overflow: hidden;
  transition: all 0.25s; cursor: pointer; position: relative;
}
.org-card:hover { transform: translateY(-4px); border-color: rgba(255,255,255,0.12); box-shadow: 0 16px 40px rgba(0,0,0,0.4); }
.org-img-wrap { aspect-ratio: 4/3; overflow: hidden; background: var(--surface2); position: relative; }
.org-img-wrap img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s; }
.org-card:hover .org-img-wrap img { transform: scale(1.06); }
.cat-tag {
  position: absolute; bottom: 10px; left: 10px;
  padding: 4px 10px; border-radius: 20px;
  font-size: 11px; font-weight: 600;
  backdrop-filter: blur(8px);
  background: rgba(10,10,15,0.75);
  color: var(--accent); border: 1px solid rgba(201,168,76,0.3);
}
.org-body { padding: 16px; }
.org-name { font-family: 'Playfair Display', serif; font-size: 17px; font-weight: 700; margin-bottom: 5px; }
.org-meta { font-size: 12px; color: var(--muted); margin-bottom: 3px; display: flex; align-items: center; gap: 5px; }
.stars { color: var(--accent); font-size: 13px; letter-spacing: 1px; }
.stars-count { font-size: 11px; color: var(--muted); }
.org-footer {
  padding: 12px 16px; border-top: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
}

/* ====== MODAL ====== */
.modal-overlay {
  position: fixed; inset: 0; z-index: 200;
  background: rgba(0,0,0,0.75); backdrop-filter: blur(8px);
  display: flex; align-items: center; justify-content: center;
  padding: 20px;
  animation: fadeIn 0.2s ease;
}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.modal {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 22px; width: 100%; max-width: 560px;
  max-height: 90vh; overflow-y: auto;
  box-shadow: 0 32px 80px rgba(0,0,0,0.6);
  animation: modalPop 0.3s cubic-bezier(0.16,1,0.3,1);
}
@keyframes modalPop {
  from { opacity: 0; transform: scale(0.92) translateY(20px); }
  to   { opacity: 1; transform: scale(1) translateY(0); }
}
.modal-img { width: 100%; height: 240px; object-fit: cover; border-radius: 18px 18px 0 0; }
.modal-body { padding: 28px; }
.modal-name { font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 900; margin-bottom: 4px; }
.modal-close {
  position: absolute; top: 16px; right: 16px;
  width: 32px; height: 32px;
  background: rgba(0,0,0,0.5); backdrop-filter: blur(8px);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 50%; display: flex; align-items: center; justify-content: center;
  cursor: pointer; font-size: 14px; transition: all 0.2s;
  color: #fff;
}
.modal-close:hover { background: var(--danger); border-color: var(--danger); }
.modal-img-wrap { position: relative; }
.info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 18px 0; }
.info-item {
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 12px; padding: 14px;
}
.info-item-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); margin-bottom: 4px; }
.info-item-value { font-size: 14px; font-weight: 500; word-break: break-all; }
.modal-actions { display: flex; gap: 10px; margin-top: 20px; }
.modal-actions .btn-primary { flex: 1; }
.modal-actions .btn-secondary { flex: 1; }

/* REVIEW SECTION */
.reviews-section { margin-top: 22px; }
.reviews-section h4 { font-family: 'Playfair Display', serif; font-size: 16px; margin-bottom: 14px; }
.review-card {
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 12px; padding: 14px; margin-bottom: 10px;
}
.review-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 7px; }
.review-author { font-size: 13px; font-weight: 600; }
.review-date { font-size: 11px; color: var(--muted); }
.review-text { font-size: 13px; color: var(--muted); line-height: 1.5; }
.review-form { margin-top: 14px; }
.star-picker { display: flex; gap: 5px; margin-bottom: 10px; font-size: 22px; cursor: pointer; }
.star-picker span { opacity: 0.3; transition: opacity 0.15s; }
.star-picker span.lit { opacity: 1; color: var(--accent); }

/* ENQUIRY FORM */
.enquiry-form { margin-top: 20px; border-top: 1px solid var(--border); padding-top: 20px; }
.enquiry-form h4 { font-family: 'Playfair Display', serif; font-size: 16px; margin-bottom: 14px; }

/* ====== EVENTS ====== */
.events-grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(260px,1fr)); gap: 16px; }
.event-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 16px; padding: 20px;
  transition: all 0.2s; cursor: pointer;
}
.event-card:hover { transform: translateY(-3px); border-color: var(--border2); box-shadow: 0 12px 32px rgba(0,0,0,0.3); }
.event-date-badge {
  display: inline-flex; flex-direction: column; align-items: center;
  width: 52px; background: var(--surface2);
  border: 1px solid var(--border); border-radius: 10px;
  padding: 6px 8px; margin-bottom: 14px;
}
.event-date-badge .month { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--accent); font-weight: 600; }
.event-date-badge .day { font-size: 22px; font-weight: 900; font-family: 'Playfair Display', serif; line-height: 1; }
.event-title { font-family: 'Playfair Display', serif; font-size: 17px; font-weight: 700; margin-bottom: 6px; }
.event-meta { font-size: 12px; color: var(--muted); margin-bottom: 3px; display: flex; align-items: center; gap: 5px; }
.event-price { font-size: 18px; font-weight: 700; color: var(--accent); margin-top: 12px; }
.event-price span { font-size: 12px; color: var(--muted); font-weight: 400; }

/* MY ENQUIRIES */
.enquiry-item {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 14px; padding: 18px; margin-bottom: 12px;
}
.enquiry-to { font-size: 13px; color: var(--muted); margin-bottom: 5px; }
.enquiry-msg { font-size: 14px; line-height: 1.5; }
.enquiry-status {
  display: inline-block; margin-top: 10px;
  padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: 600;
  background: rgba(201,168,76,0.1); color: var(--accent); border: 1px solid rgba(201,168,76,0.2);
}

/* IMAGE PREVIEW */
.img-preview {
  width: 100%; height: 160px; border-radius: 10px; object-fit: cover;
  border: 1px solid var(--border); margin-top: 8px; display: none;
}

/* ====== LOADING ====== */
.loading-dots { display: flex; gap: 6px; justify-content: center; padding: 40px; grid-column: 1/-1; }
.loading-dots span {
  width: 9px; height: 9px; border-radius: 50%; background: var(--accent);
  animation: bounce 1.2s ease-in-out infinite;
}
.loading-dots span:nth-child(2) { animation-delay: 0.2s; }
.loading-dots span:nth-child(3) { animation-delay: 0.4s; }
@keyframes bounce {
  0%,80%,100% { transform: scale(0.4); opacity: 0.3; }
  40% { transform: scale(1); opacity: 1; }
}

/* ====== EMPTY ====== */
.empty-state {
  text-align: center; padding: 60px 20px;
  color: var(--muted); grid-column: 1/-1;
}
.empty-icon { font-size: 48px; opacity: 0.3; display: block; margin-bottom: 14px; }
.empty-state p { font-size: 15px; }

/* ====== TOAST ====== */
.toast {
  position: fixed; bottom: 28px; right: 28px;
  padding: 13px 20px; border-radius: 12px;
  font-size: 14px; z-index: 9999;
  box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  transform: translateY(70px); opacity: 0;
  transition: all 0.3s cubic-bezier(0.16,1,0.3,1);
  max-width: 320px;
}
.toast.show { transform: translateY(0); opacity: 1; }
.toast.success { background: var(--surface); border: 1px solid var(--accent); color: var(--text); }
.toast.error-t { background: var(--surface); border: 1px solid var(--danger); color: var(--text); }

/* ====== EMAIL VERIFY SCREEN ====== */
.verify-wrap { width: 100%; max-width: 440px; text-align: center; }
.verify-icon { font-size: 64px; margin-bottom: 20px; display: block; animation: float 3s ease-in-out infinite; }
@keyframes float {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}
.verify-title { font-family: 'Playfair Display', serif; font-size: 32px; font-weight: 900; margin-bottom: 10px; }
.verify-title em { font-style: italic; color: var(--accent); }
.verify-sub { color: var(--muted); font-size: 14px; line-height: 1.7; margin-bottom: 28px; }
.verify-email-badge {
  display: inline-block; padding: 8px 18px;
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 20px; font-size: 14px; font-weight: 600;
  color: var(--accent); margin-bottom: 28px;
}
.verify-steps { text-align: left; margin-bottom: 28px; }
.verify-step {
  display: flex; align-items: flex-start; gap: 12px;
  padding: 12px 0; border-bottom: 1px solid var(--border);
}
.verify-step:last-child { border-bottom: none; }
.step-num {
  width: 26px; height: 26px; flex-shrink: 0;
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 50%; display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 700; color: var(--accent);
}
.step-text { font-size: 13px; color: var(--muted); line-height: 1.5; padding-top: 3px; }
.verify-btns { display: flex; flex-direction: column; gap: 10px; }
.resend-timer { font-size: 12px; color: var(--muted); margin-top: 8px; }

/* LIGHT MODE */
body.light {
  --bg: #f0ece4;
  --surface: #ffffff;
  --surface2: #f5f0e8;
  --surface3: #ede8df;
  --border: rgba(0,0,0,0.08);
  --border2: rgba(0,0,0,0.14);
  --text: #1a1a2e;
  --muted: #7a7590;
  --glow: rgba(201,168,76,0.12);
}
body.light::before { opacity: 0.5; }
body.light header { background: rgba(240,236,228,0.85); }

/* RESPONSIVE */
@media(max-width:640px){
  header { padding: 14px 18px; }
  .home-title { font-size: 32px; }
  .option-cards { grid-template-columns: 1fr; }
  .org-grid { grid-template-columns: 1fr !important; }
  .dash-grid { grid-template-columns: repeat(2,1fr); }
  .form-row { grid-template-columns: 1fr !important; }
  .search-sort-row { flex-wrap: wrap; }
  .info-grid { grid-template-columns: 1fr; }
  .modal-actions { flex-direction: column; }
  .tabs { overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; }
  .tab { display: inline-block; }
  .page { padding: 16px 12px !important; }
  .customer-wrap { width: 100% !important; padding: 0 !important; }
  .glass-card { padding: 16px !important; }
  .panel-header { margin-bottom: 16px; }
  .org-card { width: 100% !important; }
  .search-bar { width: 100% !important; }
  .sort-select { width: 100% !important; }
  .cat-pills { flex-wrap: wrap !important; overflow-x: auto; }

  /* Profile page mobile */
  #profilePage > div:last-child > div:first-child { display: block !important; }
  #profilePage [style*="grid-template-columns:1fr 320px"],
  #profilePage [style*="grid-template-columns: 1fr 320px"] { display: block !important; }
  #profilePage [style*="grid-template-columns:repeat(3,1fr)"] { grid-template-columns: repeat(2,1fr) !important; }
  #profilePage [style*="position:sticky"] { position: static !important; margin-top: 16px; }
  #profilePage [style*="height:300px"] { height: 220px !important; }
  #profilePage [style*="font-size:38px"] { font-size: 26px !important; }
  #profilePage [style*="max-width:940px"] { padding: 0 12px !important; }
}
</style>
</head>
<body>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- MODAL CONTAINER -->
<div id="modalContainer"></div>

<!-- ===== HEADER ===== -->
<header>
  <div class="logo" onclick="handleLogoClick()" style="cursor:pointer;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 520 160" height="44" width="143">
      <defs>
        <linearGradient id="iG" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#FF6B6B"/>
          <stop offset="35%" style="stop-color:#FF8E53"/>
          <stop offset="70%" style="stop-color:#FFC837"/>
          <stop offset="100%" style="stop-color:#FF6B9D"/>
        </linearGradient>
        <linearGradient id="tG" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" style="stop-color:#FF6B6B"/>
          <stop offset="50%" style="stop-color:#FFC837"/>
          <stop offset="100%" style="stop-color:#FF6B9D"/>
        </linearGradient>
        <filter id="hGlow"><feGaussianBlur stdDeviation="3" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
        <filter id="hShadow"><feDropShadow dx="0" dy="3" stdDeviation="5" flood-color="#FF6B6B" flood-opacity="0.25"/></filter>
        <filter id="hIG"><feGaussianBlur stdDeviation="4" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <circle cx="78" cy="80" r="58" fill="none" stroke="url(#iG)" stroke-width="1.5" opacity="0.3"/>
      <circle cx="78" cy="80" r="46" fill="#0a0a0f" filter="url(#hShadow)"/>
      <circle cx="78" cy="80" r="46" fill="url(#iG)" opacity="0.12"/>
      <circle cx="78" cy="80" r="44" fill="none" stroke="url(#iG)" stroke-width="1.5" opacity="0.9"/>
      <circle cx="78" cy="34" r="2.5" fill="url(#iG)" opacity="0.9"/>
      <circle cx="78" cy="126" r="2.5" fill="url(#iG)" opacity="0.9"/>
      <circle cx="32" cy="80" r="2.5" fill="url(#iG)" opacity="0.9"/>
      <circle cx="124" cy="80" r="2.5" fill="url(#iG)" opacity="0.9"/>
      <path d="M 55 52 L 55 88 Q 55 108 78 108 Q 101 108 101 88 L 101 52" fill="none" stroke="url(#iG)" stroke-width="7" stroke-linecap="round" filter="url(#hIG)"/>
      <g transform="translate(52,46)" filter="url(#hGlow)"><path d="M0,-6 L1.5,-1.5 L6,0 L1.5,1.5 L0,6 L-1.5,1.5 L-6,0 L-1.5,-1.5 Z" fill="#FFC837"/></g>
      <g transform="translate(104,46)" filter="url(#hGlow)"><path d="M0,-5 L1.2,-1.2 L5,0 L1.2,1.2 L0,5 L-1.2,1.2 L-5,0 L-1.2,-1.2 Z" fill="#FF6B9D"/></g>
      <g transform="translate(78,38)" filter="url(#hGlow)"><path d="M0,-4 L1,-1 L4,0 L1,1 L0,4 L-1,1 L-4,0 L-1,-1 Z" fill="#FF8E53" opacity="0.9"/></g>
      <text x="168" y="95" font-family="Georgia,'Times New Roman',serif" font-size="58" font-weight="700" letter-spacing="4" fill="url(#tG)" filter="url(#hShadow)">UTSAAV</text>
      <text x="170" y="118" font-family="Georgia,serif" font-size="12" letter-spacing="5" fill="#666">EVENT MANAGEMENT</text>
      <line x1="170" y1="126" x2="390" y2="126" stroke="url(#tG)" stroke-width="0.8" opacity="0.4"/>
    </svg>
  </div>
  <div class="header-right" id="headerRight">
    <div class="icon-btn" onclick="toggleDark()" title="Toggle theme">ğŸŒ™</div>
  </div>
</header>

<!-- ===== AUTH ===== -->
<div class="page" id="auth">
  <div class="auth-wrap fade-in">
    <div class="auth-head">
      <div class="badge">âœ¦ Utsaav â€” Event Management</div>
      <h1 id="authTitle">Welcome <em>Back.</em></h1>
      <p id="authSubtitle">Login to access your organizer hub.</p>
    </div>
    <div class="glass-card">
      <form id="authForm">
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="authEmail" placeholder="you@example.com" required>
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="authPass" placeholder="Minimum 6 characters" required>
        </div>
        <label class="showpass-label">
          <input type="checkbox" onclick="togglePass()"> Show password
        </label>
        <div class="error" id="errorMsg"></div>
        <button type="submit" class="btn-primary" id="authBtn">Login â†’</button>
      </form>
      <div class="divider"></div>
      <div class="switch-link">
        <span id="switchPre">New here? </span>
        <a onclick="toggleAuth()" id="switchLink">Create an account</a>
      </div>
    </div>
  </div>
</div>

<!-- ===== VERIFY EMAIL ===== -->
<div class="page hidden" id="verifyEmail">
  <div class="verify-wrap fade-in">
    <span class="verify-icon">ğŸ“§</span>
    <h1 class="verify-title">Check your <em>inbox.</em></h1>
    <p class="verify-sub">We've sent a verification link to:</p>
    <div class="verify-email-badge" id="verifyEmailBadge"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b1c8dec4c3f1d4dcd0d8dd9fd2dedc">[email&#160;protected]</a></div>
    <div class="glass-card" style="margin-bottom:20px;">
      <div class="verify-steps">
        <div class="verify-step">
          <div class="step-num">1</div>
          <div class="step-text">Open the email we sent you <strong style="color:var(--accent);">(âš ï¸ Check your Spam / Junk folder â€” it usually lands there!)</strong></div>
        </div>
        <div class="verify-step">
          <div class="step-num">2</div>
          <div class="step-text">Click the <strong>"Verify your email"</strong> link inside</div>
        </div>
        <div class="verify-step">
          <div class="step-num">3</div>
          <div class="step-text">Come back here and click <strong>"I've verified"</strong> below</div>
        </div>
      </div>
      <div class="verify-btns">
        <button class="btn-primary" onclick="checkVerified()">âœ“ I've verified my email</button>
        <button class="btn-secondary" onclick="resendVerification()" id="resendBtn">Resend email</button>
      </div>
      <div class="resend-timer" id="resendTimer"></div>
    </div>
    <button class="btn-secondary" style="width:100%;" onclick="auth.signOut()">â† Use a different account</button>
  </div>
</div>

<!-- ===== HOME ===== -->
<div class="page hidden" id="home">
  <div class="home-wrap fade-in">
    <div class="badge">âœ¦ Welcome back</div>
    <h1 class="home-title">Welcome to <em>Utsaav.</em></h1>
    <p class="home-sub">India's event organizer discovery platform. What would you like to do?</p>
    <div class="option-cards" style="grid-template-columns:1fr 1fr;">
      <div class="option-card o-opt" onclick="showSection('organizer')">
        <span class="opt-icon">ğŸ­</span>
        <div class="opt-title">I'm an Organizer</div>
        <div class="opt-desc">List your event business, post events & get enquiries</div>
      </div>
      <div class="option-card c-opt" onclick="showSection('customer')">
        <span class="opt-icon">ğŸ”</span>
        <div class="opt-title">I'm a Customer</div>
        <div class="opt-desc">Find & contact event organizers near you</div>
      </div>
    </div>
    <div class="option-cards" style="grid-template-columns:1fr 1fr 1fr;margin-bottom:18px;">
      <div class="option-card" onclick="showSection('vendor')" style="padding:20px 14px;">
        <span class="opt-icon" style="font-size:28px;">ğŸ“¸</span>
        <div class="opt-title" style="font-size:14px;">Photographer</div>
        <div class="opt-desc" style="font-size:12px;">List your photography services</div>
      </div>
      <div class="option-card" onclick="showSection('vendor')" style="padding:20px 14px;">
        <span class="opt-icon" style="font-size:28px;">ğŸ’„</span>
        <div class="opt-title" style="font-size:14px;">Makeup Artist</div>
        <div class="opt-desc" style="font-size:12px;">Showcase your makeup work</div>
      </div>
      <div class="option-card" onclick="showSection('vendor')" style="padding:20px 14px;">
        <span class="opt-icon" style="font-size:28px;">ğŸ</span>
        <div class="opt-title" style="font-size:14px;">Return Gifts</div>
        <div class="opt-desc" style="font-size:12px;">Wedding favors & gift hampers</div>
      </div>
    </div>
    <button class="btn-secondary" onclick="logout()">â† Sign out</button>
  </div>
</div>

<!-- ===== ORGANIZER PANEL ===== -->
<div class="page hidden" id="organizer" style="align-items:flex-start;padding-top:20px;padding-left:12px;padding-right:12px;">
  <div class="panel-wrap fade-in" style="max-width:720px;width:100%;">
    <div class="panel-header">
      <div class="panel-back" onclick="showSection('home')">â†</div>
      <div>
        <div class="panel-title">Organizer <span>Panel</span></div>
      </div>
    </div>

    <!-- STATS -->
    <div class="dash-grid" id="orgStats">
      <div class="stat-card"><div class="stat-num" id="statProfiles">0</div><div class="stat-label">My Profiles</div></div>
      <div class="stat-card"><div class="stat-num" id="statEvents">0</div><div class="stat-label">My Events</div></div>
      <div class="stat-card"><div class="stat-num" id="statEnquiries">0</div><div class="stat-label">Enquiries</div></div>
    </div>

    <!-- TABS -->
    <div class="tabs">
      <button class="tab active" onclick="switchOrgTab('profile',this)">ğŸ‘¤ Profile</button>
      <button class="tab" onclick="switchOrgTab('events',this)">ğŸª Post Event</button>
      <button class="tab" onclick="switchOrgTab('inbox',this)">ğŸ“¬ Inbox</button>
    </div>

    <!-- TAB: PROFILE UPLOAD -->
    <div id="orgTabProfile">
      <div class="glass-card">
        <form id="orgForm">
          <div class="form-row">
            <div class="form-group">
              <label>Organizer Name</label>
              <input type="text" id="orgName" placeholder="Name or company" required>
            </div>
            <div class="form-group">
              <label>Company Name <span style="font-size:11px;color:var(--muted);">(optional)</span></label>
              <input type="text" id="orgCompany" placeholder="Your company / brand name">
            </div>
          </div>
          <div class="form-group">
            <label>Categories <span style="font-size:11px;color:var(--muted);">(select all that apply)</span></label>
            <div id="catCheckboxes" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;">
              <label class="cat-chip"><input type="checkbox" value="Wedding"> ğŸ’ Wedding</label>
              <label class="cat-chip"><input type="checkbox" value="Birthday"> ğŸ‚ Birthday</label>
              <label class="cat-chip"><input type="checkbox" value="Corporate"> ğŸ¢ Corporate</label>
              <label class="cat-chip"><input type="checkbox" value="Concert"> ğŸµ Concert</label>
              <label class="cat-chip"><input type="checkbox" value="Sports"> ğŸ… Sports</label>
              <label class="cat-chip"><input type="checkbox" value="Conference"> ğŸ¤ Conference</label>
              <label class="cat-chip"><input type="checkbox" value="Social"> ğŸŠ Social</label>
              <label class="cat-chip"><input type="checkbox" value="Other"> âœ¨ Other</label>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Phone Number</label>
              <input type="tel" id="orgPhone" placeholder="+91 00000 00000" required>
            </div>
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="orgEmail" placeholder="contact@email.com" required>
            </div>
          </div>
          <div class="form-group">
            <label>Bio / Description</label>
            <textarea id="orgBio" rows="3" placeholder="Tell clients about your experience..."></textarea>
          </div>
          <div class="form-group">
            <label>Location / City</label>
            <input type="text" id="orgLocation" placeholder="e.g. Mumbai, Delhi..." required>
          </div>
          <div class="form-group">
            <label>Years of Experience</label>
            <input type="number" id="orgExp" placeholder="e.g. 5" min="0">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Min Price (â‚¹)</label>
              <input type="number" id="orgPriceMin" placeholder="e.g. 10000" min="0">
            </div>
            <div class="form-group">
              <label>Max Price (â‚¹)</label>
              <input type="number" id="orgPriceMax" placeholder="e.g. 100000" min="0">
            </div>
          </div>
          <div class="form-group">
            <label>WhatsApp Number</label>
            <input type="tel" id="orgWhatsapp" placeholder="+91 WhatsApp number">
          </div>
          <div class="form-group">
            <label>Photos (select multiple)</label>
            <input type="file" id="orgPhoto" accept="image/*" multiple onchange="previewMultipleImgs(this)">
            <div id="orgImgsPreview" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;"></div>
          </div>
          <button type="submit" class="btn-primary">âœ¦ Publish Profile</button>
        </form>
      </div>
    </div>

    <!-- TAB: POST EVENT -->
    <div id="orgTabEvents" class="hidden">
      <div class="glass-card" style="margin-bottom:20px;">
        <form id="eventForm">
          <div class="form-row">
            <div class="form-group">
              <label>Event Name</label>
              <input type="text" id="evtName" placeholder="Grand Evening Gala..." required>
            </div>
            <div class="form-group">
              <label>Category</label>
              <select id="evtCategory" required>
                <option value="">Select</option>
                <option>Wedding</option>
                <option>Corporate</option>
                <option>Birthday</option>
                <option>Concert</option>
                <option>Sports</option>
                <option>Conference</option>
                <option>Social</option>
                <option>Other</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Event Date</label>
              <input type="date" id="evtDate" required>
            </div>
            <div class="form-group">
              <label>Ticket Price (â‚¹)</label>
              <input type="number" id="evtPrice" placeholder="0 for free" min="0">
            </div>
          </div>
          <div class="form-group">
            <label>Venue</label>
            <input type="text" id="evtVenue" placeholder="Venue name, city..." required>
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea id="evtDesc" rows="3" placeholder="Describe the event..."></textarea>
          </div>
          <button type="submit" class="btn-primary">ğŸª Post Event</button>
        </form>
      </div>
      <h4 style="font-family:'Playfair Display',serif;margin-bottom:14px;font-size:17px;">Your Posted Events</h4>
      <div id="myEventsList"></div>
    </div>

    <!-- TAB: INBOX -->
    <div id="orgTabInbox" class="hidden">
      <div id="inboxList"><div class="loading-dots"><span></span><span></span><span></span></div></div>
    </div>

  </div>
</div>

<!-- ===== CUSTOMER VIEW ===== -->
<div class="page hidden" id="customer" style="align-items:flex-start;padding-top:20px;padding-left:12px;padding-right:12px;">
  <div class="customer-wrap fade-in">
    <div class="panel-header">
      <div class="panel-back" onclick="showSection('home')">â†</div>
      <div><div class="panel-title">Explore <span>Organizers</span></div></div>
    </div>

    <!-- TABS -->
    <div class="tabs">
      <button class="tab active" onclick="switchCustTab('browse',this)">ğŸ” Browse</button>
      <button class="tab" onclick="switchCustTab('events',this)">ğŸª Events</button>
      <button class="tab" onclick="switchCustTab('vendors',this)">ğŸ“¸ Photographers & More</button>
      <button class="tab" onclick="switchCustTab('myenquiries',this)">ğŸ“‹ My Enquiries</button>
    </div>

    <!-- BROWSE TAB -->
    <div id="custTabBrowse">
      <div class="search-sort-row">
        <div class="search-bar">
          <span class="search-icon">âŒ•</span>
          <input id="search" placeholder="Search organizers..." oninput="filterOrganizers()">
        </div>
        <select class="sort-select" id="sortBy" onchange="filterOrganizers()">
          <option value="newest">Newest</option>
          <option value="rating">Top Rated</option>
          <option value="name">Aâ€“Z</option>
        </select>
      </div>
      <div class="cat-pills" id="catPills"></div>
      <div id="seedBanner" style="background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.25);border-radius:12px;padding:14px 18px;margin-bottom:16px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;">
        <span style="font-size:13px;color:var(--muted);">ğŸ­ Platform abhi naya hai â€” sample organizers add karo!</span>
        <button id="seedBtn" onclick="forceSeed()" style="background:var(--accent);color:#0a0a0f;border:none;padding:8px 18px;border-radius:8px;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;">+ Add 10 Sample Organizers</button>
      </div>
      <div class="org-grid" id="list">
        <div class="loading-dots"><span></span><span></span><span></span></div>
      </div>
    </div>

    <!-- EVENTS TAB -->
    <div id="custTabEvents" class="hidden">
      <div class="events-grid" id="eventsGrid">
        <div class="loading-dots"><span></span><span></span><span></span></div>
      </div>
    </div>

    <!-- VENDORS TAB -->
    <div id="custTabVendors" class="hidden">
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;" id="vendorFilterBtns">
        <button class="vendor-type-btn active" onclick="filterVendors('all',this)">All</button>
        <button class="vendor-type-btn" onclick="filterVendors('photographer',this)">ğŸ“¸ Photographers</button>
        <button class="vendor-type-btn" onclick="filterVendors('makeup',this)">ğŸ’„ Makeup Artists</button>
        <button class="vendor-type-btn" onclick="filterVendors('gifts',this)">ğŸ Return Gifts</button>
      </div>
      <div id="vendorList"><div class="loading-dots"><span></span><span></span><span></span></div></div>
    </div>

    <!-- MY ENQUIRIES TAB -->
    <div id="custTabMyenquiries" class="hidden">
      <div id="myEnquiriesList"><div class="loading-dots"><span></span><span></span><span></span></div></div>
    </div>

  </div>
</div>

<!-- FIREBASE -->
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>
/* ============== FIREBASE ============== */
firebase.initializeApp({
  apiKey:"AIzaSyBNW3y2zR8xQmhrOWqXzu8dmFRMYdSRSFM",
  authDomain:"rd-eventsphere.firebaseapp.com",
  projectId:"rd-eventsphere",
  storageBucket:"rd-eventsphere.firebasestorage.app",
  messagingSenderId:"9010232288",
  appId:"1:9010232288:web:f5e77bb53311acef97c985"
});
const auth=firebase.auth();
const db=firebase.firestore();

/* ============== SEED ORGANIZERS (run once) ============== */
async function seedOrganizers(){
  try{
    const check=await db.collection('organizers').limit(1).get();
    if(!check.empty){ console.log('Already has organizers, skip seed'); return; }
    console.log('Seeding 10 organizers...');
    const organizers=getSeedData();

  const batch=db.batch();
  organizers.forEach(o=>{
    const ref=db.collection('organizers').doc();
    batch.set(ref,o);
  });
  await batch.commit();
  console.log('âœ… 10 organizers seeded!');
  }catch(err){ console.error('Seed error:',err); }
}

async function forceSeed(){
  const btn=document.getElementById('seedBtn');
  if(btn){btn.textContent='â³ Adding...';btn.disabled=true;}
  try{
    const data=getSeedData();
    const batch=db.batch();
    data.forEach(o=>{
      const ref=db.collection('organizers').doc();
      batch.set(ref,o);
    });
    await batch.commit();
    showToast('âœ… 10 organizers added successfully!');
    const banner=document.getElementById('seedBanner');
    if(banner) banner.style.display='none';
    await loadOrganizers();
  }catch(err){
    showToast('âŒ Error: '+err.message,'error');
    console.error('Seed error:',err);
    if(btn){btn.textContent='+ Add 10 Sample Organizers';btn.disabled=false;}
  }
}

async function seedOrganizersFresh(){
  try{
    const data=getSeedData();
    const batch=db.batch();
    data.forEach(o=>{const ref=db.collection('organizers').doc();batch.set(ref,o);});
    await batch.commit();
    showToast('âœ… 10 organizers added!');
  }catch(err){showToast('Error: '+err.message,'error');console.error(err);}
}

function getSeedData(){
  return [
    {name:"Sharma Wedding Planners",phone:"9832100001",whatsapp:"9832100001",email:"sharmaweddings@gmail.com",category:"Wedding",bio:"10+ saal ka experience. Midnapore aur West Bengal mein 500+ weddings successfully organize ki hain. Decoration, catering, photography sab ek hi jagah.",location:"Midnapore, West Bengal",experience:"10",priceMin:50000,priceMax:500000,photo:"https://images.unsplash.com/photo-1519225421980-715cb0215aed?w=400&q=80",photos:["https://images.unsplash.com/photo-1519225421980-715cb0215aed?w=400&q=80","https://images.unsplash.com/photo-1464366400600-7168b8af9bc3?w=400&q=80"],owner:"seed@utsaav.com",rating:4.5,reviewCount:12,createdAt:new Date()},
    {name:"Royal Events & Decorators",phone:"9733200002",whatsapp:"9733200002",email:"royalevents.wbg@gmail.com",category:"Wedding",bio:"Royal Events specializes in royal themed weddings and receptions. Best decorator in Kharagpur area with 7 years of expertise.",location:"Kharagpur, West Bengal",experience:"7",priceMin:30000,priceMax:300000,photo:"https://images.unsplash.com/photo-1530103862676-de8c9debad1d?w=400&q=80",photos:["https://images.unsplash.com/photo-1530103862676-de8c9debad1d?w=400&q=80","https://images.unsplash.com/photo-1478146059778-26028b07395a?w=400&q=80"],owner:"seed@utsaav.com",rating:4.2,reviewCount:8,createdAt:new Date()},
    {name:"Star Corporate Events",phone:"9434300003",whatsapp:"9434300003",email:"starcorp.events@gmail.com",category:"Corporate",bio:"Corporate seminars, conferences, product launches aur team building events mein specialist. Kolkata se Midnapore tak saare districts mein service available.",location:"Kolkata, West Bengal",experience:"6",priceMin:20000,priceMax:200000,photo:"https://images.unsplash.com/photo-1511578314322-379afb476865?w=400&q=80",photos:["https://images.unsplash.com/photo-1511578314322-379afb476865?w=400&q=80","https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=400&q=80"],owner:"seed@utsaav.com",rating:4.7,reviewCount:15,createdAt:new Date()},
    {name:"Dream Birthday Studio",phone:"9635400004",whatsapp:"9635400004",email:"dreambirthday.wb@gmail.com",category:"Birthday",bio:"Bachon se lekar adults tak â€” har tarah ke birthday party themes available. Balloon decoration, cake arrangement, DJ, photography sab kuch.",location:"Paschim Medinipur, West Bengal",experience:"4",priceMin:5000,priceMax:50000,photo:"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400&q=80",photos:["https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400&q=80","https://images.unsplash.com/photo-1464349153735-7db50ed83c84?w=400&q=80"],owner:"seed@utsaav.com",rating:4.3,reviewCount:20,createdAt:new Date()},
    {name:"Beats & Beyond Concert Co.",phone:"9800500005",whatsapp:"9800500005",email:"beatsbeyond.concerts@gmail.com",category:"Concert",bio:"Live concerts, music festivals aur cultural programs ke liye No.1 organizer in West Bengal. Stage setup, sound system, artist booking sab manage karte hain.",location:"Durgapur, West Bengal",experience:"8",priceMin:100000,priceMax:1000000,photo:"https://images.unsplash.com/photo-1470229722913-7c0e2dbbafd3?w=400&q=80",photos:["https://images.unsplash.com/photo-1470229722913-7c0e2dbbafd3?w=400&q=80","https://images.unsplash.com/photo-1501281668745-f7f57925c3b4?w=400&q=80"],owner:"seed@utsaav.com",rating:4.8,reviewCount:31,createdAt:new Date()},
    {name:"Utsav Social Events",phone:"9123600006",whatsapp:"9123600006",email:"utsavsocial.events@gmail.com",category:"Social",bio:"Pujo, cultural programs, annual functions aur community events ke liye trusted name. 15 saal se Midnapore aur surrounding areas mein kaam kar rahe hain.",location:"Midnapore, West Bengal",experience:"15",priceMin:10000,priceMax:150000,photo:"https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=400&q=80",photos:["https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=400&q=80","https://images.unsplash.com/photo-1516450360452-9312f5e86fc7?w=400&q=80"],owner:"seed@utsaav.com",rating:4.6,reviewCount:18,createdAt:new Date()},
    {name:"Elite Conference Solutions",phone:"9876700007",whatsapp:"9876700007",email:"eliteconf.wb@gmail.com",category:"Conference",bio:"Professional conference rooms, AV setup, speaker coordination aur delegate management mein expert. ISO certified event company.",location:"Howrah, West Bengal",experience:"9",priceMin:25000,priceMax:250000,photo:"https://images.unsplash.com/photo-1587825140708-dfaf72ae4b04?w=400&q=80",photos:["https://images.unsplash.com/photo-1587825140708-dfaf72ae4b04?w=400&q=80","https://images.unsplash.com/photo-1475721027785-f74eccf877e2?w=400&q=80"],owner:"seed@utsaav.com",rating:4.4,reviewCount:9,createdAt:new Date()},
    {name:"Champions Sports Events",phone:"9654800008",whatsapp:"9654800008",email:"championsports.events@gmail.com",category:"Sports",bio:"Cricket tournaments, football matches, kabaddi competitions aur school sports events ke expert organizer. Complete sports event management available.",location:"Medinipur, West Bengal",experience:"5",priceMin:15000,priceMax:100000,photo:"https://images.unsplash.com/photo-1461896836934-ffe607ba8211?w=400&q=80",photos:["https://images.unsplash.com/photo-1461896836934-ffe607ba8211?w=400&q=80","https://images.unsplash.com/photo-1517649763962-0c623066013b?w=400&q=80"],owner:"seed@utsaav.com",rating:4.1,reviewCount:6,createdAt:new Date()},
    {name:"Pink Celebration Studio",phone:"9345900009",whatsapp:"9345900009",email:"pinkcelebration.wb@gmail.com",category:"Birthday",bio:"Themed birthday parties, baby showers, anniversary celebrations â€” full package mein photography, cake, decoration, entertainment sab.",location:"Bankura, West Bengal",experience:"3",priceMin:8000,priceMax:60000,photo:"https://images.unsplash.com/photo-1527529482837-4698179dc6ce?w=400&q=80",photos:["https://images.unsplash.com/photo-1527529482837-4698179dc6ce?w=400&q=80","https://images.unsplash.com/photo-1513151233558-d860c5398176?w=400&q=80"],owner:"seed@utsaav.com",rating:4.0,reviewCount:14,createdAt:new Date()},
    {name:"Grand Wedding Affairs",phone:"9567000010",whatsapp:"9567000010",email:"grandwedding.affairs@gmail.com",category:"Wedding",bio:"Aapki shaadi ko unforgettable banana hamare haath mein. Full destination wedding packages available. Catering, mehendi, sangeet, reception â€” ek hi team.",location:"Purulia, West Bengal",experience:"12",priceMin:75000,priceMax:750000,photo:"https://images.unsplash.com/photo-1606800052052-a08af7148866?w=400&q=80",photos:["https://images.unsplash.com/photo-1606800052052-a08af7148866?w=400&q=80","https://images.unsplash.com/photo-1583939003579-730e3918a45a?w=400&q=80"],owner:"seed@utsaav.com",rating:4.9,reviewCount:27,createdAt:new Date()}
  ];
}

/* ============== CATEGORY CHIP TOGGLE ============== */
document.addEventListener('click',e=>{
  const chip=e.target.closest('.cat-chip');
  if(chip && chip.closest('#catCheckboxes')){
    const cb=chip.querySelector('input[type=checkbox]');
    cb.checked=!cb.checked;
    chip.classList.toggle('selected',cb.checked);
  }
});


let isLogin=true;
let allOrganizers=[];
let activeCategory='All';
let currentUser=null;

/* ============== THEME ============== */
if(localStorage.getItem('esLight')==='1') document.body.classList.add('light');
function toggleDark(){
  document.body.classList.toggle('light');
  localStorage.setItem('esLight', document.body.classList.contains('light')?'1':'0');
}

/* ============== TOAST ============== */
function showToast(msg, type='success'){
  const t=document.getElementById('toast');
  t.textContent=msg; t.className='toast '+type+'-t show';
  if(type==='success') t.className='toast success show';
  setTimeout(()=>t.classList.remove('show'),3200);
}

/* ============== IMAGE PREVIEW ============== */
function previewImg(input, previewId){
  const prev=document.getElementById(previewId);
  if(input.files && input.files[0]){
    const r=new FileReader();
    r.onload=e=>{prev.src=e.target.result; prev.style.display='block';};
    r.readAsDataURL(input.files[0]);
  }
}

function previewMultipleImgs(input){
  const container=document.getElementById('orgImgsPreview');
  container.innerHTML='';
  Array.from(input.files).forEach((file,i)=>{
    const r=new FileReader();
    r.onload=e=>{
      const wrap=document.createElement('div');
      wrap.style.cssText='position:relative;display:inline-block;';
      wrap.innerHTML=`
        <img src="${e.target.result}" style="width:80px;height:80px;object-fit:cover;border-radius:10px;border:2px solid var(--border);">
        ${i===0?'<div style="position:absolute;bottom:4px;left:50%;transform:translateX(-50%);background:var(--accent);color:#000;font-size:9px;font-weight:700;padding:2px 6px;border-radius:4px;white-space:nowrap;">MAIN</div>':''}`;
      container.appendChild(wrap);
    };
    r.readAsDataURL(file);
  });
}

/* ============== AUTH ============== */
function togglePass(){
  const p=document.getElementById('authPass');
  p.type=p.type==='password'?'text':'password';
}
function toggleAuth(){
  isLogin=!isLogin;
  document.getElementById('authTitle').innerHTML=isLogin?'Welcome <em>Back.</em>':'Create <em>Account.</em>';
  document.getElementById('authSubtitle').textContent=isLogin?'Login to your Utsaav account.':'Join the Utsaav community.';
  document.getElementById('authBtn').textContent=isLogin?'Login â†’':'Register â†’';
  document.getElementById('switchPre').textContent=isLogin?'New here? ':'Already have an account? ';
  document.getElementById('switchLink').textContent=isLogin?'Create an account':'Login here';
  document.getElementById('errorMsg').textContent='';
}

document.getElementById('authForm').addEventListener('submit',async e=>{
  e.preventDefault();
  const email=document.getElementById('authEmail').value;
  const pass=document.getElementById('authPass').value;
  const errEl=document.getElementById('errorMsg');
  const btn=document.getElementById('authBtn');
  if(pass.length<6){errEl.textContent='âš  Password must be at least 6 characters'; return;}
  btn.textContent='Please wait...'; btn.disabled=true;
  try{
    if(isLogin){
      const cred=await auth.signInWithEmailAndPassword(email,pass);
      if(!cred.user.emailVerified){
        // Force show verify screen
        showVerifyScreen(cred.user);
        btn.textContent='Login â†’'; btn.disabled=false;
        return;
      }
    } else {
      const cred=await auth.createUserWithEmailAndPassword(email,pass);
      await cred.user.sendEmailVerification();
      showVerifyScreen(cred.user);
      btn.textContent='Register â†’'; btn.disabled=false;
      return;
    }
  }catch(err){
    errEl.textContent='âš  '+err.message;
  }
  btn.textContent=isLogin?'Login â†’':'Register â†’'; btn.disabled=false;
});

auth.onAuthStateChanged(user=>{
  currentUser=user;
  if(user){
    if(!user.emailVerified){
      // Signed in but not verified â€” show verify screen
      showVerifyScreen(user);
      return;
    }
    // Fully verified
    hideAllPages();
    document.getElementById('home').classList.remove('hidden');
    updateHeaderUser(user.email);
  } else {
    hideAllPages();
    document.getElementById('auth').classList.remove('hidden');
    document.getElementById('headerRight').innerHTML='<div class="icon-btn" onclick="toggleDark()" title="Toggle theme">ğŸŒ™</div>';
  }
});

function hideAllPages(){
  ['auth','verifyEmail','home','organizer','customer','profilePage','vendor'].forEach(id=>document.getElementById(id)?.classList.add('hidden'));
}

function showVerifyScreen(user){
  hideAllPages();
  document.getElementById('verifyEmail').classList.remove('hidden');
  document.getElementById('verifyEmailBadge').textContent=user.email;
  updateHeaderUser(user.email);
}

let resendCooldown=null;
async function resendVerification(){
  const btn=document.getElementById('resendBtn');
  const timer=document.getElementById('resendTimer');
  try{
    await auth.currentUser.sendEmailVerification();
    showToast('ğŸ“§ Verification email resent!');
    btn.disabled=true;
    let secs=60;
    timer.textContent=`Resend available in ${secs}s`;
    resendCooldown=setInterval(()=>{
      secs--;
      timer.textContent=`Resend available in ${secs}s`;
      if(secs<=0){
        clearInterval(resendCooldown);
        btn.disabled=false;
        timer.textContent='';
      }
    },1000);
  }catch(err){ showToast('Could not resend: '+err.message,'error'); }
}

async function checkVerified(){
  const btn=document.querySelector('#verifyEmail .btn-primary');
  btn.textContent='Checking...'; btn.disabled=true;
  await auth.currentUser.reload();
  if(auth.currentUser.emailVerified){
    currentUser=auth.currentUser;
    showToast('âœ¦ Email verified! Welcome aboard.');
    hideAllPages();
    document.getElementById('home').classList.remove('hidden');
    updateHeaderUser(currentUser.email);
  } else {
    showToast('âš  Not verified yet. Check your inbox.','error');
  }
  btn.textContent='âœ“ I\'ve verified my email'; btn.disabled=false;
}

function updateHeaderUser(email){
  document.getElementById('headerRight').innerHTML=`
    <div class="user-chip"><div class="dot"></div>${email.split('@')[0]}</div>
    <div class="icon-btn" onclick="toggleDark()" title="Toggle theme">ğŸŒ™</div>`;
}

function logout(){ auth.signOut(); }
function handleLogoClick(){ if(currentUser) showSection('home'); }

/* ============== SECTION NAVIGATION ============== */
const sections=['auth','verifyEmail','home','organizer','customer'];
function showSection(id){
  hideAllPages();
  document.getElementById(id).classList.remove('hidden');
  document.getElementById(id).querySelector('.fade-in')?.classList.remove('fade-in');
  void document.getElementById(id).offsetWidth;
  document.getElementById(id).querySelector('[class*="wrap"],[class*="Wrap"]')?.classList.add('fade-in');

  if(id==='organizer'){ loadOrgStats(); loadMyEvents(); }
  if(id==='customer'){ seedOrganizers().then(()=>loadOrganizers()); }
}

/* ============== ORG TABS ============== */
function switchOrgTab(name, btn){
  document.querySelectorAll('.tabs .tab').forEach((t,i,a)=>{
    if(a[0].parentElement.id===undefined||a[0].closest('#organizer'))t.classList.remove('active');
  });
  btn.classList.add('active');
  ['orgTabProfile','orgTabEvents','orgTabInbox'].forEach(id=>document.getElementById(id)?.classList.add('hidden'));
  document.getElementById('orgTab'+name.charAt(0).toUpperCase()+name.slice(1))?.classList.remove('hidden');
  if(name==='inbox') loadInbox();
  if(name==='events') loadMyEvents();
}

/* ============== CUST TABS ============== */
function switchCustTab(name, btn){
  btn.parentElement.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  btn.classList.add('active');
  ['custTabBrowse','custTabEvents','custTabVendors','custTabMyenquiries'].forEach(id=>document.getElementById(id)?.classList.add('hidden'));
  document.getElementById('custTab'+name.charAt(0).toUpperCase()+name.slice(1))?.classList.remove('hidden');
  if(name==='events') loadAllEvents();
  if(name==='myenquiries') loadMyEnquiries();
  if(name==='vendors') loadVendors('all');
}

/* ============== ORGANIZER PROFILE FORM ============== */
document.getElementById('orgForm').addEventListener('submit',async e=>{
  e.preventDefault();
  const files=document.getElementById('orgPhoto').files;
  if(!files.length){showToast('Please select at least one photo','error'); return;}
  const btn=e.target.querySelector('button[type=submit]');
  btn.disabled=true;

  const checkedCats=[...document.querySelectorAll('#catCheckboxes input:checked')].map(c=>c.value);
  if(!checkedCats.length){showToast('Please select at least one category','error'); return;}

  // Compress photos (max 800px, quality 0.72)
  const compressPhoto = (file) => new Promise(res => {
    const img = new Image();
    const url = URL.createObjectURL(file);
    img.onload = () => {
      const MAX = 600;
      let w = img.width, h = img.height;
      if(w > MAX){ h = Math.round(h * MAX / w); w = MAX; }
      const canvas = document.createElement('canvas');
      canvas.width = w; canvas.height = h;
      canvas.getContext('2d').drawImage(img, 0, 0, w, h);
      URL.revokeObjectURL(url);
      res(canvas.toDataURL('image/jpeg', 0.5));
    };
    img.src = url;
  });

  btn.textContent = 'Compressing...';
  const photos = await Promise.all(Array.from(files).slice(0,5).map(compressPhoto));

  btn.textContent = 'Saving...';
  await db.collection('organizers').add({
    name:document.getElementById('orgName').value,
    company:document.getElementById('orgCompany').value||'',
    phone:document.getElementById('orgPhone').value,
    whatsapp:document.getElementById('orgWhatsapp').value||document.getElementById('orgPhone').value,
    email:document.getElementById('orgEmail').value,
    category:checkedCats[0],
    categories:checkedCats,
    bio:document.getElementById('orgBio').value,
    location:document.getElementById('orgLocation').value,
    experience:document.getElementById('orgExp').value||'',
    priceMin:document.getElementById('orgPriceMin').value||0,
    priceMax:document.getElementById('orgPriceMax').value||0,
    photo:photos[0],
    photos:photos,
    owner:currentUser.email,
    rating:0, reviewCount:0,
    createdAt:new Date()
  });

  document.getElementById('orgForm').reset();
  document.getElementById('orgImgsPreview').innerHTML='';
  document.querySelectorAll('.cat-chip').forEach(c=>c.classList.remove('selected'));
  document.querySelectorAll('#catCheckboxes input').forEach(c=>c.checked=false);
  btn.textContent='âœ¦ Publish Profile'; btn.disabled=false;
  showToast('âœ¦ Profile published!');
  loadOrgStats();
});

/* ============== ORG STATS ============== */
async function loadOrgStats(){
  const [profSnap,evtSnap,enqSnap]=await Promise.all([
    db.collection('organizers').where('owner','==',currentUser.email).get(),
    db.collection('events').where('owner','==',currentUser.email).get(),
    db.collection('enquiries').where('toEmail','==',currentUser.email).get()
  ]);
  document.getElementById('statProfiles').textContent=profSnap.size;
  document.getElementById('statEvents').textContent=evtSnap.size;
  document.getElementById('statEnquiries').textContent=enqSnap.size;
}

/* ============== EVENTS ============== */
document.getElementById('eventForm').addEventListener('submit',async e=>{
  e.preventDefault();
  const price=parseInt(document.getElementById('evtPrice').value)||0;
  await db.collection('events').add({
    name:document.getElementById('evtName').value,
    category:document.getElementById('evtCategory').value,
    date:document.getElementById('evtDate').value,
    price:price,
    venue:document.getElementById('evtVenue').value,
    description:document.getElementById('evtDesc').value,
    owner:currentUser.email,
    createdAt:new Date()
  });
  document.getElementById('eventForm').reset();
  showToast('ğŸª Event posted!');
  loadMyEvents();
  loadOrgStats();
});

async function loadMyEvents(){
  const el=document.getElementById('myEventsList');
  if(!el) return;
  el.innerHTML='<div class="loading-dots"><span></span><span></span><span></span></div>';
  const snap=await db.collection('events').where('owner','==',currentUser.email).orderBy('createdAt','desc').get();
  if(snap.empty){el.innerHTML='<p style="color:var(--muted);font-size:14px;">No events posted yet.</p>'; return;}
  el.innerHTML='';
  snap.forEach(doc=>{
    const ev=doc.data();
    const d=new Date(ev.date);
    el.innerHTML+=`
    <div class="enquiry-item" style="display:flex;align-items:flex-start;gap:14px;">
      <div style="flex-shrink:0;text-align:center;background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:8px 12px;">
        <div style="font-size:9px;text-transform:uppercase;letter-spacing:1px;color:var(--accent);font-weight:600;">${d.toLocaleString('default',{month:'short'})}</div>
        <div style="font-size:22px;font-weight:900;font-family:'Playfair Display',serif;line-height:1;">${d.getDate()}</div>
      </div>
      <div style="flex:1;">
        <div style="font-family:'Playfair Display',serif;font-size:16px;font-weight:700;">${ev.name}</div>
        <div style="font-size:12px;color:var(--muted);margin-top:3px;">ğŸ“ ${ev.venue} &nbsp;|&nbsp; <span class="badge badge-${getCatColor(ev.category)}" style="margin:0;">${ev.category}</span></div>
        <div style="font-size:16px;font-weight:700;color:var(--accent);margin-top:6px;">${ev.price?'â‚¹'+ev.price.toLocaleString():'Free'}</div>
      </div>
      <button class="btn-danger btn-sm" onclick="deleteEvent('${doc.id}')">Delete</button>
    </div>`;
  });
}

async function deleteEvent(id){
  if(!confirm('Delete this event?')) return;
  await db.collection('events').doc(id).delete();
  showToast('Event deleted.','error');
  loadMyEvents(); loadOrgStats();
}

async function loadAllEvents(){
  const el=document.getElementById('eventsGrid');
  el.innerHTML='<div class="loading-dots"><span></span><span></span><span></span></div>';
  const snap=await db.collection('events').orderBy('date','asc').get();
  el.innerHTML='';
  if(snap.empty){el.innerHTML='<div class="empty-state"><span class="empty-icon">ğŸª</span><p>No events yet.</p></div>'; return;}
  snap.forEach(doc=>{
    const ev=doc.data();
    const d=new Date(ev.date);
    const card=document.createElement('div');
    card.className='event-card';
    card.innerHTML=`
      <div class="event-date-badge">
        <div class="month">${d.toLocaleString('default',{month:'short'})}</div>
        <div class="day">${d.getDate()}</div>
      </div>
      <div class="badge badge-${getCatColor(ev.category)}" style="margin-bottom:10px;">${ev.category}</div>
      <div class="event-title">${ev.name}</div>
      <div class="event-meta">ğŸ“ ${ev.venue}</div>
      <div class="event-meta">ğŸ‘¤ ${ev.owner.split('@')[0]}</div>
      ${ev.description?`<div style="font-size:12px;color:var(--muted);margin-top:8px;line-height:1.5;">${ev.description.slice(0,80)}${ev.description.length>80?'...':''}</div>`:''}
      <div class="event-price">${ev.price?'â‚¹'+ev.price.toLocaleString():'<span>Free Entry</span>'}</div>`;
    el.appendChild(card);
  });
}

/* ============== INBOX ============== */
async function loadInbox(){
  const el=document.getElementById('inboxList');
  el.innerHTML='<div class="loading-dots"><span></span><span></span><span></span></div>';
  const snap=await db.collection('enquiries').where('toEmail','==',currentUser.email).orderBy('createdAt','desc').get();
  el.innerHTML='';
  if(snap.empty){el.innerHTML='<div class="empty-state"><span class="empty-icon">ğŸ“¬</span><p>No enquiries yet.</p></div>'; return;}
  snap.forEach(doc=>{
    const q=doc.data();
    const d=q.createdAt?.toDate?.()?.toLocaleDateString()||'';
    el.innerHTML+=`
    <div class="enquiry-item">
      <div class="enquiry-to" style="display:flex;justify-content:space-between;">
        <span>From: <strong>${q.fromEmail||q.fromName}</strong></span>
        <span style="font-size:11px;color:var(--muted);">${d}</span>
      </div>
      <div style="font-size:12px;color:var(--muted);margin-bottom:8px;">${q.fromPhone?'ğŸ“ '+q.fromPhone:''}</div>
      <div class="enquiry-msg">${q.message}</div>
      <div class="enquiry-status">New Enquiry</div>
    </div>`;
  });
}

/* ============== MY ENQUIRIES ============== */
async function loadMyEnquiries(){
  const el=document.getElementById('myEnquiriesList');
  el.innerHTML='<div class="loading-dots"><span></span><span></span><span></span></div>';
  const snap=await db.collection('enquiries').where('fromEmail','==',currentUser.email).orderBy('createdAt','desc').get();
  el.innerHTML='';
  if(snap.empty){el.innerHTML='<div class="empty-state"><span class="empty-icon">ğŸ“‹</span><p>You haven\'t sent any enquiries yet.</p></div>'; return;}
  snap.forEach(doc=>{
    const q=doc.data();
    const d=q.createdAt?.toDate?.()?.toLocaleDateString()||'';
    el.innerHTML+=`
    <div class="enquiry-item">
      <div class="enquiry-to" style="display:flex;justify-content:space-between;">
        <span>To: <strong>${q.toName}</strong></span>
        <span style="font-size:11px;color:var(--muted);">${d}</span>
      </div>
      <div class="enquiry-msg">${q.message}</div>
      <div class="enquiry-status">Sent</div>
    </div>`;
  });
}

/* ============== ORGANIZERS LOAD ============== */
async function loadOrganizers(){
  const el=document.getElementById('list');
  el.innerHTML='<div class="loading-dots"><span></span><span></span><span></span></div>';
  try{
    const snap=await db.collection('organizers').get();
    allOrganizers=[];
    snap.forEach(doc=>allOrganizers.push({id:doc.id,...doc.data()}));
    // Sort by createdAt client side â€” no index needed
    allOrganizers.sort((a,b)=>{
      const at=a.createdAt?.toDate?.()?.getTime()||0;
      const bt=b.createdAt?.toDate?.()?.getTime()||0;
      return bt-at;
    });
    // Hide seed banner if organizers exist
    const banner=document.getElementById('seedBanner');
    if(banner) banner.style.display=allOrganizers.length>0?'none':'flex';
    buildCatPills();
    renderOrganizers(allOrganizers);
  }catch(err){
    el.innerHTML=`<p style="color:var(--muted);font-size:14px;">âš ï¸ Error loading: ${err.message}</p>`;
    console.error(err);
  }
}

function buildCatPills(){
  const cats=['All',...new Set(allOrganizers.map(o=>o.category).filter(Boolean))];
  document.getElementById('catPills').innerHTML=cats.map(c=>`
    <div class="cat-pill${c==='All'?' active':''}" onclick="setCat('${c}',this)">${c}</div>
  `).join('');
}

function setCat(cat, el){
  document.querySelectorAll('.cat-pill').forEach(p=>p.classList.remove('active'));
  el.classList.add('active');
  activeCategory=cat;
  filterOrganizers();
}

function filterOrganizers(){
  const term=document.getElementById('search').value.toLowerCase();
  const sort=document.getElementById('sortBy').value;
  let filtered=allOrganizers.filter(o=>{
    const matchCat=activeCategory==='All'||o.category===activeCategory;
    const matchSearch=!term||[o.name,o.email,o.phone,o.location,o.bio].join(' ').toLowerCase().includes(term);
    return matchCat&&matchSearch;
  });
  if(sort==='rating') filtered.sort((a,b)=>(b.rating||0)-(a.rating||0));
  else if(sort==='name') filtered.sort((a,b)=>a.name.localeCompare(b.name));
  renderOrganizers(filtered);
}

function renderOrganizers(list){
  const el=document.getElementById('list');
  const banner=document.getElementById('seedBanner');
  el.innerHTML='';
  if(!list.length){
    el.innerHTML='<div class="empty-state"><span class="empty-icon">ğŸ”</span><p>No organizers found.</p></div>';
    if(allOrganizers.length===0 && banner) banner.style.display='flex';
    return;
  }
  if(banner) banner.style.display='none';
  list.forEach(o=>{
    const isOwner=o.owner===currentUser?.email;
    const stars=renderStars(o.rating||0);
    const card=document.createElement('div');
    card.className='org-card';
    card.style.cursor='pointer';
    card.onclick=()=>openProfilePage(o);
    card.innerHTML=`
      <div class="org-img-wrap">
        <img src="${o.photo}" alt="${o.name}" loading="lazy">
        ${o.category?`<div class="cat-tag">${o.category}</div>`:''}
      </div>
      <div class="org-body">
        ${isOwner?'<div class="badge" style="margin-bottom:8px;">âœ¦ Your listing</div>':''}
        <div class="org-name">${o.name}</div>
        ${o.location?`<div class="org-meta">ğŸ“ ${o.location}</div>`:''}
        <div class="org-meta">ğŸ“ ${o.phone}</div>
        ${o.whatsapp?`<div class="org-meta" style="color:#25d366;">ğŸ’¬ ${o.whatsapp}</div>`:''}
        <div style="display:flex;align-items:center;gap:6px;margin-top:6px;">
          <span class="stars">${stars}</span>
          <span class="stars-count">${o.rating?o.rating.toFixed(1)+' ('+o.reviewCount+')':(o.reviewCount?o.rating.toFixed(1)+' ('+o.reviewCount+')':'No reviews')}</span>
        </div>
      </div>
      <div class="org-footer" onclick="openProfilePage(allOrganizers.find(x=>x.id==='${o.id}'))" style="cursor:pointer;">
        <span style="font-size:12px;color:var(--muted);">${o.email.split('@')[0]}@â€¦</span>
        <span style="font-size:12px;color:var(--accent);font-weight:600;display:flex;align-items:center;gap:4px;">View <span style="font-size:16px;">â†’</span></span>
      </div>`;
    el.appendChild(card);
  });
}

function renderStars(r){
  const full=Math.round(r);
  return Array.from({length:5},(_, i)=>i<full?'â˜…':'â˜†').join('');
}

/* ============== ORGANIZER MODAL ============== */
async function openOrgModal(o){
  const isOwner=o.owner===currentUser?.email;
  const snap=await db.collection('reviews').where('orgId','==',o.id).orderBy('createdAt','desc').limit(10).get();
  const reviews=[];
  snap.forEach(d=>reviews.push(d.data()));

  const stars=renderStars(o.rating||0);
  let reviewsHtml=reviews.length?reviews.map(rv=>`
    <div class="review-card">
      <div class="review-top">
        <span class="review-author">${rv.authorName||rv.authorEmail.split('@')[0]}</span>
        <span>${renderStars(rv.rating)} <span class="review-date">${rv.createdAt?.toDate?.()?.toLocaleDateString()||''}</span></span>
      </div>
      <div class="review-text">${rv.text}</div>
    </div>`).join('')
    :'<p style="font-size:13px;color:var(--muted);">No reviews yet. Be the first!</p>';

  document.getElementById('modalContainer').innerHTML=`
  <div class="modal-overlay" onclick="closeModal(event)">
    <div class="modal" id="mainModal">
      <div class="modal-img-wrap">
        <img class="modal-img" id="modalMainImg" src="${o.photo}" alt="${o.name}">
        <div class="modal-close" onclick="closeModalDirect()">âœ•</div>
      </div>
      ${o.photos && o.photos.length>1?`
      <div style="display:flex;gap:8px;padding:12px 16px 0;overflow-x:auto;">
        ${o.photos.map((p,i)=>`
          <img src="${p}" onclick="document.getElementById('modalMainImg').src='${p}'"
            style="width:60px;height:60px;object-fit:cover;border-radius:8px;cursor:pointer;border:2px solid ${i===0?'var(--accent)':'var(--border)'};flex-shrink:0;transition:all 0.2s;"
            onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='${i===0?'var(--accent)':'var(--border)'}'">
        `).join('')}
      </div>`:''}
      <div class="modal-body">
        ${o.category?`<div class="badge" style="margin-bottom:12px;">${o.category}</div>`:''}
        <div class="modal-name">${o.name}</div>
        <div style="display:flex;align-items:center;gap:8px;margin:6px 0 14px;">
          <span class="stars" style="font-size:16px;">${stars}</span>
          <span style="font-size:13px;color:var(--muted);">${o.rating?o.rating.toFixed(1)+' Â· '+o.reviewCount+' review(s)':'No reviews yet'}</span>
        </div>
        ${o.bio?`<p style="font-size:14px;color:var(--muted);line-height:1.6;margin-bottom:16px;">${o.bio}</p>`:''}
        <div class="info-grid">
          <div class="info-item"><div class="info-item-label">Phone</div><div class="info-item-value">ğŸ“ ${o.phone}</div></div>
          <div class="info-item"><div class="info-item-label">WhatsApp</div><div class="info-item-value">ğŸ’¬ ${o.whatsapp||o.phone}</div></div>
          <div class="info-item"><div class="info-item-label">Email</div><div class="info-item-value">âœ‰ ${o.email}</div></div>
          ${o.location?`<div class="info-item"><div class="info-item-label">Location</div><div class="info-item-value">ğŸ“ ${o.location}</div></div>`:''}
        </div>
        <div class="modal-actions">
          ${!isOwner?`<button class="btn-primary btn-sm" onclick="scrollToEnquiry()">ğŸ“© Send Enquiry</button>`:''}
          <button class="btn-secondary btn-sm" onclick="window.open('tel:${o.phone}')">ğŸ“ Call</button>
          ${!isOwner?`<button class="btn-secondary btn-sm" style="background:rgba(37,211,102,0.1);border-color:rgba(37,211,102,0.3);color:#25d366;" onclick="window.open('https://wa.me/91${(o.whatsapp||o.phone).replace(/\D/g,'')}','_blank')">ğŸ’¬ WhatsApp</button>`:''}
          ${isOwner?`<button class="btn-danger btn-sm" onclick="deleteOrg('${o.id}')">Delete</button>`:''}
        </div>

        <!-- REVIEWS -->
        <div class="reviews-section">
          <h4>Reviews & Ratings</h4>
          <div id="reviewsList">${reviewsHtml}</div>
          ${!isOwner?`
          <div class="review-form">
            <div style="font-size:13px;font-weight:600;margin-bottom:8px;">Leave a review</div>
            <div class="star-picker" id="starPicker">
              <span onclick="setStar(1)">â˜…</span><span onclick="setStar(2)">â˜…</span>
              <span onclick="setStar(3)">â˜…</span><span onclick="setStar(4)">â˜…</span>
              <span onclick="setStar(5)">â˜…</span>
            </div>
            <div class="form-group"><textarea id="reviewText" rows="2" placeholder="Share your experience..."></textarea></div>
            <button class="btn-purple btn-sm" onclick="submitReview('${o.id}','${o.owner}','${o.name}')">Submit Review</button>
          </div>`:''}
        </div>

        <!-- ENQUIRY FORM -->
        ${!isOwner?`
        <div class="enquiry-form" id="enquiryFormSection">
          <h4>ğŸ“© Send Enquiry</h4>
          <div class="form-group"><input type="text" id="enqName" placeholder="Your name" value="${currentUser.email.split('@')[0]}"></div>
          <div class="form-group"><input type="tel" id="enqPhone" placeholder="Your phone number"></div>
          <div class="form-group"><textarea id="enqMsg" rows="3" placeholder="Describe your event requirements..."></textarea></div>
          <button class="btn-primary btn-sm" onclick="sendEnquiry('${o.id}','${o.owner}','${o.name}')">Send Message</button>
        </div>`:''}
      </div>
    </div>
  </div>`;

  selectedStar=0;
}

let selectedStar=0;
function setStar(n){
  selectedStar=n;
  document.querySelectorAll('#starPicker span').forEach((s,i)=>s.classList.toggle('lit',i<n));
}
function scrollToEnquiry(){
  document.getElementById('enquiryFormSection')?.scrollIntoView({behavior:'smooth',block:'start'});
}
function closeModal(e){ if(e.target.classList.contains('modal-overlay')) closeModalDirect(); }
function closeModalDirect(){ document.getElementById('modalContainer').innerHTML=''; }

/* ============== SUBMIT REVIEW ============== */
async function submitReview(orgId, orgOwner, orgName){
  if(!selectedStar){showToast('Please select a star rating','error'); return;}
  const text=document.getElementById('reviewText').value.trim();
  if(!text){showToast('Please write a review','error'); return;}
  await db.collection('reviews').add({
    orgId, orgOwner, orgName,
    rating:selectedStar,
    text,
    authorEmail:currentUser.email,
    authorName:currentUser.email.split('@')[0],
    createdAt:new Date()
  });
  // Update avg rating on organizer doc
  const orgRef=db.collection('organizers').doc(orgId);
  const allRev=await db.collection('reviews').where('orgId','==',orgId).get();
  let total=0; allRev.forEach(d=>total+=d.data().rating);
  await orgRef.update({rating:total/allRev.size, reviewCount:allRev.size});
  showToast('â­ Review submitted!');
  closeModalDirect();
  loadOrganizers();
}

/* ============== SEND ENQUIRY ============== */
async function sendEnquiry(orgId, toEmail, toName){
  const msg=document.getElementById('enqMsg').value.trim();
  if(!msg){showToast('Please write a message','error'); return;}
  const name=document.getElementById('enqName').value.trim();
  const phone=document.getElementById('enqPhone').value.trim();
  await db.collection('enquiries').add({
    orgId, toEmail, toName,
    fromEmail:currentUser.email,
    fromName:name||currentUser.email.split('@')[0],
    fromPhone:phone,
    message:msg,
    createdAt:new Date()
  });
  showToast('ğŸ“© Enquiry sent!');
  closeModalDirect();
}

/* ============== DELETE ORG ============== */
async function deleteOrg(id){
  if(!confirm('Delete this organizer profile?')) return;
  await db.collection('organizers').doc(id).delete();
  showToast('Listing removed.','error');
  closeModalDirect();
  loadOrganizers();
  loadOrgStats();
}

/* ============== CATEGORY COLOR HELPER ============== */
function getCatColor(cat){
  const map={Wedding:'',Corporate:'blue',Birthday:'purple',Concert:'green',Sports:'blue',Conference:'blue',Social:'purple'};
  return map[cat]||'';
}
</script>

<!-- FOOTER -->
<footer style="position:relative;z-index:5;border-top:1px solid var(--border);background:var(--surface);padding:32px 40px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px;">
  <div style="display:flex;align-items:center;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 520 160" height="36" width="117">
      <defs>
        <linearGradient id="ifIG" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#FF6B6B"/><stop offset="70%" style="stop-color:#FFC837"/><stop offset="100%" style="stop-color:#FF6B9D"/></linearGradient>
        <linearGradient id="ifTG" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:#FF6B6B"/><stop offset="50%" style="stop-color:#FFC837"/><stop offset="100%" style="stop-color:#FF6B9D"/></linearGradient>
        <filter id="ifG"><feGaussianBlur stdDeviation="3" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <circle cx="78" cy="80" r="44" fill="none" stroke="url(#ifIG)" stroke-width="1.5" opacity="0.9"/>
      <circle cx="78" cy="80" r="44" fill="url(#ifIG)" opacity="0.1"/>
      <circle cx="78" cy="34" r="2.5" fill="url(#ifIG)"/><circle cx="78" cy="126" r="2.5" fill="url(#ifIG)"/><circle cx="32" cy="80" r="2.5" fill="url(#ifIG)"/><circle cx="124" cy="80" r="2.5" fill="url(#ifIG)"/>
      <path d="M 55 52 L 55 88 Q 55 108 78 108 Q 101 108 101 88 L 101 52" fill="none" stroke="url(#ifIG)" stroke-width="7" stroke-linecap="round" filter="url(#ifG)"/>
      <g transform="translate(52,46)" filter="url(#ifG)"><path d="M0,-6 L1.5,-1.5 L6,0 L1.5,1.5 L0,6 L-1.5,1.5 L-6,0 L-1.5,-1.5 Z" fill="#FFC837"/></g>
      <g transform="translate(104,46)" filter="url(#ifG)"><path d="M0,-5 L1.2,-1.2 L5,0 L1.2,1.2 L0,5 L-1.2,1.2 L-5,0 L-1.2,-1.2 Z" fill="#FF6B9D"/></g>
      <text x="168" y="95" font-family="Georgia,serif" font-size="58" font-weight="700" letter-spacing="4" fill="url(#ifTG)">UTSAAV</text>
      <text x="170" y="118" font-family="Georgia,serif" font-size="12" letter-spacing="5" fill="#555">EVENT MANAGEMENT</text>
    </svg>
  </div>
  <div style="text-align:center;font-size:13px;color:var(--muted);line-height:1.8;">
    <div>Event Management Platform â€” <a href="landing.html" style="color:var(--accent);text-decoration:none;font-weight:600;">Organizers ke liye free listing â†’</a></div>
    <div style="margin-top:4px;">
      CEO &amp; Founder â€” <strong style="color:var(--text);">Ritam Mitra</strong> &nbsp;|&nbsp;
      <a href="tel:7384949090" style="color:var(--accent);text-decoration:none;">ğŸ“ 7384949090</a> &nbsp;|&nbsp;
      <a href="/cdn-cgi/l/email-protection#650817170c110408080c111704250208040c094b060a08" style="color:var(--accent);text-decoration:none;">âœ‰ <span class="__cf_email__" data-cfemail="bdd0cfcfd4c9dcd0d0d4c9cfdcfddad0dcd4d193ded2d0">[email&#160;protected]</span></a
<!-- ===== PROFILE VIEW PAGE ===== -->
<div class="hidden" id="profilePage" style="position:relative;z-index:5;min-height:calc(100vh - 67px);padding:0 0 80px;">
  <div id="profileHero" style="position:relative;height:300px;overflow:hidden;background:var(--surface2);">
    <img id="profileHeroImg" src="" alt="" style="width:100%;height:100%;object-fit:cover;filter:brightness(0.45);">
    <div style="position:absolute;inset:0;background:linear-gradient(to bottom,transparent 20%,var(--bg) 100%);"></div>
    <button onclick="closeProfilePage()" style="position:absolute;top:20px;left:20px;background:rgba(0,0,0,0.55);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.15);color:#fff;padding:10px 20px;border-radius:10px;font-family:'DM Sans',sans-serif;font-size:14px;cursor:pointer;transition:all 0.2s;">â† Back</button>
    <div id="profileThumbs" style="position:absolute;bottom:16px;right:20px;display:flex;gap:8px;"></div>
  </div>

  <div style="max-width:940px;margin:0 auto;padding:0 20px;">
    <div style="display:flex;align-items:flex-end;justify-content:space-between;flex-wrap:wrap;gap:16px;margin-top:-40px;position:relative;z-index:2;margin-bottom:26px;">
      <div>
        <div id="profileCategory" style="margin-bottom:10px;"></div>
        <div id="profileName" style="font-family:'Playfair Display',serif;font-size:38px;font-weight:900;line-height:1.05;margin-bottom:10px;"></div>
        <div style="display:flex;align-items:center;gap:14px;flex-wrap:wrap;">
          <div id="profileLocation" style="font-size:13px;color:var(--muted);"></div>
          <div id="profileExp" style="font-size:13px;color:var(--muted);"></div>
          <div id="profileStars"></div>
        </div>
      </div>
      <div id="profilePriceBadge" style="background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:16px 24px;text-align:center;">
        <div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);margin-bottom:6px;">Budget Range</div>
        <div id="profilePriceText" style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;color:var(--accent);"></div>
      </div>
    </div>

    <div id="profileActions" style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:28px;"></div>

    <div style="display:grid;grid-template-columns:1fr 320px;gap:22px;align-items:start;">
      <div>
        <!-- ABOUT -->
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:22px;margin-bottom:18px;">
          <h3 style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;margin-bottom:12px;">About</h3>
          <p id="profileBio" style="font-size:14px;color:var(--muted);line-height:1.8;"></p>
        </div>

        <!-- SERVICES -->
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:22px;margin-bottom:18px;">
          <h3 style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;margin-bottom:14px;">ğŸ­ Specialization</h3>
          <div id="profileServices" style="display:flex;flex-wrap:wrap;gap:8px;"></div>
        </div>

        <!-- GALLERY -->
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:22px;margin-bottom:18px;">
          <h3 style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;margin-bottom:14px;">ğŸ“¸ Work Gallery</h3>
          <div id="profileGallery" style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;"></div>
          <div id="profileNoGallery" style="display:none;font-size:13px;color:var(--muted);">No photos uploaded yet.</div>
        </div>

        <!-- REVIEWS -->
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:22px;">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px;">
            <h3 style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;">â­ Reviews</h3>
            <div id="profileRatingBig" style="font-family:'Playfair Display',serif;font-size:26px;font-weight:900;color:var(--accent);"></div>
          </div>
          <div id="profileReviews"></div>
          <div id="profileReviewForm"></div>
        </div>
      </div>

      <!-- RIGHT STICKY -->
      <div style="position:sticky;top:90px;display:flex;flex-direction:column;gap:16px;">
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:22px;">
          <h3 style="font-family:'Playfair Display',serif;font-size:17px;font-weight:700;margin-bottom:16px;">ğŸ“© Send Enquiry</h3>
          <div id="profileEnquiryForm"></div>
        </div>
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:22px;">
          <h3 style="font-family:'Playfair Display',serif;font-size:17px;font-weight:700;margin-bottom:16px;">ğŸ“‹ Contact Info</h3>
          <div id="profileContactInfo"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* ====== PROFILE PAGE ====== */
let currentProfileOrg=null;

function openProfilePage(o){
  currentProfileOrg=o;
  hideAllPages();
  document.getElementById('profilePage').classList.remove('hidden');
  window.scrollTo(0,0);

  // HERO IMAGE
  document.getElementById('profileHeroImg').src=o.photo||'';

  // THUMBNAILS
  const thumbs=document.getElementById('profileThumbs');
  thumbs.innerHTML='';
  if(o.photos&&o.photos.length>1){
    o.photos.forEach((p,i)=>{
      const img=document.createElement('img');
      img.src=p;
      img.style.cssText=`width:52px;height:52px;object-fit:cover;border-radius:8px;cursor:pointer;border:2px solid ${i===0?'var(--accent)':'rgba(255,255,255,0.3)'};transition:all 0.2s;`;
      img.onclick=()=>{
        document.getElementById('profileHeroImg').src=p;
        thumbs.querySelectorAll('img').forEach(t=>t.style.borderColor='rgba(255,255,255,0.3)');
        img.style.borderColor='var(--accent)';
      };
      thumbs.appendChild(img);
    });
  }

  // CATEGORY
  document.getElementById('profileCategory').innerHTML=o.category?`<span class="badge">${o.category}</span>`:'';

  // NAME
  document.getElementById('profileName').textContent=o.name;

  // META
  document.getElementById('profileLocation').innerHTML=o.location?`ğŸ“ ${o.location}`:'';
  document.getElementById('profileExp').innerHTML=o.experience?`ğŸ† ${o.experience} yrs experience`:'';

  // STARS
  const stars=renderStars(o.rating||0);
  document.getElementById('profileStars').innerHTML=`<span style="color:var(--accent);font-size:15px;letter-spacing:2px;">${stars}</span> <span style="font-size:12px;color:var(--muted);">${o.rating?o.rating.toFixed(1)+' ('+o.reviewCount+' reviews)':'No reviews yet'}</span>`;

  // PRICE
  const p=document.getElementById('profilePriceText');
  if(o.priceMin||o.priceMax){
    p.textContent=`â‚¹${Number(o.priceMin||0).toLocaleString()} â€“ â‚¹${Number(o.priceMax||0).toLocaleString()}`;
  } else {
    p.textContent='Contact for pricing';
    p.style.fontSize='14px';
  }

  // ACTION BUTTONS
  const isOwner=o.owner===currentUser?.email;
  document.getElementById('profileActions').innerHTML=`
    ${!isOwner?`<button class="btn-primary btn-sm" onclick="document.getElementById('profileEnquiryForm').scrollIntoView({behavior:'smooth'})">ğŸ“© Send Enquiry</button>`:''}
    <a href="tel:${o.phone}" class="btn-secondary btn-sm" style="text-decoration:none;">ğŸ“ Call Now</a>
    <a href="https://wa.me/91${(o.whatsapp||o.phone).replace(/\D/g,'')}" target="_blank" class="btn-secondary btn-sm" style="background:rgba(37,211,102,0.1);border-color:rgba(37,211,102,0.3);color:#25d366;text-decoration:none;">ğŸ’¬ WhatsApp</a>
    ${isOwner?`<button class="btn-danger btn-sm" onclick="deleteOrg('${o.id}')">ğŸ—‘ Delete</button>`:''}
  `;

  // BIO
  document.getElementById('profileBio').textContent=o.bio||'No description provided.';

  // SERVICES
  const allCats=['Wedding','Corporate','Birthday','Concert','Sports','Conference','Social'];
  const svcs=document.getElementById('profileServices');
  if(o.category){
    svcs.innerHTML=allCats.map(c=>`
      <span style="padding:7px 16px;border-radius:20px;font-size:13px;font-weight:500;
        background:${c===o.category?'var(--accent)':'var(--surface2)'};
        color:${c===o.category?'#0a0a0f':'var(--muted)'};
        border:1px solid ${c===o.category?'var(--accent)':'var(--border)'};">
        ${c}
      </span>`).join('');
  } else {
    svcs.innerHTML='<span style="color:var(--muted);font-size:13px;">Not specified</span>';
  }

  // GALLERY
  const gallery=document.getElementById('profileGallery');
  const noGallery=document.getElementById('profileNoGallery');
  gallery.innerHTML='';
  if(o.photos&&o.photos.length>0){
    noGallery.style.display='none';
    o.photos.forEach(p=>{
      const div=document.createElement('div');
      div.style.cssText='aspect-ratio:1;overflow:hidden;border-radius:10px;cursor:pointer;';
      div.innerHTML=`<img src="${p}" style="width:100%;height:100%;object-fit:cover;transition:transform 0.3s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'" onclick="document.getElementById('profileHeroImg').src='${p}';window.scrollTo(0,0);">`;
      gallery.appendChild(div);
    });
  } else {
    noGallery.style.display='block';
  }

  // CONTACT INFO
  document.getElementById('profileContactInfo').innerHTML=`
    <div style="display:flex;flex-direction:column;gap:12px;">
      <div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface2);border-radius:10px;">
        <span style="font-size:18px;">ğŸ“</span>
        <div><div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">Phone</div>
        <div style="font-size:14px;font-weight:600;">${o.phone}</div></div>
      </div>
      <div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface2);border-radius:10px;">
        <span style="font-size:18px;">ğŸ’¬</span>
        <div><div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">WhatsApp</div>
        <div style="font-size:14px;font-weight:600;color:#25d366;">${o.whatsapp||o.phone}</div></div>
      </div>
      <div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface2);border-radius:10px;">
        <span style="font-size:18px;">âœ‰</span>
        <div><div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">Email</div>
        <div style="font-size:13px;font-weight:600;word-break:break-all;">${o.email}</div></div>
      </div>
      ${o.location?`<div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface2);border-radius:10px;">
        <span style="font-size:18px;">ğŸ“</span>
        <div><div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">Location</div>
        <div style="font-size:14px;font-weight:600;">${o.location}</div></div>
      </div>`:''}
    </div>`;

  // LOAD REVIEWS
  loadProfileReviews(o);

  // ENQUIRY FORM
  if(!isOwner){
    document.getElementById('profileEnquiryForm').innerHTML=`
      <div class="form-group"><input type="text" id="penqName" placeholder="Your name" value="${currentUser.email.split('@')[0]}" style="width:100%;padding:11px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;outline:none;"></div>
      <div class="form-group" style="margin-top:10px;"><input type="tel" id="penqPhone" placeholder="Your phone / WhatsApp" style="width:100%;padding:11px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;outline:none;"></div>
      <div class="form-group" style="margin-top:10px;"><textarea id="penqMsg" rows="4" placeholder="Describe your event â€” date, type, guests..." style="width:100%;padding:11px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;outline:none;resize:vertical;"></textarea></div>
      <button class="btn-primary" style="margin-top:12px;" onclick="sendProfileEnquiry('${o.id}','${o.owner}','${o.name}')">Send Message â†’</button>`;
  } else {
    document.getElementById('profileEnquiryForm').innerHTML=`<p style="font-size:13px;color:var(--muted);">This is your own listing.</p>`;
  }
}

async function loadProfileReviews(o){
  const isOwner=o.owner===currentUser?.email;
  const snap=await db.collection('reviews').where('orgId','==',o.id).orderBy('createdAt','desc').limit(10).get();
  const reviews=[];
  snap.forEach(d=>reviews.push(d.data()));

  const ratingBig=document.getElementById('profileRatingBig');
  ratingBig.textContent=o.rating?o.rating.toFixed(1)+' â˜…':'â€”';

  const rv=document.getElementById('profileReviews');
  rv.innerHTML=reviews.length?reviews.map(r=>`
    <div style="background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:10px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;">
        <span style="font-size:13px;font-weight:600;">${r.authorName||r.authorEmail.split('@')[0]}</span>
        <span style="color:var(--accent);font-size:13px;">${'â˜…'.repeat(r.rating)}${'â˜†'.repeat(5-r.rating)} <span style="color:var(--muted);font-size:11px;">${r.createdAt?.toDate?.()?.toLocaleDateString()||''}</span></span>
      </div>
      <div style="font-size:13px;color:var(--muted);line-height:1.6;">${r.text}</div>
    </div>`).join('')
  :'<p style="font-size:13px;color:var(--muted);margin-bottom:16px;">No reviews yet. Be the first!</p>';

  if(!isOwner){
    document.getElementById('profileReviewForm').innerHTML=`
      <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border);">
        <div style="font-size:13px;font-weight:600;margin-bottom:10px;">Leave a Review</div>
        <div style="display:flex;gap:6px;margin-bottom:10px;font-size:24px;cursor:pointer;" id="pStarPicker">
          <span onclick="setPStar(1)" style="opacity:0.3;transition:0.15s;">â˜…</span>
          <span onclick="setPStar(2)" style="opacity:0.3;transition:0.15s;">â˜…</span>
          <span onclick="setPStar(3)" style="opacity:0.3;transition:0.15s;">â˜…</span>
          <span onclick="setPStar(4)" style="opacity:0.3;transition:0.15s;">â˜…</span>
          <span onclick="setPStar(5)" style="opacity:0.3;transition:0.15s;">â˜…</span>
        </div>
        <textarea id="pReviewText" rows="3" placeholder="Share your experience..." style="width:100%;padding:11px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;outline:none;resize:vertical;margin-bottom:10px;"></textarea>
        <button class="btn-purple btn-sm" onclick="submitProfileReview('${o.id}','${o.owner}','${o.name}')">Submit Review</button>
      </div>`;
  }
}

let pSelectedStar=0;
function setPStar(n){
  pSelectedStar=n;
  document.querySelectorAll('#pStarPicker span').forEach((s,i)=>{
    s.style.opacity=i<n?'1':'0.3';
    s.style.color=i<n?'var(--accent)':'var(--text)';
  });
}

async function submitProfileReview(orgId,orgOwner,orgName){
  if(!pSelectedStar){showToast('Please select a star rating','error'); return;}
  const text=document.getElementById('pReviewText').value.trim();
  if(!text){showToast('Please write something','error'); return;}
  await db.collection('reviews').add({
    orgId,orgOwner,orgName,rating:pSelectedStar,text,
    authorEmail:currentUser.email,
    authorName:currentUser.email.split('@')[0],
    createdAt:new Date()
  });
  const allRev=await db.collection('reviews').where('orgId','==',orgId).get();
  let total=0; allRev.forEach(d=>total+=d.data().rating);
  await db.collection('organizers').doc(orgId).update({rating:total/allRev.size,reviewCount:allRev.size});
  showToast('â­ Review submitted!');
  const updated={...currentProfileOrg,rating:total/allRev.size,reviewCount:allRev.size};
  currentProfileOrg=updated;
  loadProfileReviews(updated);
  loadOrganizers();
}

async function sendProfileEnquiry(orgId,toEmail,toName){
  const msg=document.getElementById('penqMsg').value.trim();
  if(!msg){showToast('Please write a message','error'); return;}
  await db.collection('enquiries').add({
    orgId,toEmail,toName,
    fromEmail:currentUser.email,
    fromName:document.getElementById('penqName').value.trim(),
    fromPhone:document.getElementById('penqPhone').value.trim(),
    message:msg,
    createdAt:new Date()
  });
  showToast('ğŸ“© Enquiry sent!');
  document.getElementById('penqMsg').value='';
  document.getElementById('penqPhone').value='';
}

function closeProfilePage(){
  document.getElementById('profilePage').classList.add('hidden');
  document.getElementById('customer').classList.remove('hidden');
  window.scrollTo(0,0);
}
</script>

<!-- ===== VENDOR PAGE (Photographer / Makeup / Return Gifts) ===== -->
<div class="hidden" id="vendor" style="position:relative;z-index:5;padding:20px 12px 80px;display:flex;justify-content:center;">
  <div style="width:100%;max-width:720px;">
    <div class="panel-header">
      <div class="panel-back" onclick="showSection('home')">â†</div>
      <div><div class="panel-title">Creative <span>Professionals</span></div></div>
    </div>

    <!-- TYPE SELECTOR -->
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:24px;">
      <button class="vendor-type-btn active" onclick="selectVendorType('photographer',this)">ğŸ“¸ Photographer</button>
      <button class="vendor-type-btn" onclick="selectVendorType('makeup',this)">ğŸ’„ Makeup Artist</button>
      <button class="vendor-type-btn" onclick="selectVendorType('gifts',this)">ğŸ Return Gifts</button>
    </div>

    <!-- FORM -->
    <div class="glass-card">
      <div id="vendorTypeLabel" style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;margin-bottom:18px;color:var(--accent);">ğŸ“¸ Photographer Registration</div>
      <form id="vendorForm">
        <div class="form-row">
          <div class="form-group">
            <label>Your Name</label>
            <input type="text" id="vName" placeholder="Full name" required>
          </div>
          <div class="form-group">
            <label>Company / Brand Name <span style="font-size:11px;color:var(--muted);">(optional)</span></label>
            <input type="text" id="vCompany" placeholder="Studio / brand name">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Phone Number</label>
            <input type="tel" id="vPhone" placeholder="+91 00000 00000" required>
          </div>
          <div class="form-group">
            <label>WhatsApp Number</label>
            <input type="tel" id="vWhatsapp" placeholder="+91 WhatsApp number">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="vEmail" placeholder="your@email.com" required>
          </div>
          <div class="form-group">
            <label>Existing Website <span style="font-size:11px;color:var(--muted);">(optional)</span></label>
            <input type="url" id="vWebsite" placeholder="https://yourwebsite.com">
          </div>
        </div>
        <div class="form-group">
          <label>Location / City</label>
          <input type="text" id="vLocation" placeholder="e.g. Midnapore, Kolkata..." required>
        </div>
        <div class="form-group">
          <label>Bio / Description</label>
          <textarea id="vBio" rows="3" placeholder="Tell clients about your work and experience..."></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Years of Experience</label>
            <input type="number" id="vExp" placeholder="e.g. 3" min="0">
          </div>
          <div class="form-group" id="vSpecialtyGroup">
            <label id="vSpecialtyLabel">Specialty</label>
            <input type="text" id="vSpecialty" placeholder="e.g. Wedding, Portrait, Fashion">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Min Price (â‚¹)</label>
            <input type="number" id="vPriceMin" placeholder="e.g. 5000" min="0">
          </div>
          <div class="form-group">
            <label>Max Price (â‚¹)</label>
            <input type="number" id="vPriceMax" placeholder="e.g. 50000" min="0">
          </div>
        </div>
        <div class="form-group">
          <label>Work Portfolio â€” Google Drive Link <span style="font-size:11px;color:var(--muted);">(optional)</span></label>
          <input type="url" id="vDriveLink" placeholder="https://drive.google.com/drive/folders/...">
          <div style="font-size:12px;color:var(--muted);margin-top:6px;">ğŸ“‚ Set sharing to "Anyone with link" then paste here.</div>
        </div>
        <div class="form-group" id="vPhotoGroup">
          <label>Work Photos <span style="font-size:11px;color:var(--muted);">(max 5 photos â€” only for Photographer & Makeup)</span></label>
          <div id="vPhotoDropzone" onclick="document.getElementById('vPhotos').click()" style="border:2px dashed var(--border);border-radius:14px;padding:28px;text-align:center;cursor:pointer;transition:all 0.2s;background:var(--surface2);" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">
            <div style="font-size:32px;margin-bottom:8px;">ğŸ“·</div>
            <div style="font-size:14px;font-weight:600;margin-bottom:4px;">Click to select photos</div>
            <div style="font-size:12px;color:var(--muted);">JPG, PNG â€” max 5 photos</div>
            <input type="file" id="vPhotos" accept="image/*" multiple style="display:none;" onchange="previewVendorPhotos(this)">
          </div>
          <!-- PREVIEW GRID -->
          <div id="vPhotosPreview" style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:12px;"></div>
          <div id="vPhotoCount" style="font-size:12px;color:var(--muted);margin-top:6px;"></div>
        </div>
        <button type="submit" class="btn-primary" style="margin-top:8px;">âœ¦ Publish Profile</button>
      </form>
    </div>

    <!-- MY VENDOR LISTINGS -->
    <div style="margin-top:28px;">
      <div style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;margin-bottom:14px;">My Listings</div>
      <div id="myVendorList"><div class="loading-dots"><span></span><span></span><span></span></div></div>
    </div>
  </div>
</div>

<style>
.vendor-type-btn {
  padding: 10px 20px; border-radius: 20px; border: 1.5px solid var(--border);
  background: var(--surface); color: var(--muted);
  font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600;
  cursor: pointer; transition: all 0.2s;
}
.vendor-type-btn.active, .vendor-type-btn:hover {
  background: rgba(201,168,76,0.12); border-color: var(--accent); color: var(--accent);
}
</style>

<script>
/* ====== VENDOR PAGE ====== */
let currentVendorType = 'photographer';

function selectVendorType(type, btn){
  currentVendorType = type;
  document.querySelectorAll('.vendor-type-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const labels = {
    photographer: { title:'ğŸ“¸ Photographer Registration', specialty:'Specialty', specialtyPlaceholder:'e.g. Wedding, Portrait, Fashion' },
    makeup:       { title:'ğŸ’„ Makeup Artist Registration', specialty:'Makeup Specialty', specialtyPlaceholder:'e.g. Bridal, Party, HD Makeup' },
    gifts:        { title:'ğŸ Return Gifts / Wedding Favors Registration', specialty:'Products Offered', specialtyPlaceholder:'e.g. Gift hampers, Dry fruits, Customized gifts' }
  };
  const l = labels[type];
  document.getElementById('vendorTypeLabel').textContent = l.title;
  document.getElementById('vSpecialtyLabel').textContent = l.specialty;
  document.getElementById('vSpecialty').placeholder = l.specialtyPlaceholder;
  // Hide photo upload for gifts, show for photographer & makeup
  const photoGroup = document.getElementById('vPhotoGroup');
  if(photoGroup) photoGroup.style.display = type==='gifts' ? 'none' : 'block';
  loadMyVendorListings();
}

function previewVendorPhotos(input){
  const files = Array.from(input.files);
  if(files.length > 5){
    showToast('Max 5 photos allowed!','error');
    input.value='';
    return;
  }
  const preview = document.getElementById('vPhotosPreview');
  const count = document.getElementById('vPhotoCount');
  preview.innerHTML = '';
  count.textContent = `${files.length} photo${files.length>1?'s':''} selected`;

  files.forEach((file, i) => {
    const reader = new FileReader();
    reader.onload = e => {
      const wrap = document.createElement('div');
      wrap.style.cssText = 'position:relative;aspect-ratio:1;overflow:hidden;border-radius:10px;border:2px solid var(--border);';
      wrap.innerHTML = `
        <img src="${e.target.result}" style="width:100%;height:100%;object-fit:cover;">
        ${i===0?'<div style="position:absolute;bottom:3px;left:50%;transform:translateX(-50%);background:var(--accent);color:#000;font-size:9px;font-weight:700;padding:2px 6px;border-radius:4px;white-space:nowrap;">COVER</div>':''}
        <button type="button" onclick="removeVendorPhoto(${i})" style="position:absolute;top:3px;right:3px;background:rgba(0,0,0,0.6);border:none;color:#fff;width:20px;height:20px;border-radius:50%;font-size:11px;cursor:pointer;display:flex;align-items:center;justify-content:center;line-height:1;">âœ•</button>`;
      preview.appendChild(wrap);
    };
    reader.readAsDataURL(file);
  });
}

function removeVendorPhoto(index){
  const input = document.getElementById('vPhotos');
  const dt = new DataTransfer();
  Array.from(input.files).forEach((f, i) => { if(i !== index) dt.items.add(f); });
  input.files = dt.files;
  previewVendorPhotos(input);
}

document.getElementById('showSection') || null;

// Show vendor page
const _origShowSection = window.showSection;
window.showSection = function(id){
  if(id==='vendor'){
    hideAllPages();
    document.getElementById('vendor').classList.remove('hidden');
    window.scrollTo(0,0);
    loadMyVendorListings();
    return;
  }
  _origShowSection(id);
};

// Vendor form submit
document.getElementById('vendorForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const driveLink = document.getElementById('vDriveLink').value.trim();
  if(driveLink && !driveLink.includes('drive.google.com')){
    showToast('Please enter a valid Google Drive link','error'); return;
  }
  const btn = e.target.querySelector('button[type=submit]');
  btn.disabled=true;

  // Read + COMPRESS photos (max 800px wide, quality 0.7)
  let photos = [];
  const photoFiles = document.getElementById('vPhotos').files;
  if(photoFiles.length > 0 && currentVendorType !== 'gifts'){
    // max 5 photos, all parallel
    btn.textContent = "Compressing...";

    const compressPhoto = (file) => new Promise(res => {
      const img = new Image();
      const url = URL.createObjectURL(file);
      img.onload = () => {
        const MAX = 600;
        let w = img.width, h = img.height;
        if(w > MAX){ h = Math.round(h * MAX / w); w = MAX; }
        const canvas = document.createElement('canvas');
        canvas.width = w; canvas.height = h;
        canvas.getContext('2d').drawImage(img, 0, 0, w, h);
        URL.revokeObjectURL(url);
        res(canvas.toDataURL('image/jpeg', 0.5));
      };
      img.src = url;
    });

    photos = await Promise.all(Array.from(photoFiles).slice(0,5).map(compressPhoto));
  }

  btn.textContent = 'Saving...';
  await db.collection('vendors').add({
    type: currentVendorType,
    name: document.getElementById('vName').value,
    company: document.getElementById('vCompany').value||'',
    phone: document.getElementById('vPhone').value,
    whatsapp: document.getElementById('vWhatsapp').value || document.getElementById('vPhone').value,
    email: document.getElementById('vEmail').value,
    website: document.getElementById('vWebsite').value||'',
    location: document.getElementById('vLocation').value,
    bio: document.getElementById('vBio').value||'',
    experience: document.getElementById('vExp').value||'',
    specialty: document.getElementById('vSpecialty').value||'',
    priceMin: document.getElementById('vPriceMin').value||0,
    priceMax: document.getElementById('vPriceMax').value||0,
    driveLink: driveLink,
    photos: photos,
    photo: photos[0]||'',
    owner: currentUser.email,
    rating:0, reviewCount:0,
    createdAt: new Date()
  });

  document.getElementById('vendorForm').reset();
  document.getElementById('vPhotosPreview').innerHTML='';
  document.getElementById('vPhotoCount').textContent='';
  btn.textContent='âœ¦ Publish Profile'; btn.disabled=false;
  showToast('âœ¦ Profile published!');
  loadMyVendorListings();
});

async function loadMyVendorListings(){
  const el=document.getElementById('myVendorList');
  if(!el) return;
  el.innerHTML='<div class="loading-dots"><span></span><span></span><span></span></div>';
  const snap=await db.collection('vendors').where('owner','==',currentUser.email).get();
  if(snap.empty){el.innerHTML='<p style="color:var(--muted);font-size:14px;">No listings yet.</p>'; return;}
  el.innerHTML='';
  snap.forEach(doc=>{
    const v={id:doc.id,...doc.data()};
    const typeIcon={photographer:'ğŸ“¸',makeup:'ğŸ’„',gifts:'ğŸ'}[v.type]||'âœ¨';
    const div=document.createElement('div');
    div.style.cssText='background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:12px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;';
    div.innerHTML=`
      <div>
        <div style="font-size:13px;color:var(--accent);font-weight:600;margin-bottom:4px;">${typeIcon} ${v.type.charAt(0).toUpperCase()+v.type.slice(1)}</div>
        <div style="font-family:'Playfair Display',serif;font-weight:700;font-size:16px;">${v.name}${v.company?' â€” '+v.company:''}</div>
        <div style="font-size:13px;color:var(--muted);margin-top:3px;">ğŸ“ ${v.location} &nbsp;|&nbsp; ğŸ“ ${v.phone}</div>
        ${v.driveLink?`<a href="${v.driveLink}" target="_blank" style="font-size:12px;color:var(--accent3);text-decoration:none;margin-top:4px;display:inline-block;">ğŸ“‚ View Portfolio â†’</a>`:''}
      </div>
      <button onclick="deleteVendor('${v.id}')" class="btn-danger btn-sm">Delete</button>`;
    el.appendChild(div);
  });
}

async function deleteVendor(id){
  if(!confirm('Delete this listing?')) return;
  await db.collection('vendors').doc(id).delete();
  showToast('Deleted!');
  loadMyVendorListings();
}
</script>

<script>
/* ====== VENDOR BROWSING (Customer Side) ====== */
let allVendors=[];

function filterVendors(type, btn){
  document.querySelectorAll('#vendorFilterBtns .vendor-type-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  loadVendors(type);
}

async function loadVendors(type){
  const el=document.getElementById('vendorList');
  el.innerHTML='<div class="loading-dots"><span></span><span></span><span></span></div>';
  try{
    const snap=await db.collection('vendors').get();
    allVendors=[];
    snap.forEach(doc=>allVendors.push({id:doc.id,...doc.data()}));
    const filtered=type==='all'?allVendors:allVendors.filter(v=>v.type===type);
    renderVendors(filtered);
  }catch(err){
    el.innerHTML=`<p style="color:var(--muted);font-size:14px;">Error: ${err.message}</p>`;
  }
}

function renderVendors(list){
  const el=document.getElementById('vendorList');
  el.innerHTML='';
  if(!list.length){el.innerHTML='<div class="empty-state"><span class="empty-icon">ğŸ”</span><p>No listings found.</p></div>'; return;}
  const typeIcon={photographer:'ğŸ“¸',makeup:'ğŸ’„',gifts:'ğŸ'};
  const typeColor={photographer:'rgba(201,168,76,0.1)',makeup:'rgba(232,101,74,0.1)',gifts:'rgba(78,203,113,0.1)'};
  list.forEach(v=>{
    const card=document.createElement('div');
    card.style.cssText='background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:20px;margin-bottom:14px;transition:all 0.2s;cursor:pointer;';
    card.onmouseover=()=>card.style.borderColor='rgba(201,168,76,0.3)';
    card.onmouseout=()=>card.style.borderColor='rgba(255,255,255,0.07)';
    // Card click opens vendor profile
    card.onclick=(e)=>{
      if(e.target.tagName==='A'||e.target.closest('a')) return; // don't intercept link clicks
      openVendorProfile(v);
    };
    const stars='â˜…'.repeat(Math.round(v.rating||0))+'â˜†'.repeat(5-Math.round(v.rating||0));
    card.innerHTML=`
      <div style="display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:10px;">
        <div style="flex:1;">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap;">
            <span style="padding:4px 12px;border-radius:20px;font-size:11px;font-weight:700;background:${typeColor[v.type]||'rgba(201,168,76,0.1)'};color:var(--accent);">${typeIcon[v.type]||'âœ¨'} ${v.type.charAt(0).toUpperCase()+v.type.slice(1)}</span>
            ${v.specialty?`<span style="padding:4px 10px;border-radius:20px;font-size:11px;background:var(--surface2);color:var(--muted);">${v.specialty}</span>`:''}
          </div>
          <div style="font-family:'Playfair Display',serif;font-size:20px;font-weight:700;margin-bottom:4px;">${v.name}${v.company?` <span style="font-size:14px;font-weight:400;color:var(--muted);">â€” ${v.company}</span>`:''}</div>
          <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;font-size:13px;color:var(--muted);margin-bottom:10px;">
            <span>ğŸ“ ${v.location}</span>
            ${v.experience?`<span>ğŸ† ${v.experience} yrs</span>`:''}
            <span style="color:var(--accent);">${stars} <span style="color:var(--muted);">${v.reviewCount?'('+v.reviewCount+')':'No reviews'}</span></span>
          </div>
          ${v.bio?`<p style="font-size:13px;color:var(--muted);line-height:1.6;margin-bottom:12px;">${v.bio.slice(0,120)}${v.bio.length>120?'...':''}</p>`:''}
          ${v.photos&&v.photos.length>0?`
          <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;">
            ${v.photos.slice(0,5).map((p,i)=>`<img src="${p}" style="width:56px;height:56px;object-fit:cover;border-radius:8px;border:2px solid ${i===0?'var(--accent)':'var(--border)'};" title="Photo ${i+1}">`).join('')}
          </div>`:''}
          <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
            ${v.priceMin||v.priceMax?`<span style="font-size:13px;font-weight:600;color:var(--accent);">â‚¹${Number(v.priceMin||0).toLocaleString()} â€“ â‚¹${Number(v.priceMax||0).toLocaleString()}</span>`:''}
            ${v.driveLink?`<a href="${v.driveLink}" target="_blank" onclick="event.stopPropagation()" style="font-size:12px;color:#4ecb71;text-decoration:none;background:rgba(78,203,113,0.1);border:1px solid rgba(78,203,113,0.25);padding:5px 14px;border-radius:20px;font-weight:600;">ğŸ“‚ View Portfolio â†’</a>`:''}
            ${v.website?`<a href="${v.website}" target="_blank" onclick="event.stopPropagation()" style="font-size:12px;color:var(--muted);text-decoration:none;background:var(--surface2);border:1px solid var(--border);padding:5px 14px;border-radius:20px;">ğŸŒ Website</a>`:''}
          </div>
        </div>
        <div style="display:flex;flex-direction:column;gap:8px;min-width:120px;">
          <a href="tel:${v.phone}" onclick="event.stopPropagation()" style="padding:8px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;font-size:12px;font-weight:600;text-decoration:none;color:var(--text);text-align:center;">ğŸ“ Call</a>
          <a href="https://wa.me/91${(v.whatsapp||v.phone).replace(/\D/g,'')}" target="_blank" onclick="event.stopPropagation()" style="padding:8px 16px;background:rgba(37,211,102,0.1);border:1px solid rgba(37,211,102,0.25);border-radius:8px;font-size:12px;font-weight:600;text-decoration:none;color:#25d366;text-align:center;">ğŸ’¬ WhatsApp</a>
          ${v.email?`<a href="mailto:${v.email}" onclick="event.stopPropagation()" style="padding:8px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;font-size:12px;font-weight:600;text-decoration:none;color:var(--text);text-align:center;">âœ‰ Email</a>`:''}
          <button onclick="event.stopPropagation();openVendorProfile(allVendors.find(x=>x.id==='${v.id}'))" style="padding:8px 16px;background:rgba(201,168,76,0.1);border:1px solid rgba(201,168,76,0.25);border-radius:8px;font-size:12px;font-weight:600;color:var(--accent);cursor:pointer;">View Profile â†’</button>
        </div>
      </div>`;
    el.appendChild(card);
  });
}

/* ====== VENDOR PROFILE PAGE ====== */
let currentVendorProfile = null;

function openVendorProfile(v){
  currentVendorProfile = v;
  hideAllPages();
  const typeIcon={photographer:'ğŸ“¸',makeup:'ğŸ’„',gifts:'ğŸ'};
  const stars='â˜…'.repeat(Math.round(v.rating||0))+'â˜†'.repeat(5-Math.round(v.rating||0));

  // Build page
  let page = document.getElementById('vendorProfilePage');
  if(!page){
    page = document.createElement('div');
    page.id = 'vendorProfilePage';
    page.style.cssText='position:relative;z-index:5;padding:20px 12px 80px;display:flex;justify-content:center;min-height:100vh;';
    document.body.appendChild(page);
  }
  page.style.display='flex';

  const photosHtml = v.photos&&v.photos.length>0 ? `
    <div style="margin-bottom:24px;">
      <img id="vpMainPhoto" src="${v.photos[0]}" style="width:100%;max-height:360px;object-fit:cover;border-radius:16px;margin-bottom:10px;">
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        ${v.photos.map((p,i)=>`<img src="${p}" onclick="document.getElementById('vpMainPhoto').src='${p}'" style="width:70px;height:70px;object-fit:cover;border-radius:10px;border:2px solid ${i===0?'var(--accent)':'var(--border)'};cursor:pointer;transition:border 0.2s;" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='${i===0?'var(--accent)':'var(--border)'}'">`).join('')}
      </div>
    </div>` : '';

  page.innerHTML = `
  <div style="width:100%;max-width:780px;">
    <div class="panel-header">
      <div class="panel-back" onclick="closeVendorProfile()">â†</div>
      <div><div class="panel-title">${typeIcon[v.type]||'âœ¨'} <span>${v.type.charAt(0).toUpperCase()+v.type.slice(1)} Profile</span></div></div>
    </div>

    ${photosHtml}

    <div class="glass-card" style="margin-bottom:16px;">
      <div style="display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:12px;margin-bottom:16px;">
        <div>
          <div style="font-family:'Playfair Display',serif;font-size:28px;font-weight:900;margin-bottom:4px;">${v.name}</div>
          ${v.company?`<div style="font-size:14px;color:var(--muted);margin-bottom:8px;">${v.company}</div>`:''}
          <div style="display:flex;gap:12px;flex-wrap:wrap;font-size:13px;color:var(--muted);">
            <span>ğŸ“ ${v.location}</span>
            ${v.experience?`<span>ğŸ† ${v.experience} years exp</span>`:''}
            ${v.specialty?`<span>ğŸ¯ ${v.specialty}</span>`:''}
          </div>
        </div>
        ${v.priceMin||v.priceMax?`<div style="text-align:right;"><div style="font-size:11px;color:var(--muted);margin-bottom:2px;">Price Range</div><div style="font-family:'Playfair Display',serif;font-size:20px;font-weight:700;color:var(--accent);">â‚¹${Number(v.priceMin||0).toLocaleString()} â€“ â‚¹${Number(v.priceMax||0).toLocaleString()}</div></div>`:''}
      </div>
      <div style="color:var(--accent);font-size:16px;margin-bottom:4px;">${stars} <span style="font-size:13px;color:var(--muted);">${v.reviewCount?'('+v.reviewCount+' reviews)':'No reviews yet'}</span></div>
      ${v.bio?`<p style="font-size:14px;color:var(--muted);line-height:1.7;margin-top:12px;padding-top:12px;border-top:1px solid var(--border);">${v.bio}</p>`:''}
    </div>

    <!-- CONTACT CARD -->
    <div class="glass-card" style="margin-bottom:16px;">
      <div style="font-family:'Playfair Display',serif;font-weight:700;font-size:16px;margin-bottom:16px;">Contact</div>
      <div style="display:flex;flex-direction:column;gap:10px;">
        <a href="tel:${v.phone}" style="display:flex;align-items:center;gap:10px;padding:12px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;text-decoration:none;color:var(--text);">
          <span style="font-size:18px;">ğŸ“</span><div><div style="font-size:11px;color:var(--muted);">Phone</div><div style="font-weight:600;">${v.phone}</div></div>
        </a>
        <a href="https://wa.me/91${(v.whatsapp||v.phone).replace(/\D/g,'')}" target="_blank" style="display:flex;align-items:center;gap:10px;padding:12px 16px;background:rgba(37,211,102,0.08);border:1px solid rgba(37,211,102,0.2);border-radius:10px;text-decoration:none;color:#25d366;">
          <span style="font-size:18px;">ğŸ’¬</span><div><div style="font-size:11px;color:var(--muted);">WhatsApp</div><div style="font-weight:600;">${v.whatsapp||v.phone}</div></div>
        </a>
        ${v.email?`<a href="mailto:${v.email}" style="display:flex;align-items:center;gap:10px;padding:12px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;text-decoration:none;color:var(--text);">
          <span style="font-size:18px;">âœ‰</span><div><div style="font-size:11px;color:var(--muted);">Email</div><div style="font-weight:600;">${v.email}</div></div>
        </a>`:''}
        ${v.driveLink?`<a href="${v.driveLink}" target="_blank" style="display:flex;align-items:center;gap:10px;padding:12px 16px;background:rgba(78,203,113,0.08);border:1px solid rgba(78,203,113,0.25);border-radius:10px;text-decoration:none;color:#4ecb71;">
          <span style="font-size:18px;">ğŸ“‚</span><div><div style="font-size:11px;color:var(--muted);">Portfolio</div><div style="font-weight:600;">View on Google Drive â†’</div></div>
        </a>`:''}
        ${v.website?`<a href="${v.website}" target="_blank" style="display:flex;align-items:center;gap:10px;padding:12px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;text-decoration:none;color:var(--text);">
          <span style="font-size:18px;">ğŸŒ</span><div><div style="font-size:11px;color:var(--muted);">Website</div><div style="font-weight:600;">${v.website}</div></div>
        </a>`:''}
      </div>
    </div>
  </div>`;

  window.scrollTo(0,0);
}

function closeVendorProfile(){
  const page = document.getElementById('vendorProfilePage');
  if(page) page.style.display='none';
  showSection('customer');
  // Re-open vendors tab
  setTimeout(()=>{
    const tabs = document.querySelectorAll('#customer .tab');
    tabs.forEach(t=>{ if(t.textContent.includes('Photographers')) t.click(); });
  }, 100);
}
</script>
