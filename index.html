<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event Organizer Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">

<style>
body {font-family:'Poppins',sans-serif;margin:0;background:#f5f6fa;transition:.3s}
header {background:#111;color:#fff;padding:15px;text-align:center}
.container {padding:20px;text-align:center}
button {padding:12px 20px;margin:10px;font-size:16px;cursor:pointer;border:none;border-radius:6px;background:#111;color:#fff}
button:hover{background:#333}
form {max-width:420px;margin:auto;text-align:left}
input {width:100%;padding:10px;margin:6px 0;border-radius:6px;border:1px solid #ccc}
.card {background:#fff;padding:15px;margin:12px auto;max-width:420px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.15);transition:.3s}
.card:hover{transform:scale(1.02)}
img {max-width:100%;border-radius:10px}
.hidden {display:none}
.error{color:red;font-size:14px;margin-top:5px}
.switch{color:#007bff;cursor:pointer;text-decoration:underline}
.showpass{font-size:13px;margin-top:5px}
.dark{background:#111;color:#eee}
.dark .card{background:#1e1e1e;color:#eee}
.search{padding:10px;border-radius:6px;border:1px solid #ccc;width:250px;margin-bottom:15px}
</style>
</head>
<body>

<header>
<h2>Event Organizer Hub</h2>
<button onclick="toggleDark()">Toggle Dark Mode</button>
</header>

<div class="container" id="auth">
<h3 id="authTitle">Register First</h3>
<form id="authForm">
<input type="email" id="authEmail" placeholder="Email" required>
<input type="password" id="authPass" placeholder="Password (min 6 characters)" required>
<label class="showpass"><input type="checkbox" onclick="togglePassword()"> Show Password</label>
<div class="error" id="errorMsg"></div>
<button type="submit" id="authBtn">Register</button>
</form>
<p class="switch" onclick="toggleAuth()" id="switchText">Already registered? Login</p>
</div>

<div class="container hidden" id="home">
<h3>Select Option</h3>
<button onclick="showOrganizer()">Organizer Panel</button>
<button onclick="showCustomer()">Customer View</button>
<button onclick="logout()">Logout</button>
</div>

<div class="container hidden" id="organizer">
<h3>Organizer Upload</h3>
<form id="orgForm">
<input type="text" id="name" placeholder="Organizer Name" required>
<input type="tel" id="phone" placeholder="Phone Number" required>
<input type="email" id="email" placeholder="Email" required>
<input type="file" id="photo" accept="image/*" required>
<button type="submit">Upload</button>
</form>
<button onclick="goHome()">Back</button>
</div>

<div class="container hidden" id="customer">
<h3>Organizers List</h3>
<input class="search" id="search" placeholder="Search organizer..." onkeyup="searchOrganizer()">
<div id="list">Loading organizers...</div>
<button onclick="goHome()">Back</button>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>

const firebaseConfig={
 apiKey:"AIzaSyBNW3y2zR8xQmhrOWqXzu8dmFRMYdSRSFM",
 authDomain:"rd-eventsphere.firebaseapp.com",
 projectId:"rd-eventsphere",
 storageBucket:"rd-eventsphere.firebasestorage.app",
 messagingSenderId:"9010232288",
 appId:"1:9010232288:web:f5e77bb53311acef97c985"
};

firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();

const authDiv=document.getElementById('auth');
const home=document.getElementById('home');
const organizer=document.getElementById('organizer');
const customer=document.getElementById('customer');
const list=document.getElementById('list');

let isLogin=false;

// DARK MODE SAVE
if(localStorage.getItem('darkMode')==='true') document.body.classList.add('dark');
function toggleDark(){
 document.body.classList.toggle('dark');
 localStorage.setItem('darkMode',document.body.classList.contains('dark'));
}

function togglePassword(){
 const pass=document.getElementById('authPass');
 pass.type=pass.type==='password'?'text':'password';
}

function toggleAuth(){
 isLogin=!isLogin;
 document.getElementById('authTitle').innerText=isLogin?"Login":"Register First";
 document.getElementById('authBtn').innerText=isLogin?"Login":"Register";
 document.getElementById('switchText').innerText=isLogin?
 "New user? Register first":"Already registered? Login";
 document.getElementById('errorMsg').innerText="";
}

firebase.auth().onAuthStateChanged(user=>{
 if(user){ authDiv.classList.add('hidden'); home.classList.remove('hidden'); }
 else{ authDiv.classList.remove('hidden'); home.classList.add('hidden'); }
});

// AUTH

document.getElementById('authForm').addEventListener('submit',async e=>{
 e.preventDefault();
 const email=authEmail.value;
 const pass=authPass.value;
 const error=document.getElementById('errorMsg');

 if(pass.length<6){ error.innerText="Password must be at least 6 characters"; return; }

 try{
  if(isLogin){ await auth.signInWithEmailAndPassword(email,pass); }
  else{ await auth.createUserWithEmailAndPassword(email,pass); toggleAuth(); }
 }catch(err){ error.innerText=err.message; }
});

function logout(){ auth.signOut(); }

function goHome(){ home.classList.remove('hidden'); organizer.classList.add('hidden'); customer.classList.add('hidden'); }
function showOrganizer(){ home.classList.add('hidden'); organizer.classList.remove('hidden'); }
function showCustomer(){ home.classList.add('hidden'); customer.classList.remove('hidden'); loadOrganizers(); }

// UPLOAD WITH RESET

document.getElementById('orgForm').addEventListener('submit',e=>{
 e.preventDefault();

 const nameVal=name.value;
 const phoneVal=phone.value;
 const emailVal=email.value;
 const file=photo.files[0];

 if(!file){ alert("Select image first"); return; }

 const reader=new FileReader();
 reader.onload=async()=>{
  await db.collection('organizers').add({
   name:nameVal,phone:phoneVal,email:emailVal,
   photo:reader.result,owner:auth.currentUser.email,
   createdAt:new Date()
  });

  document.getElementById('orgForm').reset();
  alert('Uploaded Successfully');
  goHome();
 };
 reader.readAsDataURL(file);
});

// LOAD ORGANIZERS WITH DELETE OPTION

async function loadOrganizers(){
 list.innerHTML='Loading...';
 const snap=await db.collection('organizers').orderBy('createdAt','desc').get();
 list.innerHTML='';
 snap.forEach(doc=>{
  const o=doc.data();
  const owner=o.owner===auth.currentUser?.email;

  list.innerHTML+=`
  <div class='card'>
   <img src='${o.photo}'>
   <h4>${o.name}</h4>
   <p>${o.phone}</p>
   <p>${o.email}</p>
   ${owner?`<button onclick="deleteOrganizer('${doc.id}')">Delete</button>`:''}
  </div>`;
 });
}

async function deleteOrganizer(id){
 if(confirm('Delete this organizer?')){
  await db.collection('organizers').doc(id).delete();
  loadOrganizers();
 }
}

function searchOrganizer(){
 const term=document.getElementById('search').value.toLowerCase();
 document.querySelectorAll('.card').forEach(c=>{
  c.style.display=c.innerText.toLowerCase().includes(term)?'block':'none';
 });
}

</script>
</body>
</html>
