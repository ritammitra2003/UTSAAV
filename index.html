<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Utsaav ‚Äî Event Organizer Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FZNP5DN2WM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-FZNP5DN2WM');

  // Helper to track events easily
  function trackEvent(action, category, label) {
    if (typeof gtag !== 'undefined') {
      gtag('event', action, {
        event_category: category,
        event_label: label
      });
    }
  }
</script>

<style>
:root {
  --bg: #0a0a0f;
  --surface: #11111a;
  --surface2: #1a1a28;
  --surface3: #22223a;
  --border: rgba(255,255,255,0.07);
  --border2: rgba(255,255,255,0.12);
  --accent: #c9a84c;
  --accent2: #7b5ea7;
  --accent3: #4c9ac9;
  --text: #f0ede8;
  --muted: #8a8698;
  --danger: #e05c5c;
  --success: #5cb85c;
  --glow: rgba(201,168,76,0.15);
  --glow2: rgba(123,94,167,0.15);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background:
    radial-gradient(ellipse 80% 60% at 20% -10%, rgba(123,94,167,0.18) 0%, transparent 60%),
    radial-gradient(ellipse 60% 50% at 80% 110%, rgba(201,168,76,0.12) 0%, transparent 55%);
  pointer-events: none;
  z-index: 0;
}

header {
  position: sticky;
  top: 0;
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 40px;
  border-bottom: 1px solid var(--border);
  backdrop-filter: blur(20px);
  background: rgba(10,10,15,0.8);
}
.logo { display: flex; align-items: center; gap: 10px; cursor: pointer; }
.logo-text {
  font-family: 'Playfair Display', serif;
  font-size: 20px; font-weight: 700;
}
.logo-text span { color: var(--accent); }

.header-right { display: flex; align-items: center; gap: 10px; }
.user-chip {
  display: flex; align-items: center; gap: 8px;
  padding: 7px 14px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 20px;
  font-size: 13px;
  color: var(--muted);
}
.user-chip .dot {
  width: 7px; height: 7px;
  background: var(--success);
  border-radius: 50%;
}
.icon-btn {
  width: 36px; height: 36px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  font-size: 16px;
  transition: all 0.2s;
  color: var(--muted);
}
.icon-btn:hover { border-color: var(--accent); color: var(--accent); }

.page {
  position: relative;
  z-index: 5;
  min-height: calc(100vh - 67px);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
}
.hidden { display: none !important; }
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}
.fade-in { animation: fadeUp 0.45s ease forwards; }

.glass-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 32px;
  box-shadow: 0 24px 64px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05);
}

.form-group { margin-bottom: 16px; }
.form-group label {
  display: block;
  font-size: 11px; font-weight: 600;
  letter-spacing: 1.4px;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 6px;
}
.form-group input,
.form-group textarea,
.form-group select {
  width: 100%;
  padding: 12px 15px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 10px;
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  font-size: 14px;
  transition: all 0.2s;
  outline: none;
  resize: vertical;
}
.form-group select option { background: var(--surface2); }
.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--glow);
}
.form-group input::placeholder,
.form-group textarea::placeholder { color: var(--muted); }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }

.btn-primary {
  display: inline-flex; align-items: center; justify-content: center; gap: 7px;
  width: 100%; padding: 13px;
  background: linear-gradient(135deg, var(--accent), #b8912f);
  color: #0a0a0f;
  border: none; border-radius: 10px;
  font-family: 'DM Sans', sans-serif;
  font-size: 15px; font-weight: 600;
  cursor: pointer; letter-spacing: 0.2px;
  transition: all 0.2s;
}
.btn-primary:hover { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(201,168,76,0.3); }
.btn-primary:active { transform: translateY(0); }

.btn-secondary {
  display: inline-flex; align-items: center; justify-content: center; gap: 7px;
  padding: 11px 20px;
  background: var(--surface2);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 10px;
  font-family: 'DM Sans', sans-serif;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s;
}
.btn-secondary:hover { border-color: var(--accent); color: var(--accent); }

.btn-purple {
  display: inline-flex; align-items: center; justify-content: center; gap: 7px;
  padding: 11px 20px;
  background: rgba(123,94,167,0.15);
  color: #b89fd4;
  border: 1px solid rgba(123,94,167,0.3);
  border-radius: 10px;
  font-family: 'DM Sans', sans-serif;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s;
}
.btn-purple:hover { background: rgba(123,94,167,0.25); border-color: var(--accent2); }

.btn-danger {
  display: inline-flex; align-items: center; justify-content: center; gap: 5px;
  padding: 8px 14px;
  background: transparent; color: var(--danger);
  border: 1px solid rgba(224,92,92,0.3);
  border-radius: 8px;
  font-family: 'DM Sans', sans-serif;
  font-size: 13px; cursor: pointer;
  transition: all 0.2s;
}
.btn-danger:hover { background: rgba(224,92,92,0.1); border-color: var(--danger); }

.btn-admin {
  display: inline-flex; align-items: center; justify-content: center; gap: 7px;
  padding: 9px 18px;
  background: linear-gradient(135deg, rgba(224,92,92,0.2), rgba(201,168,76,0.2));
  color: #e8a87c;
  border: 1px solid rgba(224,150,92,0.4);
  border-radius: 10px;
  font-family: 'DM Sans', sans-serif;
  font-size: 13px; font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  letter-spacing: 0.5px;
}
.btn-admin:hover { background: linear-gradient(135deg, rgba(224,92,92,0.3), rgba(201,168,76,0.3)); border-color: rgba(224,150,92,0.7); }

.btn-sm {
  padding: 7px 14px !important;
  font-size: 13px !important;
  width: auto !important;
}

.auth-wrap { width: 100%; max-width: 440px; }
.auth-head { margin-bottom: 28px; }
.auth-head h1 {
  font-family: 'Playfair Display', serif;
  font-size: 38px; font-weight: 900; line-height: 1.1; margin-bottom: 8px;
}
.auth-head h1 em { font-style: italic; color: var(--accent); }
.auth-head p { color: var(--muted); font-size: 14px; }
.showpass-label {
  display: flex; align-items: center; gap: 8px;
  font-size: 13px; color: var(--muted); cursor: pointer; margin-bottom: 14px;
}
.showpass-label input { width: auto; margin: 0; }
.error { color: #e07070; font-size: 12px; margin-bottom: 10px; min-height: 18px; }
.divider { height: 1px; background: var(--border); margin: 20px 0; }
.switch-link { text-align: center; font-size: 13px; color: var(--muted); }
.switch-link a { color: var(--accent); cursor: pointer; font-weight: 600; }
.switch-link a:hover { text-decoration: underline; }

.home-wrap { width: 100%; max-width: 600px; text-align: center; }
.home-title {
  font-family: 'Playfair Display', serif;
  font-size: 52px; font-weight: 900; line-height: 1.05; margin-bottom: 12px;
}
.home-title em { font-style: italic; color: var(--accent); }
.home-sub { color: var(--muted); font-size: 15px; margin-bottom: 42px; font-weight: 300; }
.option-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 18px; }
.option-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 18px;
  padding: 30px 20px;
  cursor: pointer;
  transition: all 0.25s;
  position: relative; overflow: hidden;
}
.option-card::before {
  content: ''; position: absolute; inset: 0; opacity: 0; transition: opacity 0.25s;
}
.option-card.o-opt::before { background: radial-gradient(ellipse at 50% 0%, rgba(201,168,76,0.12) 0%, transparent 70%); }
.option-card.c-opt::before { background: radial-gradient(ellipse at 50% 0%, rgba(123,94,167,0.15) 0%, transparent 70%); }
.option-card.a-opt::before { background: radial-gradient(ellipse at 50% 0%, rgba(224,92,92,0.15) 0%, transparent 70%); }
.option-card:hover { transform: translateY(-3px); }
.option-card:hover::before { opacity: 1; }
.option-card.o-opt:hover { border-color: var(--accent); box-shadow: 0 12px 32px rgba(201,168,76,0.12); }
.option-card.c-opt:hover { border-color: var(--accent2); box-shadow: 0 12px 32px rgba(123,94,167,0.12); }
.option-card.a-opt:hover { border-color: #e05c5c; box-shadow: 0 12px 32px rgba(224,92,92,0.15); }
.opt-icon { font-size: 38px; margin-bottom: 12px; display: block; }
.opt-title { font-family: 'Playfair Display', serif; font-size: 18px; font-weight: 700; margin-bottom: 5px; }
.opt-desc { font-size: 12px; color: var(--muted); }

.cat-chip {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 8px 14px; border-radius: 20px;
  background: var(--surface2); border: 1.5px solid var(--border);
  font-size: 13px; cursor: pointer; transition: all 0.2s;
  user-select: none; color: var(--text);
}
.cat-chip input[type=checkbox] { display: none; }
.cat-chip.selected {
  background: rgba(201,168,76,0.15);
  border-color: var(--accent);
  color: var(--accent);
  font-weight: 600;
}

.badge {
  display: inline-block; padding: 4px 12px;
  border-radius: 20px; font-size: 11px;
  letter-spacing: 0.5px; font-weight: 600;
  background: rgba(201,168,76,0.1);
  color: var(--accent);
  border: 1px solid rgba(201,168,76,0.2);
  margin-bottom: 14px;
}
.badge-purple { background: rgba(123,94,167,0.1); color: #b89fd4; border-color: rgba(123,94,167,0.25); }
.badge-blue { background: rgba(76,154,201,0.1); color: #7fc3e8; border-color: rgba(76,154,201,0.25); }
.badge-green { background: rgba(92,184,92,0.1); color: #7ed37e; border-color: rgba(92,184,92,0.25); }
.badge-red { background: rgba(224,92,92,0.1); color: #e88e8e; border-color: rgba(224,92,92,0.25); }

.panel-wrap { width: 100%; max-width: 560px; }
.panel-header { display: flex; align-items: center; gap: 14px; margin-bottom: 26px; }
.panel-back {
  width: 38px; height: 38px; flex-shrink: 0;
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 10px; display: flex; align-items: center; justify-content: center;
  cursor: pointer; transition: all 0.2s; font-size: 16px;
}
.panel-back:hover { border-color: var(--accent); color: var(--accent); }
.panel-title { font-family: 'Playfair Display', serif; font-size: 26px; font-weight: 900; }
.panel-title span { color: var(--accent); }

.tabs {
  display: flex; gap: 4px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 4px;
  margin-bottom: 26px;
}
.tab {
  flex: 1; padding: 9px 14px;
  text-align: center; font-size: 13px; font-weight: 500;
  border-radius: 9px; cursor: pointer;
  transition: all 0.2s; color: var(--muted);
  border: none; background: transparent; font-family: 'DM Sans', sans-serif;
}
.tab.active { background: var(--surface); color: var(--text); box-shadow: 0 2px 8px rgba(0,0,0,0.3); }

.dash-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 12px; margin-bottom: 24px; }
.stat-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 14px; padding: 18px 16px;
  text-align: center; transition: all 0.2s;
}
.stat-card:hover { border-color: var(--border2); transform: translateY(-2px); }
.stat-num {
  font-family: 'Playfair Display', serif;
  font-size: 32px; font-weight: 900; color: var(--accent);
  line-height: 1;
}
.stat-label { font-size: 11px; color: var(--muted); margin-top: 5px; letter-spacing: 0.5px; text-transform: uppercase; }

.customer-wrap { width: 100%; max-width: 900px; }
.search-sort-row { display: flex; gap: 12px; margin-bottom: 24px; align-items: center; }
.search-bar { position: relative; flex: 1; }
.search-bar input {
  width: 100%; padding: 12px 15px 12px 44px;
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 12px; color: var(--text);
  font-family: 'DM Sans', sans-serif; font-size: 14px;
  outline: none; transition: all 0.2s;
}
.search-bar input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--glow); }
.search-bar input::placeholder { color: var(--muted); }
.search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--muted); font-size: 16px; pointer-events: none; }
.sort-select {
  padding: 12px 15px;
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 12px; color: var(--text);
  font-family: 'DM Sans', sans-serif; font-size: 13px;
  outline: none; cursor: pointer; transition: all 0.2s;
}
.sort-select:focus { border-color: var(--accent); }

.cat-pills { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 22px; }
.cat-pill {
  padding: 6px 14px; border-radius: 20px;
  font-size: 12px; font-weight: 500; cursor: pointer;
  border: 1px solid var(--border); color: var(--muted);
  background: var(--surface); transition: all 0.18s;
}
.cat-pill:hover { border-color: var(--border2); color: var(--text); }
.cat-pill.active { background: var(--accent); color: #0a0a0f; border-color: var(--accent); font-weight: 600; }

.org-grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap: 16px; }
.org-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 18px; overflow: hidden;
  transition: all 0.25s; cursor: pointer; position: relative;
}
.org-card:hover { transform: translateY(-4px); border-color: rgba(255,255,255,0.12); box-shadow: 0 16px 40px rgba(0,0,0,0.4); }
.org-img-wrap { aspect-ratio: 4/3; overflow: hidden; background: var(--surface2); position: relative; }
.org-img-wrap img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s; }
.org-card:hover .org-img-wrap img { transform: scale(1.06); }
.cat-tag {
  position: absolute; bottom: 10px; left: 10px;
  padding: 4px 10px; border-radius: 20px;
  font-size: 11px; font-weight: 600;
  backdrop-filter: blur(8px);
  background: rgba(10,10,15,0.75);
  color: var(--accent); border: 1px solid rgba(201,168,76,0.3);
}
.org-body { padding: 16px; }
.org-name { font-family: 'Playfair Display', serif; font-size: 17px; font-weight: 700; margin-bottom: 5px; }
.org-meta { font-size: 12px; color: var(--muted); margin-bottom: 3px; display: flex; align-items: center; gap: 5px; }
.stars { color: var(--accent); font-size: 13px; letter-spacing: 1px; }
.stars-count { font-size: 11px; color: var(--muted); }
.org-footer {
  padding: 12px 16px; border-top: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
}

/* ===== CLOUDINARY UPLOAD PROGRESS ===== */
.upload-progress-wrap {
  margin-top: 10px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 12px 16px;
  display: none;
}
.upload-progress-wrap.visible { display: block; }
.upload-progress-bar-bg {
  background: var(--surface3);
  border-radius: 6px;
  height: 6px;
  margin-top: 8px;
  overflow: hidden;
}
.upload-progress-bar {
  height: 6px;
  background: linear-gradient(90deg, var(--accent), #f0c060);
  border-radius: 6px;
  transition: width 0.3s ease;
  width: 0%;
}
.upload-progress-text { font-size: 12px; color: var(--muted); display: flex; align-items: center; justify-content: space-between; }
.upload-status-icon { font-size: 14px; }

.modal-overlay {
  position: fixed; inset: 0; z-index: 200;
  background: rgba(0,0,0,0.75); backdrop-filter: blur(8px);
  display: flex; align-items: center; justify-content: center;
  padding: 20px;
  animation: fadeIn 0.2s ease;
}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.modal {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 22px; width: 100%; max-width: 560px;
  max-height: 90vh; overflow-y: auto;
  box-shadow: 0 32px 80px rgba(0,0,0,0.6);
  animation: modalPop 0.3s cubic-bezier(0.16,1,0.3,1);
}
@keyframes modalPop {
  from { opacity: 0; transform: scale(0.92) translateY(20px); }
  to   { opacity: 1; transform: scale(1) translateY(0); }
}
.modal-img { width: 100%; height: 240px; object-fit: cover; border-radius: 18px 18px 0 0; }
.modal-body { padding: 28px; }
.modal-name { font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 900; margin-bottom: 4px; }
.modal-close {
  position: absolute; top: 16px; right: 16px;
  width: 32px; height: 32px;
  background: rgba(0,0,0,0.5); backdrop-filter: blur(8px);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 50%; display: flex; align-items: center; justify-content: center;
  cursor: pointer; font-size: 14px; transition: all 0.2s;
  color: #fff;
}
.modal-close:hover { background: var(--danger); border-color: var(--danger); }
.modal-img-wrap { position: relative; }
.info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 18px 0; }
.info-item {
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 12px; padding: 14px;
}
.info-item-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); margin-bottom: 4px; }
.info-item-value { font-size: 14px; font-weight: 500; word-break: break-all; }
.modal-actions { display: flex; gap: 10px; margin-top: 20px; }
.modal-actions .btn-primary { flex: 1; }
.modal-actions .btn-secondary { flex: 1; }

.reviews-section { margin-top: 22px; }
.reviews-section h4 { font-family: 'Playfair Display', serif; font-size: 16px; margin-bottom: 14px; }
.review-card {
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 12px; padding: 14px; margin-bottom: 10px;
}
.review-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 7px; }
.review-author { font-size: 13px; font-weight: 600; }
.review-date { font-size: 11px; color: var(--muted); }
.review-text { font-size: 13px; color: var(--muted); line-height: 1.5; }
.review-form { margin-top: 14px; }
.star-picker { display: flex; gap: 5px; margin-bottom: 10px; font-size: 22px; cursor: pointer; }
.star-picker span { opacity: 0.3; transition: opacity 0.15s; }
.star-picker span.lit { opacity: 1; color: var(--accent); }

.enquiry-form { margin-top: 20px; border-top: 1px solid var(--border); padding-top: 20px; }
.enquiry-form h4 { font-family: 'Playfair Display', serif; font-size: 16px; margin-bottom: 14px; }

.loading-dots { display: flex; gap: 6px; justify-content: center; padding: 40px; grid-column: 1/-1; }
.loading-dots span {
  width: 9px; height: 9px; border-radius: 50%; background: var(--accent);
  animation: bounce 1.2s ease-in-out infinite;
}
.loading-dots span:nth-child(2) { animation-delay: 0.2s; }
.loading-dots span:nth-child(3) { animation-delay: 0.4s; }
@keyframes bounce {
  0%,80%,100% { transform: scale(0.4); opacity: 0.3; }
  40% { transform: scale(1); opacity: 1; }
}

.empty-state {
  text-align: center; padding: 60px 20px;
  color: var(--muted); grid-column: 1/-1;
}
.empty-icon { font-size: 48px; opacity: 0.3; display: block; margin-bottom: 14px; }
.empty-state p { font-size: 15px; }

.toast {
  position: fixed; bottom: 28px; right: 28px;
  padding: 13px 20px; border-radius: 12px;
  font-size: 14px; z-index: 9999;
  box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  transform: translateY(70px); opacity: 0;
  transition: all 0.3s cubic-bezier(0.16,1,0.3,1);
  max-width: 320px;
}
.toast.show { transform: translateY(0); opacity: 1; }
.toast.success { background: var(--surface); border: 1px solid var(--accent); color: var(--text); }
.toast.error-t { background: var(--surface); border: 1px solid var(--danger); color: var(--text); }

.verify-wrap { width: 100%; max-width: 440px; text-align: center; }
.verify-icon { font-size: 64px; margin-bottom: 20px; display: block; animation: float 3s ease-in-out infinite; }
@keyframes float {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}
.verify-title { font-family: 'Playfair Display', serif; font-size: 32px; font-weight: 900; margin-bottom: 10px; }
.verify-title em { font-style: italic; color: var(--accent); }
.verify-sub { color: var(--muted); font-size: 14px; line-height: 1.7; margin-bottom: 28px; }
.verify-email-badge {
  display: inline-block; padding: 8px 18px;
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 20px; font-size: 14px; font-weight: 600;
  color: var(--accent); margin-bottom: 28px;
}
.verify-steps { text-align: left; margin-bottom: 28px; }
.verify-step {
  display: flex; align-items: flex-start; gap: 12px;
  padding: 12px 0; border-bottom: 1px solid var(--border);
}
.verify-step:last-child { border-bottom: none; }
.step-num {
  width: 26px; height: 26px; flex-shrink: 0;
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 50%; display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 700; color: var(--accent);
}
.step-text { font-size: 13px; color: var(--muted); line-height: 1.5; padding-top: 3px; }
.verify-btns { display: flex; flex-direction: column; gap: 10px; }
.resend-timer { font-size: 12px; color: var(--muted); margin-top: 8px; }

/* ====== ADMIN STYLES ====== */
.admin-wrap { width: 100%; max-width: 1100px; }
.admin-section {
  background: var(--surface); border: 1px solid rgba(224,92,92,0.2);
  border-radius: 16px; padding: 22px; margin-bottom: 20px;
}
.admin-section-title {
  font-family: 'Playfair Display', serif; font-size: 18px; font-weight: 700;
  margin-bottom: 16px; color: #e8a87c;
  display: flex; align-items: center; gap: 10px;
}
.admin-item {
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 12px; padding: 16px; margin-bottom: 10px;
  display: flex; align-items: flex-start; justify-content: space-between; gap: 12px; flex-wrap: wrap;
}
.admin-item-info { flex: 1; min-width: 200px; }
.admin-item-name { font-weight: 700; font-size: 15px; margin-bottom: 4px; }
.admin-item-meta { font-size: 12px; color: var(--muted); line-height: 1.6; }
.admin-item-actions { display: flex; gap: 8px; flex-wrap: wrap; align-items: flex-start; flex-shrink: 0; }
.admin-stats-row { display: grid; grid-template-columns: repeat(5,1fr); gap: 10px; margin-bottom: 24px; }
.admin-stat {
  background: var(--surface); border: 1px solid rgba(224,92,92,0.15);
  border-radius: 12px; padding: 16px; text-align: center;
}
.admin-stat-num { font-family:'Playfair Display',serif; font-size:28px; font-weight:900; color:#e8a87c; }
.admin-stat-label { font-size:10px; color:var(--muted); text-transform:uppercase; letter-spacing:0.5px; margin-top:4px; }

/* ===== CLOUDINARY INFO BOX ===== */
.cloudinary-info {
  display: flex; align-items: center; gap: 10px;
  background: rgba(76,203,113,0.08);
  border: 1px solid rgba(76,203,113,0.2);
  border-radius: 10px; padding: 10px 14px;
  margin-bottom: 14px; font-size: 12px; color: #4ecb71;
}

body.light {
  --bg: #f0ece4;
  --surface: #ffffff;
  --surface2: #f5f0e8;
  --surface3: #ede8df;
  --border: rgba(0,0,0,0.08);
  --border2: rgba(0,0,0,0.14);
  --text: #1a1a2e;
  --muted: #7a7590;
  --glow: rgba(201,168,76,0.12);
}
body.light::before { opacity: 0.5; }
body.light header { background: rgba(240,236,228,0.85); }

.vendor-type-btn {
  padding: 10px 20px; border-radius: 20px; border: 1.5px solid var(--border);
  background: var(--surface); color: var(--muted);
  font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600;
  cursor: pointer; transition: all 0.2s;
}
.vendor-type-btn.active, .vendor-type-btn:hover {
  background: rgba(201,168,76,0.12); border-color: var(--accent); color: var(--accent);
}
.event-card { background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:20px;transition:all 0.2s;cursor:pointer; }
.event-card:hover { transform:translateY(-3px);border-color:var(--border2);box-shadow:0 12px 32px rgba(0,0,0,0.3); }
.event-date-badge { display:inline-flex;flex-direction:column;align-items:center;width:52px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:6px 8px;margin-bottom:14px; }
.event-date-badge .month { font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--accent);font-weight:600; }
.event-date-badge .day { font-size:22px;font-weight:900;font-family:'Playfair Display',serif;line-height:1; }
.event-title { font-family:'Playfair Display',serif;font-size:17px;font-weight:700;margin-bottom:6px; }
.event-meta { font-size:12px;color:var(--muted);margin-bottom:3px;display:flex;align-items:center;gap:5px; }
.event-price { font-size:18px;font-weight:700;color:var(--accent);margin-top:12px; }
.event-price span { font-size:12px;color:var(--muted);font-weight:400; }
.events-grid { display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px; }
.enquiry-item { background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:18px;margin-bottom:12px; }
.enquiry-to { font-size:13px;color:var(--muted);margin-bottom:5px; }
.enquiry-msg { font-size:14px;line-height:1.5; }
.enquiry-status { display:inline-block;margin-top:10px;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:600;background:rgba(201,168,76,0.1);color:var(--accent);border:1px solid rgba(201,168,76,0.2); }

@media(max-width:640px){
  header { padding: 12px 16px; }
  header .logo svg { height: 32px !important; width: auto !important; }
  .home-title { font-size: 28px; }
  .home-sub { font-size: 14px; }
  .option-cards { grid-template-columns: 1fr 1fr !important; gap: 10px !important; }
  .option-card { padding: 16px 12px !important; }
  .opt-icon { font-size: 26px !important; }
  .opt-title { font-size: 13px !important; }
  .opt-desc { font-size: 11px !important; display: none; }
  .org-grid { grid-template-columns: 1fr !important; }
  .dash-grid { grid-template-columns: repeat(2,1fr); }
  .form-row { grid-template-columns: 1fr !important; }
  .search-sort-row { flex-wrap: wrap; }
  .info-grid { grid-template-columns: 1fr; }
  .modal-actions { flex-direction: column; }
  .modal { margin: 12px !important; max-width: calc(100vw - 24px) !important; }
  .modal-body { padding: 20px 18px !important; }
  .tabs { overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
  .tabs::-webkit-scrollbar { display: none; }
  .tab { display: inline-block; font-size: 12px !important; padding: 8px 12px !important; }
  .page { padding: 14px 10px !important; }
  .customer-wrap { width: 100% !important; padding: 0 !important; }
  .glass-card { padding: 14px !important; }
  .panel-header { margin-bottom: 14px; }
  .admin-stats-row { grid-template-columns: repeat(2,1fr); }
  .admin-item { flex-direction: column !important; gap: 12px !important; }
  .auth-wrap { padding: 24px 20px !important; }
  .auth-head { margin-bottom: 20px !important; }
  .btn-primary, .btn-secondary { padding: 12px 18px !important; font-size: 14px !important; }
  .home-wrap { padding: 20px 16px !important; }
  .vendor-card { padding: 14px !important; }
  .stat-card { padding: 14px 10px !important; }
  .stat-num { font-size: 28px !important; }
}

@media(max-width:400px){
  .option-cards { grid-template-columns: 1fr 1fr !important; }
  .opt-title { font-size: 12px !important; }
  .home-title { font-size: 24px; }
}
</style>
</head>
<body>

<div class="toast" id="toast"></div>
<div id="modalContainer"></div>

<header>
  <div class="logo" onclick="handleLogoClick()" style="cursor:pointer;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 520 160" height="44" width="143">
      <defs>
        <linearGradient id="iG" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#FF6B6B"/>
          <stop offset="35%" style="stop-color:#FF8E53"/>
          <stop offset="70%" style="stop-color:#FFC837"/>
          <stop offset="100%" style="stop-color:#FF6B9D"/>
        </linearGradient>
        <linearGradient id="tG" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" style="stop-color:#FF6B6B"/>
          <stop offset="50%" style="stop-color:#FFC837"/>
          <stop offset="100%" style="stop-color:#FF6B9D"/>
        </linearGradient>
        <filter id="hGlow"><feGaussianBlur stdDeviation="3" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
        <filter id="hShadow"><feDropShadow dx="0" dy="3" stdDeviation="5" flood-color="#FF6B6B" flood-opacity="0.25"/></filter>
        <filter id="hIG"><feGaussianBlur stdDeviation="4" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <circle cx="78" cy="80" r="58" fill="none" stroke="url(#iG)" stroke-width="1.5" opacity="0.3"/>
      <circle cx="78" cy="80" r="46" fill="#0a0a0f" filter="url(#hShadow)"/>
      <circle cx="78" cy="80" r="46" fill="url(#iG)" opacity="0.12"/>
      <circle cx="78" cy="80" r="44" fill="none" stroke="url(#iG)" stroke-width="1.5" opacity="0.9"/>
      <circle cx="78" cy="34" r="2.5" fill="url(#iG)" opacity="0.9"/>
      <circle cx="78" cy="126" r="2.5" fill="url(#iG)" opacity="0.9"/>
      <circle cx="32" cy="80" r="2.5" fill="url(#iG)" opacity="0.9"/>
      <circle cx="124" cy="80" r="2.5" fill="url(#iG)" opacity="0.9"/>
      <path d="M 55 52 L 55 88 Q 55 108 78 108 Q 101 108 101 88 L 101 52" fill="none" stroke="url(#iG)" stroke-width="7" stroke-linecap="round" filter="url(#hIG)"/>
      <g transform="translate(52,46)" filter="url(#hGlow)"><path d="M0,-6 L1.5,-1.5 L6,0 L1.5,1.5 L0,6 L-1.5,1.5 L-6,0 L-1.5,-1.5 Z" fill="#FFC837"/></g>
      <g transform="translate(104,46)" filter="url(#hGlow)"><path d="M0,-5 L1.2,-1.2 L5,0 L1.2,1.2 L0,5 L-1.2,1.2 L-5,0 L-1.2,-1.2 Z" fill="#FF6B9D"/></g>
      <g transform="translate(78,38)" filter="url(#hGlow)"><path d="M0,-4 L1,-1 L4,0 L1,1 L0,4 L-1,1 L-4,0 L-1,-1 Z" fill="#FF8E53" opacity="0.9"/></g>
      <text x="168" y="95" font-family="Georgia,'Times New Roman',serif" font-size="58" font-weight="700" letter-spacing="4" fill="url(#tG)" filter="url(#hShadow)">UTSAAV</text>
      <text x="170" y="118" font-family="Georgia,serif" font-size="12" letter-spacing="5" fill="#666">EVENT MANAGEMENT</text>
      <line x1="170" y1="126" x2="390" y2="126" stroke="url(#tG)" stroke-width="0.8" opacity="0.4"/>
    </svg>
  </div>
  <div class="header-right" id="headerRight">
    <div class="icon-btn" onclick="toggleDark()" title="Toggle theme">üåô</div>
  </div>
</header>

<!-- AUTH -->
<div class="page" id="auth">
  <div class="auth-wrap fade-in">
    <div class="auth-head">
      <div class="badge">‚ú¶ Utsaav ‚Äî Event Management</div>
      <h1 id="authTitle">Welcome <em>Back.</em></h1>
      <p id="authSubtitle">Login to access your organizer hub.</p>
    </div>
    <div class="glass-card">
      <form id="authForm">
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="authEmail" placeholder="you@example.com" required>
        </div>
        <div class="form-group hidden" id="nameGroup">
          <label>Full Name</label>
          <input type="text" id="authName" placeholder="Apna poora naam likhein">
        </div>
        <div class="form-group hidden" id="phoneGroup" style="display:none!important;">
          <input type="tel" id="authPhone">
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="authPass" placeholder="Minimum 6 characters" required>
        </div>
        <label class="showpass-label">
          <input type="checkbox" onclick="togglePass()"> Show password
        </label>
        <div class="error" id="errorMsg"></div>
        <button type="submit" class="btn-primary" id="authBtn">Login ‚Üí</button>
      </form>
      <div class="divider"></div>
      <div class="switch-link">
        <span id="switchPre">New here? </span>
        <a onclick="toggleAuth()" id="switchLink">Create an account</a>
      </div>
    </div>
  </div>
</div>

<!-- VERIFY EMAIL -->
<div class="page hidden" id="verifyEmail">
  <div class="verify-wrap fade-in">
    <span class="verify-icon">üìß</span>
    <h1 class="verify-title">Check your <em>inbox.</em></h1>
    <p class="verify-sub">We've sent a verification link to:</p>
    <div class="verify-email-badge" id="verifyEmailBadge"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="78150a0a110c191515110c0a19381f15191114561b1715">[email&#160;protected]</a></div>
    <div class="glass-card" style="margin-bottom:20px;">
      <div class="verify-steps">
        <div class="verify-step">
          <div class="step-num">1</div>
          <div class="step-text">Open the email we sent you <strong style="color:var(--accent);">(‚ö†Ô∏è Check your Spam / Junk folder!)</strong></div>
        </div>
        <div class="verify-step">
          <div class="step-num">2</div>
          <div class="step-text">Click the <strong>"Verify your email"</strong> link inside</div>
        </div>
        <div class="verify-step">
          <div class="step-num">3</div>
          <div class="step-text">Come back here and click <strong>"I've verified"</strong> below</div>
        </div>
      </div>
      <div class="verify-btns">
        <button class="btn-primary" onclick="checkVerified()">‚úì I've verified my email</button>
        <button class="btn-secondary" onclick="resendVerification()" id="resendBtn">Resend email</button>
      </div>
      <div class="resend-timer" id="resendTimer"></div>
    </div>
    <button class="btn-secondary" style="width:100%;" onclick="auth.signOut()">‚Üê Use a different account</button>
  </div>
</div>

<!-- HOME -->
<div class="page hidden" id="home">
  <div class="home-wrap fade-in">
    <div class="badge">‚ú¶ Welcome back</div>
    <h1 class="home-title" id="homeTitle">Welcome to <em>Utsaav.</em></h1>
    <p class="home-sub">India's event organizer discovery platform. What would you like to do?</p>
    <div class="option-cards" style="grid-template-columns:1fr;">
      <div class="option-card o-opt" onclick="showRolePopup('organizer')">
        <span class="opt-icon">üé≠</span>
        <div class="opt-title">Organizer</div>
        <div class="opt-desc">List your event business, post events & get enquiries</div>
      </div>
    </div>
    <div class="option-cards" style="grid-template-columns:1fr 1fr 1fr;margin-bottom:18px;">
      <div class="option-card" onclick="showRolePopup('photographer')" style="padding:20px 14px;">
        <span class="opt-icon" style="font-size:28px;">üì∏</span>
        <div class="opt-title" style="font-size:14px;">Photographer</div>
        <div class="opt-desc" style="font-size:12px;">Photography services</div>
      </div>
      <div class="option-card" onclick="showRolePopup('makeup')" style="padding:20px 14px;">
        <span class="opt-icon" style="font-size:28px;">üíÑ</span>
        <div class="opt-title" style="font-size:14px;">Makeup Artist</div>
        <div class="opt-desc" style="font-size:12px;">Makeup & beauty services</div>
      </div>
      <div class="option-card" onclick="showRolePopup('gifts')" style="padding:20px 14px;">
        <span class="opt-icon" style="font-size:28px;">üéÅ</span>
        <div class="opt-title" style="font-size:14px;">Return Gifts</div>
        <div class="opt-desc" style="font-size:12px;">Wedding favors & hampers</div>
      </div>
    </div>
    <div id="adminHomeBtn" class="hidden" style="margin-bottom:18px;">
      <div class="option-card a-opt" onclick="showSection('admin')" style="grid-column:1/-1;">
        <span class="opt-icon">üõ°Ô∏è</span>
        <div class="opt-title" style="color:#e8a87c;">Admin Panel</div>
        <div class="opt-desc">Manage all listings, delete content, add on behalf of others</div>
      </div>
    </div>
    <button class="btn-secondary" onclick="logout()" style="margin-top:4px;">‚Üê Sign out</button>
  </div>
</div>

<!-- ORGANIZER PANEL -->
<div class="page hidden" id="organizer" style="align-items:flex-start;padding-top:20px;padding-left:12px;padding-right:12px;">
  <div class="panel-wrap fade-in" style="max-width:720px;width:100%;">
    <div class="panel-header">
      <div class="panel-back" onclick="showSection('home')">‚Üê</div>
      <div>
        <div class="panel-title">Organizer <span>Panel</span></div>
      </div>
    </div>

    <div class="dash-grid" id="orgStats">
      <div class="stat-card"><div class="stat-num" id="statProfiles">0</div><div class="stat-label">My Profiles</div></div>
      <div class="stat-card"><div class="stat-num" id="statEvents">0</div><div class="stat-label">My Events</div></div>
      <div class="stat-card"><div class="stat-num" id="statEnquiries">0</div><div class="stat-label">Enquiries</div></div>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchOrgTab('profile',this)">üë§ New Profile</button>
      <button class="tab" onclick="switchOrgTab('myprofiles',this)">‚úèÔ∏è My Profiles</button>
      <button class="tab" onclick="switchOrgTab('events',this)">üé™ Post Event</button>
      <button class="tab" onclick="switchOrgTab('inbox',this)">üì¨ Inbox</button>
    </div>

    <div id="orgTabProfile">
      <div class="glass-card">
        <div class="cloudinary-info">
          ‚òÅÔ∏è Photos are stored on Cloudinary ‚Äî unlimited storage, fast loading worldwide
        </div>
        <form id="orgForm">
          <div class="form-row">
            <div class="form-group">
              <label>Organizer Name</label>
              <input type="text" id="orgName" placeholder="Name or company" required>
            </div>
            <div class="form-group">
              <label>Company Name <span style="font-size:11px;color:var(--muted);">(optional)</span></label>
              <input type="text" id="orgCompany" placeholder="Your company / brand name">
            </div>
          </div>
          <div class="form-group">
            <label>Categories <span style="font-size:11px;color:var(--muted);">(select all that apply)</span></label>
            <div id="catCheckboxes" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;">
              <label class="cat-chip"><input type="checkbox" value="Wedding"> üíç Wedding</label>
              <label class="cat-chip"><input type="checkbox" value="Birthday"> üéÇ Birthday</label>
              <label class="cat-chip"><input type="checkbox" value="Corporate"> üè¢ Corporate</label>
              <label class="cat-chip"><input type="checkbox" value="Concert"> üéµ Concert</label>
              <label class="cat-chip"><input type="checkbox" value="Sports"> üèÖ Sports</label>
              <label class="cat-chip"><input type="checkbox" value="Conference"> üé§ Conference</label>
              <label class="cat-chip"><input type="checkbox" value="Social"> üéä Social</label>
              <label class="cat-chip"><input type="checkbox" value="Other"> ‚ú® Other</label>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Phone Number</label>
              <input type="tel" id="orgPhone" placeholder="+91 00000 00000" required>
            </div>
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="orgEmail" placeholder="contact@email.com" required>
            </div>
          </div>
          <div class="form-group">
            <label>Bio / Description</label>
            <textarea id="orgBio" rows="3" placeholder="Tell clients about your experience..."></textarea>
          </div>
          <div class="form-group">
            <label>Location / City</label>
            <input type="text" id="orgLocation" placeholder="e.g. Mumbai, Delhi..." required>
          </div>
          <div class="form-group">
            <label>Years of Experience</label>
            <input type="number" id="orgExp" placeholder="e.g. 5" min="0">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Min Price (‚Çπ)</label>
              <input type="number" id="orgPriceMin" placeholder="e.g. 10000" min="0">
            </div>
            <div class="form-group">
              <label>Max Price (‚Çπ)</label>
              <input type="number" id="orgPriceMax" placeholder="e.g. 100000" min="0">
            </div>
          </div>
          <div class="form-group">
            <label>WhatsApp Number</label>
            <input type="tel" id="orgWhatsapp" placeholder="+91 WhatsApp number">
          </div>
          <div class="form-group">
            <label>Website <span style="font-size:11px;color:var(--muted);">(optional)</span></label>
            <input type="url" id="orgWebsite" placeholder="https://yourwebsite.com">
          </div>
          <div style="background:var(--surface2);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px;">
            <div style="font-size:13px;font-weight:600;color:var(--accent);margin-bottom:12px;">üîó Social & Portfolio Links <span style="font-size:11px;color:var(--muted);font-weight:400;">(optional)</span></div>
            <div class="form-row">
              <div class="form-group" style="margin:0;"><label style="display:flex;align-items:center;gap:6px;"><span style="font-size:16px;">üìÇ</span> Google Drive</label><input type="url" id="orgDriveLink" placeholder="https://drive.google.com/..."></div>
              <div class="form-group" style="margin:0;"><label style="display:flex;align-items:center;gap:6px;"><span style="font-size:16px;">üì∏</span> Instagram</label><input type="url" id="orgInstagram" placeholder="https://instagram.com/..."></div>
            </div>
            <div class="form-group" style="margin-top:12px;margin-bottom:0;"><label style="display:flex;align-items:center;gap:6px;"><span style="font-size:16px;">üìò</span> Facebook Page</label><input type="url" id="orgFacebook" placeholder="https://facebook.com/..."></div>
          </div>
          <div class="form-group">
            <label>Photos <span style="font-size:11px;color:var(--muted);">(select multiple ‚Äî uploaded to Cloudinary)</span></label>
            <input type="file" id="orgPhoto" accept="image/*" multiple onchange="previewMultipleImgs(this,'orgImgsPreview')">
            <div id="orgImgsPreview" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;"></div>
            <div class="upload-progress-wrap" id="orgUploadProgress">
              <div class="upload-progress-text">
                <span id="orgUploadStatusText">‚òÅÔ∏è Uploading to Cloudinary...</span>
                <span class="upload-status-icon" id="orgUploadIcon">‚è≥</span>
              </div>
              <div class="upload-progress-bar-bg">
                <div class="upload-progress-bar" id="orgUploadBar"></div>
              </div>
            </div>
          </div>
          <button type="submit" class="btn-primary">‚ú¶ Publish Profile</button>
        </form>
      </div>
    </div>

    <div id="orgTabEvents" class="hidden">
      <div class="glass-card" style="margin-bottom:20px;">
        <form id="eventForm">
          <div class="form-row">
            <div class="form-group">
              <label>Event Name</label>
              <input type="text" id="evtName" placeholder="Grand Evening Gala..." required>
            </div>
            <div class="form-group">
              <label>Category</label>
              <select id="evtCategory" required>
                <option value="">Select</option>
                <option>Wedding</option>
                <option>Corporate</option>
                <option>Birthday</option>
                <option>Concert</option>
                <option>Sports</option>
                <option>Conference</option>
                <option>Social</option>
                <option>Other</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Event Date</label>
              <input type="date" id="evtDate" required>
            </div>
            <div class="form-group">
              <label>Ticket Price (‚Çπ)</label>
              <input type="number" id="evtPrice" placeholder="0 for free" min="0">
            </div>
          </div>
          <div class="form-group">
            <label>Venue</label>
            <input type="text" id="evtVenue" placeholder="Venue name, city..." required>
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea id="evtDesc" rows="3" placeholder="Describe the event..."></textarea>
          </div>
          <button type="submit" class="btn-primary">üé™ Post Event</button>
        </form>
      </div>
      <h4 style="font-family:'Playfair Display',serif;margin-bottom:14px;font-size:17px;">Your Posted Events</h4>
      <div id="myEventsList"></div>
    </div>

    <div id="orgTabInbox" class="hidden">
      <div id="inboxList"><div class="loading-dots"><span></span><span></span><span></span></div></div>
    </div>

    <div id="orgTabMyprofiles" class="hidden">
      <div style="font-size:13px;color:var(--muted);margin-bottom:16px;">Apne published organizer profiles ko yahan edit karo.</div>
      <div id="myProfilesList"><div class="loading-dots"><span></span><span></span><span></span></div></div>
    </div>
  </div>
</div>

<!-- CUSTOMER VIEW -->
<div class="page hidden" id="customer" style="align-items:flex-start;padding-top:20px;padding-left:12px;padding-right:12px;">
  <div class="customer-wrap fade-in">
    <div class="panel-header">
      <div class="panel-back" onclick="showSection('home')">‚Üê</div>
      <div><div class="panel-title">Explore <span>Organizers</span></div></div>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchCustTab('browse',this)">üîç Browse</button>
      <button class="tab" onclick="switchCustTab('events',this)">üé™ Events</button>
      <button class="tab" onclick="switchCustTab('vendors',this)">üì∏ Photographers & More</button>
      <button class="tab" onclick="switchCustTab('myenquiries',this)">üìã My Enquiries</button>
    </div>

    <div id="custTabBrowse">
      <div class="search-sort-row">
        <div class="search-bar">
          <span class="search-icon">‚åï</span>
          <input id="search" placeholder="Search organizers..." oninput="filterOrganizers()">
        </div>
        <select class="sort-select" id="sortBy" onchange="filterOrganizers()">
          <option value="newest">Newest</option>
          <option value="rating">Top Rated</option>
          <option value="name">A‚ÄìZ</option>
        </select>
      </div>
      <div class="cat-pills" id="catPills"></div>
      <div class="org-grid" id="list">
        <div class="loading-dots"><span></span><span></span><span></span></div>
      </div>
    </div>

    <div id="custTabEvents" class="hidden">
      <div class="events-grid" id="eventsGrid">
        <div class="loading-dots"><span></span><span></span><span></span></div>
      </div>
    </div>

    <div id="custTabVendors" class="hidden">
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;" id="vendorFilterBtns">
        <button class="vendor-type-btn active" onclick="filterVendors('all',this)">All</button>
        <button class="vendor-type-btn" onclick="filterVendors('photographer',this)">üì∏ Photographers</button>
        <button class="vendor-type-btn" onclick="filterVendors('makeup',this)">üíÑ Makeup Artists</button>
        <button class="vendor-type-btn" onclick="filterVendors('gifts',this)">üéÅ Return Gifts</button>
      </div>
      <div id="vendorList"><div class="loading-dots"><span></span><span></span><span></span></div></div>
    </div>

    <div id="custTabMyenquiries" class="hidden">
      <div id="myEnquiriesList"><div class="loading-dots"><span></span><span></span><span></span></div></div>
    </div>
  </div>
</div>

<!-- ADMIN PANEL -->
<div class="page hidden" id="admin" style="align-items:flex-start;padding-top:20px;padding-left:12px;padding-right:12px;">
  <div class="admin-wrap fade-in">
    <div class="panel-header">
      <div class="panel-back" onclick="showSection('home')">‚Üê</div>
      <div>
        <div class="panel-title">üõ°Ô∏è Admin <span>Panel</span></div>
        <div style="font-size:12px;color:var(--muted);margin-top:4px;" id="adminEmailDisplay">Logged in as <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="dbb6a9a9b2afbab6b6b2afa9ba9bbcb6bab2b7f5b8b4b6">[email&#160;protected]</a></div>
      </div>
    </div>

    <div class="admin-stats-row" id="adminStatsRow">
      <div class="admin-stat"><div class="admin-stat-num" id="adStatOrg">‚Äì</div><div class="admin-stat-label">Organizers</div></div>
      <div class="admin-stat"><div class="admin-stat-num" id="adStatVendors">‚Äì</div><div class="admin-stat-label">Professionals</div></div>
      <div class="admin-stat"><div class="admin-stat-num" id="adStatEvents">‚Äì</div><div class="admin-stat-label">Events</div></div>
      <div class="admin-stat"><div class="admin-stat-num" id="adStatEnq">‚Äì</div><div class="admin-stat-label">Enquiries</div></div>
      <div class="admin-stat"><div class="admin-stat-num" id="adStatReviews">‚Äì</div><div class="admin-stat-label">Reviews</div></div>
    </div>

    <div class="tabs" style="margin-bottom:26px;">
      <button class="tab active" onclick="switchAdminTab('organizers',this)">üé≠ Organizers</button>
      <button class="tab" onclick="switchAdminTab('vendors',this)">üì∏ Professionals</button>
      <button class="tab" onclick="switchAdminTab('events',this)">üé™ Events</button>
      <button class="tab" onclick="switchAdminTab('enquiries',this)">üì¨ Enquiries</button>
      <button class="tab" onclick="switchAdminTab('reviews',this)">‚≠ê Reviews</button>
      <button class="tab" onclick="switchAdminTab('claims',this)" id="claimTabBtn">üîî Claims</button>
      <button class="tab" onclick="switchAdminTab('addlisting',this)">‚ûï Add Listing</button>
    </div>

    <div id="adminTabOrganizers">
      <div style="font-size:13px;color:var(--muted);margin-bottom:14px;">All organizer profiles on the platform.</div>
      <div id="adminOrgList"><div class="loading-dots"><span></span><span></span><span></span></div></div>
    </div>
    <div id="adminTabVendors" class="hidden">
      <div style="font-size:13px;color:var(--muted);margin-bottom:14px;">All professional profiles.</div>
      <div id="adminVendorList"><div class="loading-dots"><span></span><span></span><span></span></div></div>
    </div>
    <div id="adminTabEvents" class="hidden">
      <div style="font-size:13px;color:var(--muted);margin-bottom:14px;">All events on the platform.</div>
      <div id="adminEventList"><div class="loading-dots"><span></span><span></span><span></span></div></div>
    </div>
    <div id="adminTabEnquiries" class="hidden">
      <div style="font-size:13px;color:var(--muted);margin-bottom:14px;">All enquiries sent by customers.</div>
      <div id="adminEnquiryList"><div class="loading-dots"><span></span><span></span><span></span></div></div>
    </div>

    <div id="adminTabReviews" class="hidden">
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px;">
        <button class="vendor-type-btn active" onclick="filterAdminReviews('all',this)">All Reviews</button>
        <button class="vendor-type-btn" onclick="filterAdminReviews('organizer',this)">üé≠ Organizers</button>
        <button class="vendor-type-btn" onclick="filterAdminReviews('vendor',this)">üì∏ Professionals</button>
      </div>
      <div style="font-size:13px;color:var(--muted);margin-bottom:14px;">Manage all reviews ‚Äî edit rating, name, text. Changes save immediately.</div>
      <div id="adminReviewList"><div class="loading-dots"><span></span><span></span><span></span></div></div>
    </div>

    <div id="adminTabClaims" class="hidden">
      <div style="font-size:13px;color:var(--muted);margin-bottom:14px;">Users ke ownership claim requests.</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px;">
        <button class="vendor-type-btn active" onclick="filterAdminClaims('all',this)">All</button>
        <button class="vendor-type-btn" onclick="filterAdminClaims('pending',this)">‚è≥ Pending</button>
        <button class="vendor-type-btn" onclick="filterAdminClaims('approved',this)">‚úÖ Approved</button>
        <button class="vendor-type-btn" onclick="filterAdminClaims('rejected',this)">‚ùå Rejected</button>
      </div>
      <div id="adminClaimList"><div class="loading-dots"><span></span><span></span><span></span></div></div>
    </div>

    <div id="adminTabAddlisting" class="hidden">
      <div class="admin-section">
        <div class="admin-section-title">‚ûï Add Professional Listing (on behalf of anyone)</div>
        <div style="font-size:13px;color:var(--muted);margin-bottom:20px;">Use this to list a makeup artist, photographer, or gifts seller without them needing an account.</div>
        <div class="glass-card">
          <div class="cloudinary-info">‚òÅÔ∏è Photos will be uploaded to Cloudinary ‚Äî no Firebase storage used</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px;" id="adminVendorTypeBtns">
            <button class="vendor-type-btn active" onclick="adminSelectVendorType('photographer',this)">üì∏ Photographer</button>
            <button class="vendor-type-btn" onclick="adminSelectVendorType('makeup',this)">üíÑ Makeup Artist</button>
            <button class="vendor-type-btn" onclick="adminSelectVendorType('gifts',this)">üéÅ Return Gifts</button>
          </div>
          <form id="adminVendorForm">
            <div id="adminVendorTypeLabel" style="font-family:'Playfair Display',serif;font-size:16px;font-weight:700;margin-bottom:16px;color:var(--accent);">üì∏ Adding: Photographer</div>
            <div class="form-row">
              <div class="form-group"><label>Name</label><input type="text" id="avName" placeholder="Full name" required></div>
              <div class="form-group"><label>Company / Brand <span style="font-size:11px;color:var(--muted);">(optional)</span></label><input type="text" id="avCompany" placeholder="Studio / brand name"></div>
            </div>
            <div class="form-row">
              <div class="form-group"><label>Phone</label><input type="tel" id="avPhone" placeholder="+91 00000 00000" required></div>
              <div class="form-group"><label>WhatsApp</label><input type="tel" id="avWhatsapp" placeholder="+91 WhatsApp"></div>
            </div>
            <div class="form-row">
              <div class="form-group"><label>Email</label><input type="email" id="avEmail" placeholder="their@email.com" required></div>
              <div class="form-group"><label>Website <span style="font-size:11px;color:var(--muted);">(optional)</span></label><input type="url" id="avWebsite" placeholder="https://..."></div>
            </div>
            <div class="form-group"><label>Location / City</label><input type="text" id="avLocation" placeholder="e.g. Midnapore, Kolkata..." required></div>
            <div class="form-group"><label>Bio / Description</label><textarea id="avBio" rows="3" placeholder="About their work..."></textarea></div>
            <div class="form-row">
              <div class="form-group"><label>Years of Experience</label><input type="number" id="avExp" placeholder="e.g. 5" min="0"></div>
              <div class="form-group"><label id="avSpecialtyLabel">Specialty</label><input type="text" id="avSpecialty" placeholder="e.g. Bridal Makeup"></div>
            </div>
            <div class="form-row">
              <div class="form-group"><label>Min Price (‚Çπ)</label><input type="number" id="avPriceMin" placeholder="e.g. 2000" min="0"></div>
              <div class="form-group"><label>Max Price (‚Çπ)</label><input type="number" id="avPriceMax" placeholder="e.g. 20000" min="0"></div>
            </div>
            <div style="background:var(--surface2);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px;">
              <div style="font-size:13px;font-weight:600;color:var(--accent);margin-bottom:12px;">üîó Portfolio & Social Links <span style="font-size:11px;color:var(--muted);font-weight:400;">(optional)</span></div>
              <div class="form-row">
                <div class="form-group" style="margin:0;">
                  <label style="display:flex;align-items:center;gap:6px;"><span style="font-size:16px;">üìÇ</span> Google Drive</label>
                  <input type="url" id="avDriveLink" placeholder="https://drive.google.com/...">
                </div>
                <div class="form-group" style="margin:0;">
                  <label style="display:flex;align-items:center;gap:6px;"><span style="font-size:16px;">üì∏</span> Instagram</label>
                  <input type="url" id="avInstagram" placeholder="https://instagram.com/...">
                </div>
              </div>
              <div class="form-group" style="margin-top:12px;margin-bottom:0;">
                <label style="display:flex;align-items:center;gap:6px;"><span style="font-size:16px;">üìò</span> Facebook Page</label>
                <input type="url" id="avFacebook" placeholder="https://facebook.com/...">
              </div>
            </div>
            <div class="form-group" id="avPhotoGroup">
              <label>Work Photos <span style="font-size:11px;color:var(--muted);">(multiple allowed ‚Äî Cloudinary)</span></label>
              <input type="file" id="avPhotos" accept="image/*" multiple onchange="previewMultipleImgs(this,'avPhotosPreview')">
              <div id="avPhotosPreview" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;"></div>
              <div class="upload-progress-wrap" id="avUploadProgress">
                <div class="upload-progress-text"><span id="avUploadStatusText">‚òÅÔ∏è Uploading to Cloudinary...</span><span class="upload-status-icon" id="avUploadIcon">‚è≥</span></div>
                <div class="upload-progress-bar-bg"><div class="upload-progress-bar" id="avUploadBar"></div></div>
              </div>
            </div>
            <button type="submit" class="btn-primary" style="margin-top:8px;">‚ú¶ Publish Listing</button>
          </form>
        </div>
      </div>

      <div class="admin-section" style="margin-top:20px;">
        <div class="admin-section-title">üé≠ Add Organizer Profile (on behalf of anyone)</div>
        <div style="font-size:13px;color:var(--muted);margin-bottom:20px;">List a full event organizer without them needing an account.</div>
        <div class="glass-card">
          <div class="cloudinary-info">‚òÅÔ∏è Photos will be uploaded to Cloudinary ‚Äî no Firebase storage used</div>
          <form id="adminOrgForm">
            <div class="form-row">
              <div class="form-group"><label>Organizer Name</label><input type="text" id="aoName" placeholder="Name or company" required></div>
              <div class="form-group"><label>Company Name <span style="font-size:11px;color:var(--muted);">(optional)</span></label><input type="text" id="aoCompany" placeholder="Brand name"></div>
            </div>
            <div class="form-group">
              <label>Categories</label>
              <div id="aoCatCheckboxes" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;">
                <label class="cat-chip"><input type="checkbox" value="Wedding"> üíç Wedding</label>
                <label class="cat-chip"><input type="checkbox" value="Birthday"> üéÇ Birthday</label>
                <label class="cat-chip"><input type="checkbox" value="Corporate"> üè¢ Corporate</label>
                <label class="cat-chip"><input type="checkbox" value="Concert"> üéµ Concert</label>
                <label class="cat-chip"><input type="checkbox" value="Sports"> üèÖ Sports</label>
                <label class="cat-chip"><input type="checkbox" value="Conference"> üé§ Conference</label>
                <label class="cat-chip"><input type="checkbox" value="Social"> üéä Social</label>
                <label class="cat-chip"><input type="checkbox" value="Other"> ‚ú® Other</label>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group"><label>Phone</label><input type="tel" id="aoPhone" placeholder="+91 00000 00000" required></div>
              <div class="form-group"><label>Email</label><input type="email" id="aoEmail" placeholder="contact@email.com" required></div>
            </div>
            <div class="form-group"><label>Bio / Description</label><textarea id="aoBio" rows="3" placeholder="Tell clients about this organizer..."></textarea></div>
            <div class="form-row">
              <div class="form-group"><label>Location / City</label><input type="text" id="aoLocation" placeholder="e.g. Midnapore..." required></div>
              <div class="form-group"><label>Years of Experience</label><input type="number" id="aoExp" placeholder="e.g. 5" min="0"></div>
            </div>
            <div class="form-row">
              <div class="form-group"><label>Min Price (‚Çπ)</label><input type="number" id="aoPriceMin" placeholder="e.g. 10000" min="0"></div>
              <div class="form-group"><label>Max Price (‚Çπ)</label><input type="number" id="aoPriceMax" placeholder="e.g. 100000" min="0"></div>
            </div>
            <div class="form-group"><label>WhatsApp Number</label><input type="tel" id="aoWhatsapp" placeholder="+91 WhatsApp number"></div>
            <div class="form-group">
              <label>Photos <span style="font-size:11px;color:var(--muted);">(multiple allowed ‚Äî Cloudinary)</span></label>
              <input type="file" id="aoPhotos" accept="image/*" multiple onchange="previewMultipleImgs(this,'aoImgsPreview')">
              <div id="aoImgsPreview" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;"></div>
              <div class="upload-progress-wrap" id="aoUploadProgress">
                <div class="upload-progress-text"><span id="aoUploadStatusText">‚òÅÔ∏è Uploading to Cloudinary...</span><span class="upload-status-icon" id="aoUploadIcon">‚è≥</span></div>
                <div class="upload-progress-bar-bg"><div class="upload-progress-bar" id="aoUploadBar"></div></div>
              </div>
            </div>
            <button type="submit" class="btn-primary">‚ú¶ Publish Organizer Profile</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- FIREBASE -->
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>
// ===== FIREBASE CONFIG =====
firebase.initializeApp({
  apiKey:"AIzaSyBNW3y2zR8xQmhrOWqXzu8dmFRMYdSRSFM",
  authDomain:"rd-eventsphere.firebaseapp.com",
  projectId:"rd-eventsphere",
  storageBucket:"rd-eventsphere.firebasestorage.app",
  messagingSenderId:"9010232288",
  appId:"1:9010232288:web:f5e77bb53311acef97c985"
});
const auth = firebase.auth();
const db   = firebase.firestore();

// ===== CLOUDINARY CONFIG =====
const CLOUDINARY_CLOUD_NAME   = 'dkmygobzq';
const CLOUDINARY_UPLOAD_PRESET = 'utsaav_uploads';
const CLOUDINARY_UPLOAD_URL   = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`;

const ADMIN_EMAIL = 'mrritammitra@gmail.com';

// ===== WHATSAPP HELPER ‚Äî strips country code to avoid double 91 =====
// Usage: waNumber(o.whatsapp || o.phone) ‚Üí "9876543210" (10 digits, no country code)
function waNumber(raw) {
  // Remove all non-digit chars, then strip leading 91 if present
  return (raw || '').replace(/\D/g, '').replace(/^91/, '');
}

// ===== CLOUDINARY UPLOAD =====
async function uploadToCloudinary(file, progressBarId, statusTextId, iconId) {
  const formData = new FormData();
  formData.append('file', file);
  formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);

  return new Promise((resolve, reject) => {
    const xhr = new XMLHttpRequest();
    xhr.open('POST', CLOUDINARY_UPLOAD_URL);

    xhr.upload.onprogress = (e) => {
      if (e.lengthComputable && progressBarId) {
        const pct = Math.round((e.loaded / e.total) * 100);
        const bar = document.getElementById(progressBarId);
        if (bar) bar.style.width = pct + '%';
        const txt = document.getElementById(statusTextId);
        if (txt) txt.textContent = `‚òÅÔ∏è Uploading... ${pct}%`;
      }
    };

    xhr.onload = () => {
      if (xhr.status === 200) {
        const data = JSON.parse(xhr.responseText);
        resolve(data.secure_url);
      } else {
        reject(new Error('Cloudinary upload failed: ' + xhr.responseText));
      }
    };

    xhr.onerror = () => reject(new Error('Network error during upload'));
    xhr.send(formData);
  });
}

async function uploadMultipleToCloudinary(files, progressWrapId, barId, statusTextId, iconId) {
  const wrap = document.getElementById(progressWrapId);
  const bar  = document.getElementById(barId);
  const txt  = document.getElementById(statusTextId);
  const icon = document.getElementById(iconId);

  if (wrap) wrap.classList.add('visible');
  if (bar)  bar.style.width = '0%';
  if (txt)  txt.textContent = `‚òÅÔ∏è Uploading 0 / ${files.length} photos...`;

  const urls = [];
  for (let i = 0; i < files.length; i++) {
    if (txt) txt.textContent = `‚òÅÔ∏è Uploading photo ${i + 1} / ${files.length}...`;
    if (bar) bar.style.width = Math.round((i / files.length) * 90) + '%';
    const url = await uploadToCloudinary(files[i]);
    urls.push(url);
  }

  if (bar)  bar.style.width = '100%';
  if (txt)  txt.textContent = `‚úÖ All ${files.length} photos uploaded!`;
  if (icon) icon.textContent = '‚úÖ';

  setTimeout(() => { if (wrap) wrap.classList.remove('visible'); }, 2000);
  return urls;
}

// ===== CAT CHIP TOGGLE =====
document.addEventListener('click', e => {
  const chip = e.target.closest('.cat-chip');
  if (chip && (chip.closest('#catCheckboxes') || chip.closest('#aoCatCheckboxes'))) {
    const cb = chip.querySelector('input[type=checkbox]');
    cb.checked = !cb.checked;
    chip.classList.toggle('selected', cb.checked);
  }
});

let isLogin = true;
let allOrganizers = [];
let activeCategory = 'All';
let currentUser = null;

// ===== THEME =====
if (localStorage.getItem('esLight') === '1') document.body.classList.add('light');
function toggleDark() {
  document.body.classList.toggle('light');
  localStorage.setItem('esLight', document.body.classList.contains('light') ? '1' : '0');
}

// ===== TOAST =====
function showToast(msg, type='success') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast ' + (type === 'success' ? 'success' : 'error-t') + ' show';
  setTimeout(() => t.classList.remove('show'), 3200);
}

// ===== IMAGE LOCAL PREVIEW =====
function previewMultipleImgs(input, containerId) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';
  Array.from(input.files).forEach((file, i) => {
    const r = new FileReader();
    r.onload = e => {
      const wrap = document.createElement('div');
      wrap.style.cssText = 'position:relative;display:inline-block;';
      wrap.innerHTML = `<img src="${e.target.result}" style="width:80px;height:80px;object-fit:cover;border-radius:10px;border:2px solid var(--border);">${i===0?'<div style="position:absolute;bottom:4px;left:50%;transform:translateX(-50%);background:var(--accent);color:#000;font-size:9px;font-weight:700;padding:2px 6px;border-radius:4px;white-space:nowrap;">MAIN</div>':''}`;
      container.appendChild(wrap);
    };
    r.readAsDataURL(file);
  });
}

// ===== AUTH =====
function togglePass() {
  const p = document.getElementById('authPass');
  p.type = p.type === 'password' ? 'text' : 'password';
}

function toggleAuth() {
  isLogin = !isLogin;
  document.getElementById('authTitle').innerHTML = isLogin ? 'Welcome <em>Back.</em>' : 'Create <em>Account.</em>';
  document.getElementById('authSubtitle').textContent = isLogin ? 'Login to your Utsaav account.' : 'Join the Utsaav community.';
  document.getElementById('authBtn').textContent = isLogin ? 'Login ‚Üí' : 'Register ‚Üí';
  document.getElementById('switchPre').textContent = isLogin ? 'New here? ' : 'Already have an account? ';
  document.getElementById('switchLink').textContent = isLogin ? 'Create an account' : 'Login here';
  document.getElementById('errorMsg').textContent = '';
  const phoneGroup = document.getElementById('phoneGroup');
  const phoneInput = document.getElementById('authPhone');
  const nameGroup  = document.getElementById('nameGroup');
  const nameInput  = document.getElementById('authName');
  if (isLogin) {
    phoneGroup.classList.add('hidden');
    nameGroup.classList.add('hidden');
    phoneInput.removeAttribute('required');
    nameInput.removeAttribute('required');
  } else {
    phoneGroup.classList.add('hidden');
    nameGroup.classList.remove('hidden');
    phoneInput.removeAttribute('required');
    nameInput.setAttribute('required','true');
  }
}

document.getElementById('authForm').addEventListener('submit', async e => {
  e.preventDefault();
  const email = document.getElementById('authEmail').value;
  const pass  = document.getElementById('authPass').value;
  const phone = document.getElementById('authPhone')?.value?.trim() || '';
  const name  = document.getElementById('authName')?.value?.trim() || '';
  const errEl = document.getElementById('errorMsg');
  const btn   = document.getElementById('authBtn');
  if (pass.length < 6) { errEl.textContent = '‚ö† Password must be at least 6 characters'; return; }
  if (!isLogin) {
    if (!name)  { errEl.textContent = '‚ö† Apna naam likhein'; return; }
  }
  btn.textContent = 'Please wait...'; btn.disabled = true;
  try {
    if (isLogin) {
      const cred = await auth.signInWithEmailAndPassword(email, pass);
      trackEvent('login', 'auth', 'email_login');
      if (!cred.user.emailVerified && cred.user.email !== ADMIN_EMAIL) {
        showVerifyScreen(cred.user);
        btn.textContent = 'Login ‚Üí'; btn.disabled = false;
        return;
      }
    } else {
      const cred = await auth.createUserWithEmailAndPassword(email, pass);
      // Save display name to Firebase Auth profile
      await cred.user.updateProfile({ displayName: name });
      await db.collection('users').doc(cred.user.uid).set({
        email, phone, name, createdAt: new Date()
      });
      trackEvent('sign_up', 'auth', 'email_signup');
      await cred.user.sendEmailVerification();
      showVerifyScreen(cred.user);
      btn.textContent = 'Register ‚Üí'; btn.disabled = false;
      return;
    }
  } catch(err) { errEl.textContent = '‚ö† ' + err.message; }
  btn.textContent = isLogin ? 'Login ‚Üí' : 'Register ‚Üí'; btn.disabled = false;
});

auth.onAuthStateChanged(user => {
  currentUser = user;
  if (user) {
    const isAdmin = user.email === ADMIN_EMAIL;
    if (!user.emailVerified && !isAdmin) { showVerifyScreen(user); return; }
    hideAllPages();
    document.getElementById('home').classList.remove('hidden');
    // Show name if available, else show email prefix
    const displayName = user.displayName || user.email.split('@')[0];
    updateHeaderUser(displayName, user.email, isAdmin);
    // Personalize home title
    const homeTitle = document.getElementById('homeTitle');
    if (homeTitle) {
      homeTitle.innerHTML = `Namaste, <em>${displayName}!</em>`;
    }
    const adminBtn = document.getElementById('adminHomeBtn');
    if (adminBtn) adminBtn.classList.toggle('hidden', !isAdmin);
    // Track page view
    trackEvent('page_view', 'navigation', 'home_dashboard');
  } else {
    hideAllPages();
    document.getElementById('auth').classList.remove('hidden');
    document.getElementById('headerRight').innerHTML = '<div class="icon-btn" onclick="toggleDark()" title="Toggle theme">üåô</div>';
  }
});

function hideAllPages() {
  ['auth','verifyEmail','home','organizer','customer','admin','profilePage','vendor'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.add('hidden');
  });
}

function showVerifyScreen(user) {
  hideAllPages();
  document.getElementById('verifyEmail').classList.remove('hidden');
  document.getElementById('verifyEmailBadge').textContent = user.email;
  const displayName = user.displayName || user.email.split('@')[0];
  updateHeaderUser(displayName, user.email, false);
}

let resendCooldown = null;
async function resendVerification() {
  const btn = document.getElementById('resendBtn');
  const timer = document.getElementById('resendTimer');
  try {
    await auth.currentUser.sendEmailVerification();
    showToast('üìß Verification email resent!');
    btn.disabled = true;
    let secs = 60;
    timer.textContent = `Resend available in ${secs}s`;
    resendCooldown = setInterval(() => {
      secs--;
      timer.textContent = `Resend available in ${secs}s`;
      if (secs <= 0) { clearInterval(resendCooldown); btn.disabled = false; timer.textContent = ''; }
    }, 1000);
  } catch(err) { showToast('Could not resend: ' + err.message, 'error'); }
}

async function checkVerified() {
  const btn = document.querySelector('#verifyEmail .btn-primary');
  btn.textContent = 'Checking...'; btn.disabled = true;
  await auth.currentUser.reload();
  if (auth.currentUser.emailVerified) {
    currentUser = auth.currentUser;
    showToast('‚ú¶ Email verified! Welcome aboard.');
    hideAllPages();
    document.getElementById('home').classList.remove('hidden');
    const displayName = currentUser.displayName || currentUser.email.split('@')[0];
    updateHeaderUser(displayName, currentUser.email, currentUser.email === ADMIN_EMAIL);
    const adminBtn = document.getElementById('adminHomeBtn');
    if (adminBtn) adminBtn.classList.add('hidden');
    trackEvent('email_verified', 'auth', 'verification_complete');
  } else {
    showToast('‚ö† Not verified yet. Check your inbox.', 'error');
  }
  btn.textContent = "‚úì I've verified my email"; btn.disabled = false;
}

function updateHeaderUser(displayName, email, isAdmin) {
  const adminBadge = isAdmin ? `<span class="badge-red badge" style="margin:0;font-size:10px;padding:3px 8px;">üëë ADMIN</span>` : '';
  document.getElementById('headerRight').innerHTML = `
    <div class="user-chip"><div class="dot"></div>${displayName} ${adminBadge}</div>
    <div class="icon-btn" onclick="toggleDark()" title="Toggle theme">üåô</div>`;
}

function logout() { auth.signOut(); }
function handleLogoClick() { if (currentUser) showSection('home'); }

// ===== NAVIGATION =====
function showSection(id) {
  if (id === 'admin' && currentUser?.email !== ADMIN_EMAIL) { showToast('Access denied.', 'error'); return; }
  trackEvent('navigate', 'section', id);
  if (id === 'vendor') {
    hideAllPages();
    document.getElementById('vendor').classList.remove('hidden');
    window.scrollTo(0, 0);
    loadMyVendorListings();
    return;
  }
  hideAllPages();
  document.getElementById(id).classList.remove('hidden');
  window.scrollTo(0, 0);
  if (id === 'organizer') { loadOrgStats(); loadMyEvents(); }
  if (id === 'customer')  { loadOrganizers(); }
  if (id === 'admin')     {
    loadAdminStats(); loadAdminOrganizers();
    const el = document.getElementById('adminEmailDisplay');
    if (el && currentUser) el.textContent = `Logged in as ${currentUser.email}`;
  }
}

// ===== TAB SWITCHERS =====
function switchOrgTab(name, btn) {
  btn.parentElement.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  ['orgTabProfile','orgTabMyprofiles','orgTabEvents','orgTabInbox'].forEach(id => document.getElementById(id)?.classList.add('hidden'));
  document.getElementById('orgTab' + name.charAt(0).toUpperCase() + name.slice(1))?.classList.remove('hidden');
  if (name === 'inbox')      loadInbox();
  if (name === 'events')     loadMyEvents();
  if (name === 'myprofiles') loadMyProfiles();
}

function switchCustTab(name, btn) {
  document.querySelectorAll('#customer .tabs .tab').forEach(t => t.classList.remove('active'));
  if (btn) btn.classList.add('active');
  else {
    // Auto-find the tab button by matching onclick text
    const allTabs = document.querySelectorAll('#customer .tabs .tab');
    allTabs.forEach(t => { if (t.getAttribute('onclick') && t.getAttribute('onclick').includes("'" + name + "'")) t.classList.add('active'); });
  }
  ['custTabBrowse','custTabEvents','custTabVendors','custTabMyenquiries'].forEach(id => document.getElementById(id)?.classList.add('hidden'));
  document.getElementById('custTab' + name.charAt(0).toUpperCase() + name.slice(1))?.classList.remove('hidden');
  if (name === 'events')      loadAllEvents();
  if (name === 'myenquiries') loadMyEnquiries();
  if (name === 'vendors')     loadVendors('all');
}

function switchAdminTab(name, btn) {
  btn.parentElement.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  ['adminTabOrganizers','adminTabVendors','adminTabEvents','adminTabEnquiries','adminTabReviews','adminTabClaims','adminTabAddlisting'].forEach(id => document.getElementById(id)?.classList.add('hidden'));
  document.getElementById('adminTab' + name.charAt(0).toUpperCase() + name.slice(1))?.classList.remove('hidden');
  if (name === 'organizers') loadAdminOrganizers();
  if (name === 'vendors')    loadAdminVendors();
  if (name === 'reviews')    loadAdminReviews();
  if (name === 'claims')     loadAdminClaims('all');
  if (name === 'events')     loadAdminEvents();
  if (name === 'enquiries')  loadAdminEnquiries();
}

// ===== CLOUDINARY DELETE HELPER =====
function getCloudinaryPublicId(url) {
  if (!url || !url.includes('cloudinary.com')) return null;
  try {
    const parts = url.split('/upload/');
    if (parts.length < 2) return null;
    const afterUpload = parts[1];
    const withoutVersion = afterUpload.replace(/^v\d+\//, '');
    return withoutVersion.replace(/\.[^/.]+$/, '');
  } catch(e) { return null; }
}

function logCloudinaryDeletion(photos) {
  const ids = (photos || []).map(getCloudinaryPublicId).filter(Boolean);
  if (ids.length) console.log('üóë Cloudinary images to clean up (requires backend):', ids);
}

// ===== PAGINATION =====
const PAGE_SIZE = 9;
let currentPage = 1;
let filteredOrgList = [];

// ===== ORGANIZERS LOAD & FILTER =====
async function loadOrganizers() {
  const el = document.getElementById('list');
  el.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
  try {
    const snap = await db.collection('organizers').get();
    allOrganizers = [];
    snap.forEach(doc => allOrganizers.push({id: doc.id, ...doc.data()}));
    allOrganizers.sort((a,b) => (b.createdAt?.toDate?.()?.getTime()||0) - (a.createdAt?.toDate?.()?.getTime()||0));
    buildCatPills();
    currentPage = 1;
    filteredOrgList = allOrganizers;
    renderOrganizers(filteredOrgList);
  } catch(err) {
    el.innerHTML = `<p style="color:var(--muted);font-size:14px;">‚ö†Ô∏è Error: ${err.message}</p>`;
  }
}

async function loadAdminStats() {
  try {
    const [orgs, vendors, events, enq, reviews] = await Promise.all([
      db.collection('organizers').get(),
      db.collection('vendors').get(),
      db.collection('events').get(),
      db.collection('enquiries').get(),
      db.collection('reviews').get()
    ]);
    document.getElementById('adStatOrg').textContent     = orgs.size;
    document.getElementById('adStatVendors').textContent = vendors.size;
    document.getElementById('adStatEvents').textContent  = events.size;
    document.getElementById('adStatEnq').textContent     = enq.size;
    document.getElementById('adStatReviews').textContent = reviews.size;
  } catch(e) { console.error(e); }
}

async function loadAdminOrganizers() {
  const el = document.getElementById('adminOrgList');
  el.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
  const snap = await db.collection('organizers').orderBy('createdAt','desc').get();
  el.innerHTML = '';
  if (snap.empty) { el.innerHTML = '<div class="empty-state"><span class="empty-icon">üé≠</span><p>No organizers yet.</p></div>'; return; }
  snap.forEach(doc => {
    const o = {id: doc.id, ...doc.data()};
    const div = document.createElement('div');
    div.className = 'admin-item';
    div.innerHTML = `
      <div style="display:flex;gap:12px;align-items:center;flex:1;min-width:200px;">
        ${o.photo ? `<img src="${o.photo}" style="width:60px;height:60px;object-fit:cover;border-radius:10px;border:1px solid var(--border);flex-shrink:0;">` : '<div style="width:60px;height:60px;background:var(--surface3);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0;">üé≠</div>'}
        <div class="admin-item-info">
          <div class="admin-item-name">${o.name} ${o.owner==='seed@utsaav.com'?'<span style="font-size:11px;color:var(--muted);">[sample]</span>':''}</div>
          <div class="admin-item-meta">
            üìç ${o.location||'‚Äî'} &nbsp;|&nbsp; üìÅ ${o.category||'‚Äî'}<br>
            üìû ${o.phone} &nbsp;|&nbsp; ‚úâ ${o.email}<br>
            ‚≠ê ${o.rating?o.rating.toFixed(1):0} (${o.reviewCount||0} reviews) &nbsp;|&nbsp; Owner: ${o.owner}
          </div>
        </div>
      </div>
      <div class="admin-item-actions">
        <button class="btn-secondary btn-sm" onclick="adminEditOrg('${o.id}')">‚úèÔ∏è Edit</button>
        <button onclick="openTransferModal('${o.id}','organizer','${o.name}','${o.owner}')" style="padding:7px 14px;background:rgba(76,154,201,0.12);color:#7fc3e8;border:1px solid rgba(76,154,201,0.3);border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;">üîÑ Transfer</button>
        <button class="btn-danger btn-sm" onclick="adminDeleteOrg('${o.id}','${o.name.replace(/'/g,"\\'")}')">üóë Delete</button>
      </div>`;
    el.appendChild(div);
  });
}

async function loadAdminVendors() {
  const el = document.getElementById('adminVendorList');
  el.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
  const snap = await db.collection('vendors').get();
  el.innerHTML = '';
  if (snap.empty) { el.innerHTML = '<div class="empty-state"><span class="empty-icon">üì∏</span><p>No professionals yet.</p></div>'; return; }
  const typeIcon = {photographer:'üì∏', makeup:'üíÑ', gifts:'üéÅ'};
  snap.forEach(doc => {
    const v = {id: doc.id, ...doc.data()};
    const div = document.createElement('div');
    div.className = 'admin-item';
    div.innerHTML = `
      <div style="display:flex;gap:12px;align-items:center;flex:1;min-width:200px;">
        ${v.photo ? `<img src="${v.photo}" style="width:60px;height:60px;object-fit:cover;border-radius:10px;border:1px solid var(--border);flex-shrink:0;">` : `<div style="width:60px;height:60px;background:var(--surface3);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0;">${typeIcon[v.type]||'‚ú®'}</div>`}
        <div class="admin-item-info">
          <div class="admin-item-name">${typeIcon[v.type]||''} ${v.name}${v.company?' ‚Äî '+v.company:''}</div>
          <div class="admin-item-meta">
            üìç ${v.location||'‚Äî'} &nbsp;|&nbsp; Type: ${v.type}<br>
            üìû ${v.phone} &nbsp;|&nbsp; ‚úâ ${v.email}<br>
            Specialty: ${v.specialty||'‚Äî'} &nbsp;|&nbsp; Owner: ${v.owner}
          </div>
        </div>
      </div>
      <div class="admin-item-actions">
        <button class="btn-secondary btn-sm" onclick="adminEditVendor('${v.id}')">‚úèÔ∏è Edit</button>
        <button onclick="openTransferModal('${v.id}','vendor','${v.name}','${v.owner}')" style="padding:7px 14px;background:rgba(76,154,201,0.12);color:#7fc3e8;border:1px solid rgba(76,154,201,0.3);border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;">üîÑ Transfer</button>
        <button class="btn-danger btn-sm" onclick="adminDeleteVendor('${v.id}','${v.name.replace(/'/g,"\\'")}')">üóë Delete</button>
      </div>`;
    el.appendChild(div);
  });
}

async function loadAdminEvents() {
  const el = document.getElementById('adminEventList');
  el.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
  const snap = await db.collection('events').get();
  el.innerHTML = '';
  if (snap.empty) { el.innerHTML = '<div class="empty-state"><span class="empty-icon">üé™</span><p>No events yet.</p></div>'; return; }
  snap.forEach(doc => {
    const ev = {id: doc.id, ...doc.data()};
    const d  = new Date(ev.date);
    const div = document.createElement('div');
    div.className = 'admin-item';
    div.innerHTML = `
      <div class="admin-item-info">
        <div class="admin-item-name">üé™ ${ev.name}</div>
        <div class="admin-item-meta">
          üìÖ ${d.toDateString()} &nbsp;|&nbsp; üìÅ ${ev.category} &nbsp;|&nbsp; üìç ${ev.venue}<br>
          üí∞ ${ev.price?'‚Çπ'+ev.price.toLocaleString():'Free'} &nbsp;|&nbsp; Posted by: ${ev.owner}
        </div>
      </div>
      <div class="admin-item-actions">
        <button class="btn-danger btn-sm" onclick="adminDeleteEvent('${ev.id}','${ev.name.replace(/'/g,"\\'")}')">üóë Delete</button>
      </div>`;
    el.appendChild(div);
  });
}

async function loadAdminEnquiries() {
  const el = document.getElementById('adminEnquiryList');
  el.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
  const snap = await db.collection('enquiries').orderBy('createdAt','desc').get();
  el.innerHTML = '';
  if (snap.empty) { el.innerHTML = '<div class="empty-state"><span class="empty-icon">üì¨</span><p>No enquiries yet.</p></div>'; return; }
  snap.forEach(doc => {
    const q = {id: doc.id, ...doc.data()};
    const d = q.createdAt?.toDate?.()?.toLocaleDateString() || '';
    const div = document.createElement('div');
    div.className = 'admin-item';
    div.innerHTML = `
      <div class="admin-item-info">
        <div class="admin-item-name">üì¨ To: ${q.toName}</div>
        <div class="admin-item-meta">
          From: ${q.fromName||q.fromEmail} (${q.fromEmail}) &nbsp;|&nbsp; ${d}<br>
          ${q.fromPhone?'üìû '+q.fromPhone+'<br>':''}<em>${q.message?.slice(0,120)}${q.message?.length>120?'...':''}</em>
        </div>
      </div>
      <div class="admin-item-actions">
        <button class="btn-danger btn-sm" onclick="adminDeleteEnquiry('${q.id}')">üóë Delete</button>
      </div>`;
    el.appendChild(div);
  });
}

async function adminDeleteOrg(id, name) {
  if (!confirm(`Delete organizer "${name}"? This cannot be undone.`)) return;
  const doc = await db.collection('organizers').doc(id).get();
  if (doc.exists) logCloudinaryDeletion(doc.data().photos);
  await db.collection('organizers').doc(id).delete();
  showToast('üóë Organizer deleted.');
  loadAdminOrganizers(); loadAdminStats();
}

async function adminDeleteVendor(id, name) {
  if (!confirm(`Delete professional "${name}"?`)) return;
  const doc = await db.collection('vendors').doc(id).get();
  if (doc.exists) logCloudinaryDeletion(doc.data().photos);
  await db.collection('vendors').doc(id).delete();
  showToast('üóë Professional deleted.');
  loadAdminVendors(); loadAdminStats();
}

async function adminDeleteEvent(id, name) {
  if (!confirm(`Delete event "${name}"?`)) return;
  await db.collection('events').doc(id).delete();
  showToast('üóë Event deleted.');
  loadAdminEvents(); loadAdminStats();
}

async function adminDeleteEnquiry(id) {
  if (!confirm('Delete this enquiry?')) return;
  await db.collection('enquiries').doc(id).delete();
  showToast('üóë Enquiry deleted.');
  loadAdminEnquiries(); loadAdminStats();
}

async function adminEditOrg(id) {
  const doc = await db.collection('organizers').doc(id).get();
  const o = doc.data();
  document.getElementById('modalContainer').innerHTML = `
  <div class="modal-overlay" onclick="closeModal(event)">
    <div class="modal" style="max-width:660px;">
      <div class="modal-body">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
          <div style="font-family:'Playfair Display',serif;font-size:20px;font-weight:900;">‚úèÔ∏è Edit: ${o.name}</div>
          <div class="modal-close" style="position:static;width:32px;height:32px;" onclick="closeModalDirect()">‚úï</div>
        </div>
        <div class="cloudinary-info">‚òÅÔ∏è Photos are stored on Cloudinary ‚Äî unlimited storage, fast loading worldwide</div>
        <div class="form-row">
          <div class="form-group"><label>Organizer Name</label><input type="text" id="editOrgName" value="${o.name||''}"></div>
          <div class="form-group"><label>Company Name <span style="font-size:11px;color:var(--muted);">(optional)</span></label><input type="text" id="editOrgCompany" value="${o.company||''}"></div>
        </div>
        <div class="form-group"><label>Category</label>
          <select id="editOrgCat" style="width:100%;padding:10px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:inherit;font-size:14px;">
            <option>Wedding</option><option>Corporate</option><option>Birthday</option>
            <option>Concert</option><option>Sports</option><option>Conference</option>
            <option>Social</option><option>Other</option>
          </select>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Phone Number</label><input type="text" id="editOrgPhone" value="${o.phone||''}"></div>
          <div class="form-group"><label>WhatsApp</label><input type="text" id="editOrgWhatsapp" value="${o.whatsapp||''}"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Email</label><input type="email" id="editOrgEmail" value="${o.email||''}"></div>
          <div class="form-group"><label>Location / City</label><input type="text" id="editOrgLocation" value="${o.location||''}"></div>
        </div>
        <div class="form-group"><label>Bio / Description</label><textarea id="editOrgBio" rows="3">${o.bio||''}</textarea></div>
        <div class="form-row">
          <div class="form-group"><label>Min Price (‚Çπ)</label><input type="number" id="editOrgPriceMin" value="${o.priceMin||0}"></div>
          <div class="form-group"><label>Max Price (‚Çπ)</label><input type="number" id="editOrgPriceMax" value="${o.priceMax||0}"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Years of Experience</label><input type="number" id="editOrgExp" value="${o.experience||''}"></div>
          <div class="form-group"><label>Website <span style="font-size:11px;color:var(--muted);">(optional)</span></label><input type="url" id="editOrgWebsite" value="${o.website||''}" placeholder="https://yourwebsite.com"></div>
        </div>
        <div style="background:var(--surface2);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px;">
          <div style="font-size:13px;font-weight:600;color:var(--accent);margin-bottom:12px;">üîó Social & Portfolio Links <span style="font-size:11px;color:var(--muted);font-weight:400;">(optional)</span></div>
          <div class="form-row">
            <div class="form-group" style="margin:0;"><label style="display:flex;align-items:center;gap:6px;"><span style="font-size:16px;">üìÇ</span> Google Drive</label><input type="url" id="editOrgDrive" value="${o.driveLink||''}" placeholder="https://drive.google.com/..."></div>
            <div class="form-group" style="margin:0;"><label style="display:flex;align-items:center;gap:6px;"><span style="font-size:16px;">üì∏</span> Instagram</label><input type="url" id="editOrgInsta" value="${o.instagram||''}" placeholder="https://instagram.com/..."></div>
          </div>
          <div class="form-group" style="margin-top:12px;margin-bottom:0;"><label style="display:flex;align-items:center;gap:6px;"><span style="font-size:16px;">üìò</span> Facebook Page</label><input type="url" id="editOrgFb" value="${o.facebook||''}" placeholder="https://facebook.com/..."></div>
        </div>
        <div class="form-group">
          <label>Photos <span style="font-size:11px;color:var(--muted);">(select new photos to add/replace ‚Äî Cloudinary)</span></label>
          <input type="file" id="editOrgPhotos" accept="image/*" multiple onchange="previewMultipleImgs(this,'editOrgPhotosPreview')">
          <div id="editOrgPhotosPreview" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;">
            ${(o.photos&&o.photos.length)?o.photos.map(p=>`<img src="${p}" style="width:60px;height:60px;object-fit:cover;border-radius:8px;border:1px solid var(--border);">`).join(''):''}
          </div>
          <div class="upload-progress-wrap" id="editOrgUploadProgress">
            <div class="upload-progress-text"><span id="editOrgUploadStatusText">‚òÅÔ∏è Uploading to Cloudinary...</span><span class="upload-status-icon" id="editOrgUploadIcon">‚è≥</span></div>
            <div class="upload-progress-bar-bg"><div class="upload-progress-bar" id="editOrgUploadBar"></div></div>
          </div>
        </div>
        <div style="display:flex;gap:10px;margin-top:8px;">
          <button class="btn-primary btn-sm" onclick="saveEditOrg('${id}')">üíæ Save Changes</button>
          <button class="btn-secondary btn-sm" onclick="closeModalDirect()">Cancel</button>
        </div>
      </div>
    </div>
  </div>`;
  const sel = document.getElementById('editOrgCat');
  if (sel && o.category) sel.value = o.category;
}

async function saveEditOrg(id) {
  const btn = document.querySelector('#modalContainer .btn-primary');
  btn.disabled = true; btn.textContent = '‚è≥ Saving...';
  try {
    // Upload new photos if selected
    let photos = null;
    const files = document.getElementById('editOrgPhotos').files;
    if (files && files.length > 0) {
      btn.textContent = '‚òÅÔ∏è Uploading photos...';
      photos = await uploadMultipleToCloudinary(
        Array.from(files), 'editOrgUploadProgress', 'editOrgUploadBar', 'editOrgUploadStatusText', 'editOrgUploadIcon'
      );
    }
    const update = {
      name:       document.getElementById('editOrgName').value,
      company:    document.getElementById('editOrgCompany').value || '',
      category:   document.getElementById('editOrgCat').value,
      phone:      document.getElementById('editOrgPhone').value,
      whatsapp:   document.getElementById('editOrgWhatsapp').value,
      email:      document.getElementById('editOrgEmail').value,
      location:   document.getElementById('editOrgLocation').value,
      bio:        document.getElementById('editOrgBio').value,
      priceMin:   Number(document.getElementById('editOrgPriceMin').value) || 0,
      priceMax:   Number(document.getElementById('editOrgPriceMax').value) || 0,
      experience: document.getElementById('editOrgExp').value,
      website:    document.getElementById('editOrgWebsite').value || '',
      driveLink:  document.getElementById('editOrgDrive').value || '',
      instagram:  document.getElementById('editOrgInsta').value || '',
      facebook:   document.getElementById('editOrgFb').value || '',
    };
    if (photos && photos.length > 0) {
      update.photos = photos;
      update.photo  = photos[0];
    }
    await db.collection('organizers').doc(id).update(update);
    showToast('‚úÖ Organizer updated!');
    closeModalDirect();
    loadAdminOrganizers();
  } catch(e) {
    showToast('Error: ' + e.message, 'error');
    btn.disabled = false; btn.textContent = 'üíæ Save Changes';
  }
}

let adminVendorType = 'photographer';
function adminSelectVendorType(type, btn) {
  adminVendorType = type;
  document.querySelectorAll('#adminVendorTypeBtns .vendor-type-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  const labels = {
    photographer: { title:'üì∏ Adding: Photographer',        specialty:'Specialty',        sp:'e.g. Wedding, Portrait' },
    makeup:       { title:'üíÑ Adding: Makeup Artist',        specialty:'Makeup Specialty', sp:'e.g. Bridal, HD Makeup' },
    gifts:        { title:'üéÅ Adding: Return Gifts Seller',  specialty:'Products Offered', sp:'e.g. Gift hampers, Dry fruits' }
  };
  const l = labels[type];
  document.getElementById('adminVendorTypeLabel').textContent = l.title;
  document.getElementById('avSpecialtyLabel').textContent = l.specialty;
  document.getElementById('avSpecialty').placeholder = l.sp;
  const pg = document.getElementById('avPhotoGroup');
  if (pg) pg.style.display = type === 'gifts' ? 'none' : 'block';
}

document.getElementById('adminVendorForm').addEventListener('submit', async e => {
  e.preventDefault();
  const btn = e.target.querySelector('button[type=submit]');
  btn.disabled = true; btn.textContent = '‚òÅÔ∏è Uploading photos...';

  let photos = [];
  const files = document.getElementById('avPhotos').files;
  if (files.length > 0 && adminVendorType !== 'gifts') {
    try {
      photos = await uploadMultipleToCloudinary(
        Array.from(files), 'avUploadProgress', 'avUploadBar', 'avUploadStatusText', 'avUploadIcon'
      );
    } catch(err) {
      showToast('Photo upload failed: ' + err.message, 'error');
      btn.disabled = false; btn.textContent = '‚ú¶ Publish Listing';
      return;
    }
  }

  btn.textContent = 'üíæ Saving...';
  await db.collection('vendors').add({
    type:      adminVendorType,
    name:      document.getElementById('avName').value,
    company:   document.getElementById('avCompany').value || '',
    phone:     document.getElementById('avPhone').value,
    whatsapp:  document.getElementById('avWhatsapp').value || document.getElementById('avPhone').value,
    email:     document.getElementById('avEmail').value,
    website:   document.getElementById('avWebsite').value || '',
    location:  document.getElementById('avLocation').value,
    bio:       document.getElementById('avBio').value || '',
    experience:document.getElementById('avExp').value || '',
    specialty: document.getElementById('avSpecialty').value || '',
    priceMin:  document.getElementById('avPriceMin').value || 0,
    priceMax:  document.getElementById('avPriceMax').value || 0,
    driveLink: document.getElementById('avDriveLink').value || '',
    instagram: document.getElementById('avInstagram').value || '',
    facebook:  document.getElementById('avFacebook').value || '',
    photos, photo: photos[0] || '',
    owner: ADMIN_EMAIL,
    rating: 0, reviewCount: 0, createdAt: new Date()
  });

  document.getElementById('adminVendorForm').reset();
  document.getElementById('avPhotosPreview').innerHTML = '';
  btn.textContent = '‚ú¶ Publish Listing'; btn.disabled = false;
  showToast('‚úÖ Professional listing published!');
  loadAdminStats();
});

document.getElementById('adminOrgForm').addEventListener('submit', async e => {
  e.preventDefault();
  const files = document.getElementById('aoPhotos').files;
  if (!files.length) { showToast('Please select at least one photo', 'error'); return; }
  const btn = e.target.querySelector('button[type=submit]');
  btn.disabled = true;
  const checkedCats = [...document.querySelectorAll('#aoCatCheckboxes input:checked')].map(c => c.value);
  if (!checkedCats.length) { showToast('Please select at least one category', 'error'); btn.disabled = false; return; }

  btn.textContent = '‚òÅÔ∏è Uploading photos...';
  let photos = [];
  try {
    photos = await uploadMultipleToCloudinary(
      Array.from(files), 'aoUploadProgress', 'aoUploadBar', 'aoUploadStatusText', 'aoUploadIcon'
    );
  } catch(err) {
    showToast('Photo upload failed: ' + err.message, 'error');
    btn.disabled = false; btn.textContent = '‚ú¶ Publish Organizer Profile';
    return;
  }

  btn.textContent = 'üíæ Saving...';
  await db.collection('organizers').add({
    name:       document.getElementById('aoName').value,
    company:    document.getElementById('aoCompany').value || '',
    phone:      document.getElementById('aoPhone').value,
    whatsapp:   document.getElementById('aoWhatsapp').value || document.getElementById('aoPhone').value,
    email:      document.getElementById('aoEmail').value,
    category:   checkedCats[0], categories: checkedCats,
    bio:        document.getElementById('aoBio').value,
    location:   document.getElementById('aoLocation').value,
    experience: document.getElementById('aoExp').value || '',
    priceMin:   document.getElementById('aoPriceMin').value || 0,
    priceMax:   document.getElementById('aoPriceMax').value || 0,
    photo: photos[0], photos,
    owner: ADMIN_EMAIL,
    rating: 0, reviewCount: 0, createdAt: new Date()
  });

  document.getElementById('adminOrgForm').reset();
  document.getElementById('aoImgsPreview').innerHTML = '';
  document.querySelectorAll('#aoCatCheckboxes .cat-chip').forEach(c => c.classList.remove('selected'));
  document.querySelectorAll('#aoCatCheckboxes input').forEach(c => c.checked = false);
  btn.textContent = '‚ú¶ Publish Organizer Profile'; btn.disabled = false;
  showToast('‚úÖ Organizer profile published!');
  loadAdminStats();
});

document.getElementById('orgForm').addEventListener('submit', async e => {
  e.preventDefault();
  const files = document.getElementById('orgPhoto').files;
  if (!files.length) { showToast('Please select at least one photo', 'error'); return; }
  const btn = e.target.querySelector('button[type=submit]');
  btn.disabled = true;
  const checkedCats = [...document.querySelectorAll('#catCheckboxes input:checked')].map(c => c.value);
  if (!checkedCats.length) { showToast('Please select at least one category', 'error'); btn.disabled = false; return; }

  btn.textContent = '‚òÅÔ∏è Uploading photos...';
  let photos = [];
  try {
    photos = await uploadMultipleToCloudinary(
      Array.from(files), 'orgUploadProgress', 'orgUploadBar', 'orgUploadStatusText', 'orgUploadIcon'
    );
  } catch(err) {
    showToast('Photo upload failed: ' + err.message, 'error');
    btn.disabled = false; btn.textContent = '‚ú¶ Publish Profile';
    return;
  }

  btn.textContent = 'üíæ Saving...';
  await db.collection('organizers').add({
    name:       document.getElementById('orgName').value,
    company:    document.getElementById('orgCompany').value || '',
    phone:      document.getElementById('orgPhone').value,
    whatsapp:   document.getElementById('orgWhatsapp').value || document.getElementById('orgPhone').value,
    website:    document.getElementById('orgWebsite').value || '',
    driveLink:  document.getElementById('orgDriveLink').value || '',
    instagram:  document.getElementById('orgInstagram').value || '',
    facebook:   document.getElementById('orgFacebook').value || '',
    email:      document.getElementById('orgEmail').value,
    category:   checkedCats[0], categories: checkedCats,
    bio:        document.getElementById('orgBio').value,
    location:   document.getElementById('orgLocation').value,
    experience: document.getElementById('orgExp').value || '',
    priceMin:   document.getElementById('orgPriceMin').value || 0,
    priceMax:   document.getElementById('orgPriceMax').value || 0,
    photo: photos[0], photos,
    owner: currentUser.email,
    rating: 0, reviewCount: 0, createdAt: new Date()
  });

  document.getElementById('orgForm').reset();
  document.getElementById('orgImgsPreview').innerHTML = '';
  document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('selected'));
  document.querySelectorAll('#catCheckboxes input').forEach(c => c.checked = false);
  btn.textContent = '‚ú¶ Publish Profile'; btn.disabled = false;
  showToast('‚ú¶ Profile published!');
  loadOrgStats();
});

async function loadOrgStats() {
  const [profSnap, evtSnap, enqSnap] = await Promise.all([
    db.collection('organizers').where('owner','==',currentUser.email).get(),
    db.collection('events').where('owner','==',currentUser.email).get(),
    db.collection('enquiries').where('toEmail','==',currentUser.email).get()
  ]);
  document.getElementById('statProfiles').textContent  = profSnap.size;
  document.getElementById('statEvents').textContent    = evtSnap.size;
  document.getElementById('statEnquiries').textContent = enqSnap.size;
}

document.getElementById('eventForm').addEventListener('submit', async e => {
  e.preventDefault();
  const price = parseInt(document.getElementById('evtPrice').value) || 0;
  await db.collection('events').add({
    name:        document.getElementById('evtName').value,
    category:    document.getElementById('evtCategory').value,
    date:        document.getElementById('evtDate').value,
    price, venue:document.getElementById('evtVenue').value,
    description: document.getElementById('evtDesc').value,
    owner: currentUser.email, createdAt: new Date()
  });
  document.getElementById('eventForm').reset();
  showToast('üé™ Event posted!');
  loadMyEvents(); loadOrgStats();
});

async function loadMyEvents() {
  const el = document.getElementById('myEventsList');
  if (!el) return;
  el.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
  const snap = await db.collection('events').where('owner','==',currentUser.email).orderBy('createdAt','desc').get();
  if (snap.empty) { el.innerHTML = '<p style="color:var(--muted);font-size:14px;">No events posted yet.</p>'; return; }
  el.innerHTML = '';
  snap.forEach(doc => {
    const ev = doc.data(); const d = new Date(ev.date);
    el.innerHTML += `
    <div class="enquiry-item" style="display:flex;align-items:flex-start;gap:14px;">
      <div style="flex-shrink:0;text-align:center;background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:8px 12px;">
        <div style="font-size:9px;text-transform:uppercase;letter-spacing:1px;color:var(--accent);font-weight:600;">${d.toLocaleString('default',{month:'short'})}</div>
        <div style="font-size:22px;font-weight:900;font-family:'Playfair Display',serif;line-height:1;">${d.getDate()}</div>
      </div>
      <div style="flex:1;">
        <div style="font-family:'Playfair Display',serif;font-size:16px;font-weight:700;">${ev.name}</div>
        <div style="font-size:12px;color:var(--muted);margin-top:3px;">üìç ${ev.venue} &nbsp;|&nbsp; <span class="badge badge-${getCatColor(ev.category)}" style="margin:0;">${ev.category}</span></div>
        <div style="font-size:16px;font-weight:700;color:var(--accent);margin-top:6px;">${ev.price?'‚Çπ'+ev.price.toLocaleString():'Free'}</div>
      </div>
      <button class="btn-danger btn-sm" onclick="deleteEvent('${doc.id}')">Delete</button>
    </div>`;
  });
}

async function deleteEvent(id) {
  if (!confirm('Delete this event?')) return;
  await db.collection('events').doc(id).delete();
  showToast('Event deleted.', 'error');
  loadMyEvents(); loadOrgStats();
}

async function loadAllEvents() {
  const el = document.getElementById('eventsGrid');
  el.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
  const snap = await db.collection('events').orderBy('date','asc').get();
  el.innerHTML = '';
  if (snap.empty) { el.innerHTML = '<div class="empty-state"><span class="empty-icon">üé™</span><p>No events yet.</p></div>'; return; }
  snap.forEach(doc => {
    const ev = doc.data(); const d = new Date(ev.date);
    const card = document.createElement('div');
    card.className = 'event-card';
    card.innerHTML = `
      <div class="event-date-badge">
        <div class="month">${d.toLocaleString('default',{month:'short'})}</div>
        <div class="day">${d.getDate()}</div>
      </div>
      <div class="badge badge-${getCatColor(ev.category)}" style="margin-bottom:10px;">${ev.category}</div>
      <div class="event-title">${ev.name}</div>
      <div class="event-meta">üìç ${ev.venue}</div>
      <div class="event-meta">üë§ ${ev.owner.split('@')[0]}</div>
      ${ev.description?`<div style="font-size:12px;color:var(--muted);margin-top:8px;line-height:1.5;">${ev.description.slice(0,80)}${ev.description.length>80?'...':''}</div>`:''}
      <div class="event-price">${ev.price?'‚Çπ'+ev.price.toLocaleString():'<span>Free Entry</span>'}</div>`;
    el.appendChild(card);
  });
}

async function loadInbox() {
  const el = document.getElementById('inboxList');
  el.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
  const snap = await db.collection('enquiries').where('toEmail','==',currentUser.email).orderBy('createdAt','desc').get();
  el.innerHTML = '';
  if (snap.empty) { el.innerHTML = '<div class="empty-state"><span class="empty-icon">üì¨</span><p>No enquiries yet.</p></div>'; return; }
  snap.forEach(doc => {
    const q = doc.data(); const d = q.createdAt?.toDate?.()?.toLocaleDateString() || '';
    el.innerHTML += `
    <div class="enquiry-item">
      <div class="enquiry-to" style="display:flex;justify-content:space-between;">
        <span>From: <strong>${q.fromEmail||q.fromName}</strong></span>
        <span style="font-size:11px;color:var(--muted);">${d}</span>
      </div>
      <div style="font-size:12px;color:var(--muted);margin-bottom:8px;">${q.fromPhone?'üìû '+q.fromPhone:''}</div>
      <div class="enquiry-msg">${q.message}</div>
      <div class="enquiry-status">New Enquiry</div>
    </div>`;
  });
}

async function loadMyEnquiries() {
  const el = document.getElementById('myEnquiriesList');
  el.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
  const snap = await db.collection('enquiries').where('fromEmail','==',currentUser.email).orderBy('createdAt','desc').get();
  el.innerHTML = '';
  if (snap.empty) { el.innerHTML = '<div class="empty-state"><span class="empty-icon">üìã</span><p>You haven\'t sent any enquiries yet.</p></div>'; return; }
  snap.forEach(doc => {
    const q = doc.data(); const d = q.createdAt?.toDate?.()?.toLocaleDateString() || '';
    el.innerHTML += `
    <div class="enquiry-item">
      <div class="enquiry-to" style="display:flex;justify-content:space-between;">
        <span>To: <strong>${q.toName}</strong></span>
        <span style="font-size:11px;color:var(--muted);">${d}</span>
      </div>
      <div class="enquiry-msg">${q.message}</div>
      <div class="enquiry-status">Sent</div>
    </div>`;
  });
}

function buildCatPills() {
  const cats = ['All', ...new Set(allOrganizers.map(o => o.category).filter(Boolean))];
  document.getElementById('catPills').innerHTML = cats.map(c =>
    `<div class="cat-pill${c==='All'?' active':''}" onclick="setCat('${c}',this)">${c}</div>`
  ).join('');
}

function setCat(cat, el) {
  document.querySelectorAll('.cat-pill').forEach(p => p.classList.remove('active'));
  el.classList.add('active');
  activeCategory = cat;
  filterOrganizers();
}

function filterOrganizers() {
  const term = document.getElementById('search').value.toLowerCase();
  const sort = document.getElementById('sortBy').value;
  filteredOrgList = allOrganizers.filter(o => {
    const matchCat    = activeCategory === 'All' || o.category === activeCategory;
    const matchSearch = !term || [o.name,o.email,o.phone,o.location,o.bio].join(' ').toLowerCase().includes(term);
    return matchCat && matchSearch;
  });
  if (sort === 'rating') filteredOrgList.sort((a,b) => (b.rating||0) - (a.rating||0));
  else if (sort === 'name') filteredOrgList.sort((a,b) => a.name.localeCompare(b.name));
  currentPage = 1;
  renderOrganizers(filteredOrgList);
}

function renderOrganizers(list) {
  const el = document.getElementById('list');
  el.innerHTML = '';
  if (!list.length) {
    el.innerHTML = '<div class="empty-state"><span class="empty-icon">üîç</span><p>No organizers found.</p></div>';
    return;
  }
  const pageItems = list.slice(0, currentPage * PAGE_SIZE);
  pageItems.forEach(o => {
    const isOwner = o.owner === currentUser?.email;
    const stars   = renderStars(o.rating || 0);
    const card    = document.createElement('div');
    card.className = 'org-card';
    card.onclick = () => openProfilePage(o);
    card.innerHTML = `
      <div class="org-img-wrap">
        <img src="${o.photo}" alt="${o.name}" loading="lazy">
        ${o.category ? `<div class="cat-tag">${o.category}</div>` : ''}
      </div>
      <div class="org-body">
        ${isOwner ? '<div class="badge" style="margin-bottom:8px;">‚ú¶ Your listing</div>' : ''}
        <div class="org-name">${o.name}</div>
        ${o.location  ? `<div class="org-meta">üìç ${o.location}</div>` : ''}
        <div class="org-meta">üìû ${o.phone}</div>
        ${o.whatsapp  ? `<div class="org-meta" style="color:#25d366;">üí¨ ${o.whatsapp}</div>` : ''}
        ${o.website   ? `<div class="org-meta"><a href="${o.website}" target="_blank" onclick="event.stopPropagation()" style="color:var(--accent);text-decoration:none;">üåê Website</a></div>` : ''}
        <div style="display:flex;align-items:center;gap:6px;margin-top:6px;">
          <span class="stars">${stars}</span>
          <span class="stars-count">${o.rating ? o.rating.toFixed(1)+' ('+o.reviewCount+')' : 'No reviews'}</span>
        </div>
      </div>
      <div class="org-footer" style="cursor:pointer;">
        <span style="font-size:12px;color:var(--muted);">${o.email.split('@')[0]}@‚Ä¶</span>
        <span style="font-size:12px;color:var(--accent);font-weight:600;">View ‚Üí</span>
      </div>`;
    el.appendChild(card);
  });

  if (pageItems.length < list.length) {
    const remaining = list.length - pageItems.length;
    const loadMoreDiv = document.createElement('div');
    loadMoreDiv.style.cssText = 'grid-column:1/-1;text-align:center;padding:10px 0 4px;';
    loadMoreDiv.innerHTML = `
      <button onclick="loadMoreOrganizers()" style="padding:12px 32px;background:var(--surface2);border:1px solid var(--border);border-radius:12px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;cursor:pointer;transition:all 0.2s;" onmouseover="this.style.borderColor='var(--accent)';this.style.color='var(--accent)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text)'">
        Load More (${remaining} more) ‚Üì
      </button>
      <div style="font-size:11px;color:var(--muted);margin-top:6px;">Showing ${pageItems.length} of ${list.length} organizers</div>`;
    el.appendChild(loadMoreDiv);
  } else if (list.length > PAGE_SIZE) {
    const countDiv = document.createElement('div');
    countDiv.style.cssText = 'grid-column:1/-1;text-align:center;font-size:12px;color:var(--muted);padding:8px 0;';
    countDiv.textContent = `‚úì All ${list.length} organizers loaded`;
    el.appendChild(countDiv);
  }
}

function loadMoreOrganizers() {
  currentPage++;
  renderOrganizers(filteredOrgList);
}

function renderStars(r) {
  const full = Math.round(r);
  return Array.from({length:5}, (_,i) => i < full ? '‚òÖ' : '‚òÜ').join('');
}

// ===== MODAL =====
async function openOrgModal(o) {
  const isOwner = o.owner === currentUser?.email;
  const snap    = await db.collection('reviews').where('orgId','==',o.id).orderBy('createdAt','desc').limit(10).get();
  const reviews = []; snap.forEach(d => reviews.push(d.data()));
  const stars   = renderStars(o.rating || 0);
  let reviewsHtml = reviews.length ? reviews.map(rv => `
    <div class="review-card">
      <div class="review-top">
        <span class="review-author">${rv.authorName||rv.authorEmail.split('@')[0]}</span>
        <span>${renderStars(rv.rating)} <span class="review-date">${rv.createdAt?.toDate?.()?.toLocaleDateString()||''}</span></span>
      </div>
      <div class="review-text">${rv.text}</div>
    </div>`).join('') : '<p style="font-size:13px;color:var(--muted);">No reviews yet.</p>';

  document.getElementById('modalContainer').innerHTML = `
  <div class="modal-overlay" onclick="closeModal(event)">
    <div class="modal" id="mainModal">
      <div class="modal-img-wrap">
        <img class="modal-img" id="modalMainImg" src="${o.photo}" alt="${o.name}">
        <div class="modal-close" onclick="closeModalDirect()">‚úï</div>
      </div>
      ${o.photos&&o.photos.length>1?`<div style="display:flex;gap:8px;padding:12px 16px 0;overflow-x:auto;">${o.photos.map((p,i)=>`<img src="${p}" onclick="document.getElementById('modalMainImg').src='${p}'" style="width:60px;height:60px;object-fit:cover;border-radius:8px;cursor:pointer;border:2px solid ${i===0?'var(--accent)':'var(--border)'};flex-shrink:0;">`).join('')}</div>`:''}
      <div class="modal-body">
        ${o.category?`<div class="badge" style="margin-bottom:12px;">${o.category}</div>`:''}
        <div class="modal-name">${o.name}</div>
        <div style="display:flex;align-items:center;gap:8px;margin:6px 0 14px;">
          <span class="stars" style="font-size:16px;">${stars}</span>
          <span style="font-size:13px;color:var(--muted);">${o.rating?o.rating.toFixed(1)+' ¬∑ '+o.reviewCount+' review(s)':'No reviews yet'}</span>
        </div>
        ${o.bio?`<p style="font-size:14px;color:var(--muted);line-height:1.6;margin-bottom:16px;">${o.bio}</p>`:''}
        <div class="info-grid">
          <div class="info-item"><div class="info-item-label">Phone</div><div class="info-item-value">üìû ${o.phone}</div></div>
          <div class="info-item"><div class="info-item-label">WhatsApp</div><div class="info-item-value">üí¨ ${o.whatsapp||o.phone}</div></div>
          <div class="info-item"><div class="info-item-label">Email</div><div class="info-item-value">‚úâ ${o.email}</div></div>
          ${o.location?`<div class="info-item"><div class="info-item-label">Location</div><div class="info-item-value">üìç ${o.location}</div></div>`:''}
          ${o.website?`<div class="info-item" style="grid-column:1/-1;"><div class="info-item-label">Website</div><div class="info-item-value"><a href="${o.website}" target="_blank" style="color:var(--accent);text-decoration:none;">üåê ${o.website}</a></div></div>`:''}
        </div>
        <div class="modal-actions">
          ${!isOwner?`<button class="btn-primary btn-sm" onclick="scrollToEnquiry()">üì© Send Enquiry</button>`:''}
          <button class="btn-secondary btn-sm" onclick="window.open('tel:${o.phone}')">üìû Call</button>
          ${!isOwner?`<button class="btn-secondary btn-sm" style="background:rgba(37,211,102,0.1);border-color:rgba(37,211,102,0.3);color:#25d366;" onclick="window.open('https://wa.me/91${waNumber(o.whatsapp||o.phone)}','_blank')">üí¨ WhatsApp</button>`:''}
          ${isOwner||currentUser?.email===ADMIN_EMAIL?`<button class="btn-danger btn-sm" onclick="deleteOrg('${o.id}')">Delete</button>`:''}
        </div>
        <div class="reviews-section">
          <h4>Reviews & Ratings</h4>
          <div id="reviewsList">${reviewsHtml}</div>
          ${!isOwner?`<div class="review-form">
            <div style="font-size:13px;font-weight:600;margin-bottom:8px;">Leave a review</div>
            <div class="star-picker" id="starPicker">
              <span onclick="setStar(1)">‚òÖ</span><span onclick="setStar(2)">‚òÖ</span>
              <span onclick="setStar(3)">‚òÖ</span><span onclick="setStar(4)">‚òÖ</span>
              <span onclick="setStar(5)">‚òÖ</span>
            </div>
            <div class="form-group"><textarea id="reviewText" rows="2" placeholder="Share your experience..."></textarea></div>
            <button class="btn-purple btn-sm" onclick="submitReview('${o.id}','${o.owner}','${o.name}')">Submit Review</button>
          </div>`:''}
        </div>
        ${!isOwner?`<div class="enquiry-form" id="enquiryFormSection">
          <h4>üì© Send Enquiry</h4>
          <div class="form-group"><input type="text" id="enqName" placeholder="Your name" value="${currentUser.displayName || currentUser.email.split('@')[0]}"></div>
          <div class="form-group"><input type="tel" id="enqPhone" placeholder="Your phone number"></div>
          <div class="form-group"><textarea id="enqMsg" rows="3" placeholder="Describe your event requirements..."></textarea></div>
          <button class="btn-primary btn-sm" onclick="sendEnquiry('${o.id}','${o.owner}','${o.name}')">Send Message</button>
        </div>`:''}
      </div>
    </div>
  </div>`;
  selectedStar = 0;
}

let selectedStar = 0;
function setStar(n) { selectedStar = n; document.querySelectorAll('#starPicker span').forEach((s,i) => s.classList.toggle('lit', i < n)); }
function scrollToEnquiry() { document.getElementById('enquiryFormSection')?.scrollIntoView({behavior:'smooth', block:'start'}); }
function closeModal(e) { if (e.target.classList.contains('modal-overlay')) closeModalDirect(); }
function closeModalDirect() { document.getElementById('modalContainer').innerHTML = ''; }

async function submitReview(orgId, orgOwner, orgName) {
  if (!selectedStar) { showToast('Please select a star rating', 'error'); return; }
  const text = document.getElementById('reviewText').value.trim();
  if (!text) { showToast('Please write a review', 'error'); return; }
  await db.collection('reviews').add({orgId, orgOwner, orgName, rating: selectedStar, text, authorEmail: currentUser.email, authorName: currentUser.email.split('@')[0], createdAt: new Date()});
  const allRev = await db.collection('reviews').where('orgId','==',orgId).get();
  let total = 0; allRev.forEach(d => total += d.data().rating);
  await db.collection('organizers').doc(orgId).update({rating: total/allRev.size, reviewCount: allRev.size});
  showToast('‚≠ê Review submitted!');
  closeModalDirect(); loadOrganizers();
}

async function sendEnquiry(orgId, toEmail, toName) {
  const msg = document.getElementById('enqMsg').value.trim();
  if (!msg) { showToast('Please write a message', 'error'); return; }
  await db.collection('enquiries').add({orgId, toEmail, toName, fromEmail: currentUser.email, fromName: document.getElementById('enqName').value.trim(), fromPhone: document.getElementById('enqPhone').value.trim(), message: msg, createdAt: new Date()});
  trackEvent('enquiry_sent', 'engagement', toName);
  showToast('üì© Enquiry sent!');
  closeModalDirect();
}

async function deleteOrg(id) {
  if (!confirm('Delete this organizer profile?')) return;
  const doc = await db.collection('organizers').doc(id).get();
  if (doc.exists) logCloudinaryDeletion(doc.data().photos);
  await db.collection('organizers').doc(id).delete();
  showToast('Listing removed.', 'error');
  closeModalDirect();
  if (!document.getElementById('profilePage').classList.contains('hidden')) {
    document.getElementById('profilePage').classList.add('hidden');
    document.getElementById('customer').classList.remove('hidden');
  }
  loadOrganizers(); loadOrgStats();
}

async function loadMyProfiles() {
  const el = document.getElementById('myProfilesList');
  if (!el) return;
  el.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
  let snap;
  try {
    snap = await db.collection('organizers').where('owner','==',currentUser.email).orderBy('createdAt','desc').get();
  } catch(e) {
    snap = await db.collection('organizers').where('owner','==',currentUser.email).get();
  }
  if (snap.empty) {
    el.innerHTML = '<div class="empty-state"><span class="empty-icon">üé≠</span><p>Koi profile nahi hai abhi. "New Profile" tab se add karo.</p></div>';
    return;
  }
  el.innerHTML = '';
  snap.forEach(doc => {
    const o = {id: doc.id, ...doc.data()};
    const div = document.createElement('div');
    div.style.cssText = 'background:var(--surface);border:1px solid var(--border);border-radius:16px;overflow:hidden;margin-bottom:16px;';
    div.innerHTML = `
      <div style="display:flex;gap:14px;padding:16px;align-items:flex-start;flex-wrap:wrap;">
        ${o.photo ? `<img src="${o.photo}" style="width:80px;height:80px;object-fit:cover;border-radius:12px;border:2px solid var(--border);flex-shrink:0;">` : '<div style="width:80px;height:80px;background:var(--surface2);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:28px;flex-shrink:0;">üé≠</div>'}
        <div style="flex:1;min-width:200px;">
          <div style="font-family:\'Playfair Display\',serif;font-size:18px;font-weight:700;margin-bottom:4px;">${o.name}</div>
          <div style="font-size:12px;color:var(--muted);margin-bottom:8px;">üìç ${o.location||'‚Äî'} &nbsp;|&nbsp; üìÅ ${o.category||'‚Äî'} &nbsp;|&nbsp; ‚≠ê ${o.rating?o.rating.toFixed(1):0} (${o.reviewCount||0})</div>
          ${o.photos&&o.photos.length>1?`<div style="display:flex;gap:4px;flex-wrap:wrap;margin-bottom:8px;">${o.photos.slice(0,6).map(p=>`<img src="${p}" style="width:36px;height:36px;object-fit:cover;border-radius:6px;border:1px solid var(--border);">`).join('')}<span style="font-size:11px;color:var(--muted);align-self:center;">${o.photos.length} photos</span></div>`:''}
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button class="btn-secondary btn-sm" onclick="openEditMyProfile('${o.id}')">‚úèÔ∏è Edit Profile</button>
            <button class="btn-danger btn-sm" onclick="deleteOrg('${o.id}')">üóë Delete</button>
          </div>
        </div>
      </div>`;
    el.appendChild(div);
  });
}

async function openEditMyProfile(id) {
  const docSnap = await db.collection('organizers').doc(id).get();
  const o = {id, ...docSnap.data()};
  const allCatOptions = ['Wedding','Birthday','Corporate','Concert','Sports','Conference','Social','Other'];
  const catEmojis     = {Wedding:'üíç',Birthday:'üéÇ',Corporate:'üè¢',Concert:'üéµ',Sports:'üèÖ',Conference:'üé§',Social:'üéä',Other:'‚ú®'};
  const existingCats  = o.categories || (o.category ? [o.category] : []);
  const catHtml = allCatOptions.map(c => `
    <label class="cat-chip ${existingCats.includes(c)?'selected':''}" id="ecp_${c}">
      <input type="checkbox" value="${c}" ${existingCats.includes(c)?'checked':''}> ${catEmojis[c]} ${c}
    </label>`).join('');

  document.getElementById('modalContainer').innerHTML = `
  <div class="modal-overlay" onclick="closeModal(event)">
    <div class="modal" style="max-width:660px;">
      <div class="modal-body">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
          <div style="font-family:'Playfair Display',serif;font-size:22px;font-weight:900;">‚úèÔ∏è Edit: ${o.name}</div>
          <div class="modal-close" style="position:static;" onclick="closeModalDirect()">‚úï</div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Organizer Name</label><input type="text" id="eoName" value="${o.name||''}"></div>
          <div class="form-group"><label>Company Name</label><input type="text" id="eoCompany" value="${o.company||''}"></div>
        </div>
        <div class="form-group">
          <label>Categories</label>
          <div id="eoCatCheckboxes" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;">${catHtml}</div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Phone</label><input type="tel" id="eoPhone" value="${o.phone||''}"></div>
          <div class="form-group"><label>WhatsApp</label><input type="tel" id="eoWhatsapp" value="${o.whatsapp||''}"></div>
        </div>
        <div class="form-group"><label>Email</label><input type="email" id="eoEmail" value="${o.email||''}"></div>
        <div class="form-group"><label>Location / City</label><input type="text" id="eoLocation" value="${o.location||''}"></div>
        <div class="form-group"><label>Bio / Description</label><textarea id="eoBio" rows="3">${o.bio||''}</textarea></div>
        <div class="form-row">
          <div class="form-group"><label>Min Price (‚Çπ)</label><input type="number" id="eoPriceMin" value="${o.priceMin||0}"></div>
          <div class="form-group"><label>Max Price (‚Çπ)</label><input type="number" id="eoPriceMax" value="${o.priceMax||0}"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Years of Experience</label><input type="number" id="eoExp" value="${o.experience||''}"></div>
          <div class="form-group"><label>WhatsApp Number</label><input type="tel" id="eoWhatsapp2" value="${o.whatsapp||''}"></div>
        </div>
        <div class="form-group">
          <label>Add More Photos <span style="font-size:11px;color:var(--muted);">(existing photos kept, new ones added via Cloudinary)</span></label>
          <input type="file" id="eoPhotos" accept="image/*" multiple onchange="previewMultipleImgs(this,'eoPhotosPreview')">
          <div id="eoPhotosPreview" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;"></div>
          <div class="upload-progress-wrap" id="eoUploadProgress">
            <div class="upload-progress-text">
              <span id="eoUploadStatusText">‚òÅÔ∏è Uploading to Cloudinary...</span>
              <span id="eoUploadIcon">‚è≥</span>
            </div>
            <div class="upload-progress-bar-bg"><div class="upload-progress-bar" id="eoUploadBar"></div></div>
          </div>
          ${o.photos&&o.photos.length?`<div style="margin-top:10px;"><div style="font-size:11px;color:var(--muted);margin-bottom:6px;text-transform:uppercase;letter-spacing:1px;">Current Photos</div><div style="display:flex;flex-wrap:wrap;gap:6px;">${o.photos.map((p,i)=>`<div style="position:relative;"><img src="${p}" style="width:60px;height:60px;object-fit:cover;border-radius:8px;border:2px solid ${i===0?'var(--accent)':'var(--border)'};">${i===0?'<div style="position:absolute;bottom:2px;left:50%;transform:translateX(-50%);background:var(--accent);color:#000;font-size:8px;font-weight:700;padding:1px 4px;border-radius:3px;white-space:nowrap;">MAIN</div>':''}</div>`).join('')}</div></div>`:''}
        </div>
        <div style="display:flex;gap:10px;margin-top:16px;flex-wrap:wrap;">
          <button class="btn-primary btn-sm" onclick="saveMyProfile('${id}')">üíæ Save Changes</button>
          <button class="btn-secondary btn-sm" onclick="closeModalDirect()">Cancel</button>
        </div>
      </div>
    </div>
  </div>`;

  document.querySelectorAll('#eoCatCheckboxes .cat-chip').forEach(chip => {
    chip.addEventListener('click', () => {
      const cb = chip.querySelector('input[type=checkbox]');
      cb.checked = !cb.checked;
      chip.classList.toggle('selected', cb.checked);
    });
  });
}

async function saveMyProfile(id) {
  const btn = document.querySelector('#modalContainer .btn-primary');
  btn.disabled = true; btn.textContent = '‚è≥ Saving...';

  const checkedCats = [...document.querySelectorAll('#eoCatCheckboxes input:checked')].map(c => c.value);
  if (!checkedCats.length) { showToast('Please select at least one category', 'error'); btn.disabled=false; btn.textContent='üíæ Save Changes'; return; }

  const newFiles = document.getElementById('eoPhotos').files;
  let newPhotoUrls = [];
  if (newFiles.length > 0) {
    btn.textContent = '‚òÅÔ∏è Uploading photos...';
    try {
      newPhotoUrls = await uploadMultipleToCloudinary(
        Array.from(newFiles), 'eoUploadProgress', 'eoUploadBar', 'eoUploadStatusText', 'eoUploadIcon'
      );
    } catch(err) {
      showToast('Photo upload failed: ' + err.message, 'error');
      btn.disabled = false; btn.textContent = 'üíæ Save Changes';
      return;
    }
  }

  const existing = await db.collection('organizers').doc(id).get();
  const existingPhotos = existing.data().photos || [];
  const allPhotos = [...existingPhotos, ...newPhotoUrls];

  btn.textContent = 'üíæ Saving...';
  try {
    await db.collection('organizers').doc(id).update({
      name:       document.getElementById('eoName').value,
      company:    document.getElementById('eoCompany').value || '',
      phone:      document.getElementById('eoPhone').value,
      whatsapp:   document.getElementById('eoWhatsapp').value || document.getElementById('eoPhone').value,
      email:      document.getElementById('eoEmail').value,
      location:   document.getElementById('eoLocation').value,
      bio:        document.getElementById('eoBio').value,
      priceMin:   Number(document.getElementById('eoPriceMin').value) || 0,
      priceMax:   Number(document.getElementById('eoPriceMax').value) || 0,
      experience: document.getElementById('eoExp').value || '',
      category:   checkedCats[0],
      categories: checkedCats,
      photos:     allPhotos,
      photo:      allPhotos[0] || '',
    });
    showToast('‚úÖ Profile updated!');
    closeModalDirect();
    loadMyProfiles();
    loadOrganizers();
    loadOrgStats();
  } catch(e) { showToast('Error: ' + e.message, 'error'); }
  btn.disabled = false; btn.textContent = 'üíæ Save Changes';
}


function openTransferModal(docId, docType, docName, currentOwner) {
  document.getElementById('modalContainer').innerHTML = `
  <div class="modal-overlay" onclick="closeModal(event)">
    <div class="modal" style="max-width:460px;">
      <div class="modal-body">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;">
          <div style="font-family:'Playfair Display',serif;font-size:20px;font-weight:900;">üîÑ Transfer Ownership</div>
          <div class="modal-close" style="position:static;width:32px;height:32px;" onclick="closeModalDirect()">‚úï</div>
        </div>
        <div style="background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:14px;">
          <div style="font-size:11px;color:var(--muted);margin-bottom:4px;">LISTING</div>
          <div style="font-weight:700;font-size:15px;">${docName}</div>
          <div style="font-size:12px;color:var(--muted);margin-top:3px;">Current Owner: ${currentOwner}</div>
        </div>
        <div style="background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.2);border-radius:10px;padding:10px 14px;margin-bottom:16px;font-size:12px;color:var(--muted);">
          ‚úÖ <strong style="color:var(--accent);">Tumhara admin access hamesha rahega</strong>
        </div>
        <div class="form-group">
          <label>New Owner Email</label>
          <input type="email" id="t_e1" placeholder="newowner@email.com" style="width:100%;padding:12px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:inherit;font-size:14px;outline:none;box-sizing:border-box;">
        </div>
        <div class="form-group">
          <label>Confirm Email</label>
          <input type="email" id="t_e2" placeholder="Dobara likho..." style="width:100%;padding:12px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:inherit;font-size:14px;outline:none;box-sizing:border-box;">
        </div>
        <div id="t_err" style="color:#e07070;font-size:12px;min-height:16px;margin-bottom:8px;"></div>
        <div style="display:flex;gap:10px;">
          <button onclick="confirmTransfer('${docId}','${docType}')" id="t_btn" style="flex:1;padding:12px;background:linear-gradient(135deg,var(--accent),#b8912f);color:#0a0a0f;border:none;border-radius:10px;font-family:inherit;font-size:14px;font-weight:700;cursor:pointer;">‚úÖ Transfer Karo</button>
          <button class="btn-secondary btn-sm" onclick="closeModalDirect()">Cancel</button>
        </div>
      </div>
    </div>
  </div>`;
}

async function confirmTransfer(docId, docType) {
  const e1 = document.getElementById('t_e1').value.trim().toLowerCase();
  const e2 = document.getElementById('t_e2').value.trim().toLowerCase();
  const err = document.getElementById('t_err');
  const btn = document.getElementById('t_btn');
  if (!e1.includes('@')) { err.textContent = '‚ö† Valid email daalo'; return; }
  if (e1 !== e2) { err.textContent = '‚ö† Emails match nahi kar rahe!'; return; }
  if (e1 === ADMIN_EMAIL) { err.textContent = '‚ö† Admin email pe transfer nahi hoga'; return; }
  btn.disabled = true; btn.textContent = '‚è≥ Please wait...';
  try {
    const col = docType === 'vendor' ? 'vendors' : 'organizers';
    const snap = await db.collection(col).doc(docId).get();
    await db.collection(col).doc(docId).update({ owner: e1, previousOwner: snap.data()?.owner || '', transferredBy: ADMIN_EMAIL, transferredAt: new Date() });
    showToast('‚úÖ ' + e1 + ' ab owner hai!');
    closeModalDirect();
    if (docType === 'vendor') loadAdminVendors(); else loadAdminOrganizers();
  } catch(ex) { err.textContent = 'Error: ' + ex.message; btn.disabled = false; btn.textContent = '‚úÖ Transfer Karo'; }
}

function openClaimModal(docId, docType, docName, currentOwner) {
  if (!currentUser) { showToast('Pehle login karo', 'error'); return; }
  document.getElementById('modalContainer').innerHTML = `
  <div class="modal-overlay" onclick="closeModal(event)">
    <div class="modal" style="max-width:460px;">
      <div class="modal-body">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;">
          <div style="font-family:'Playfair Display',serif;font-size:20px;font-weight:900;">üîë Claim Listing</div>
          <div class="modal-close" style="position:static;width:32px;height:32px;" onclick="closeModalDirect()">‚úï</div>
        </div>
        <div style="background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:14px;">
          <div style="font-size:11px;color:var(--muted);margin-bottom:4px;">LISTING</div>
          <div style="font-weight:700;font-size:15px;">${docName}</div>
        </div>
        <div style="background:rgba(92,184,92,0.07);border:1px solid rgba(92,184,92,0.2);border-radius:10px;padding:11px 14px;margin-bottom:14px;font-size:12px;color:#7ed37e;">
          Request admin ke paas jaayegi. Approve hone par yeh listing teri ho jaayegi.
        </div>
        <div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:11px 14px;margin-bottom:14px;">
          <div style="font-size:11px;color:var(--muted);margin-bottom:3px;">Tumhara account</div>
          <div style="font-weight:600;">${currentUser.email}</div>
        </div>
        <div class="form-group">
          <label>Reason / Proof <span style="text-transform:none;font-weight:400;font-size:11px;">(zaroori hai)</span></label>
          <textarea id="c_reason" rows="3" placeholder="e.g. mera hi naam/number hai..." style="width:100%;padding:12px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:inherit;font-size:13px;outline:none;resize:vertical;box-sizing:border-box;"></textarea>
        </div>
        <div style="display:flex;gap:10px;">
          <button id="c_btn" onclick="submitClaimRequest('${docId}','${docType}','${docName}','${currentOwner}')" style="flex:1;padding:12px;background:rgba(92,184,92,0.15);color:#7ed37e;border:1px solid rgba(92,184,92,0.35);border-radius:10px;font-family:inherit;font-size:14px;font-weight:600;cursor:pointer;">üîë Send Claim Request</button>
          <button class="btn-secondary btn-sm" onclick="closeModalDirect()">Cancel</button>
        </div>
      </div>
    </div>
  </div>`;
}

async function submitClaimRequest(docId, docType, docName, currentOwner) {
  const reason = document.getElementById('c_reason').value.trim();
  if (!reason) { showToast('Reason likhna zaroori hai', 'error'); return; }
  const btn = document.getElementById('c_btn');
  btn.textContent = '‚è≥ Sending...'; btn.disabled = true;
  try {
    await db.collection('claimRequests').add({ targetId:docId, targetType:docType, targetName:docName, targetOwner:currentOwner, claimantEmail:currentUser.email, claimantName:currentUser.displayName||currentUser.email.split('@')[0], reason:reason, status:'pending', createdAt:new Date() });
    showToast('‚úÖ Claim request bhej di! Admin jald review karega.');
    closeModalDirect();
  } catch(ex) { showToast('Error: '+ex.message,'error'); btn.disabled=false; btn.textContent='üîë Send Claim Request'; }
}

function filterAdminClaims(status, btn) {
  document.querySelectorAll('#adminTabClaims .vendor-type-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  loadAdminClaims(status);
}

async function loadAdminClaims(filterStatus) {
  filterStatus = filterStatus || 'all';
  const el = document.getElementById('adminClaimList');
  if (!el) return;
  el.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
  let q = db.collection('claimRequests');
  if (filterStatus !== 'all') q = q.where('status','==',filterStatus);
  let snap;
  try { snap = await q.orderBy('createdAt','desc').get(); } catch(e) { snap = await q.get(); }
  el.innerHTML = '';
  if (snap.empty) { el.innerHTML = '<div class="empty-state"><span class="empty-icon">üîë</span><p>Koi claim requests nahi hain.</p></div>'; return; }
  snap.forEach(doc => {
    const c = { id: doc.id, ...doc.data() };
    const date = c.createdAt && c.createdAt.toDate ? c.createdAt.toDate().toLocaleDateString('en-IN') : '';
    const sc = { pending:'#f0c060', approved:'#7ed37e', rejected:'#e88e8e' }[c.status] || '#aaa';
    const div = document.createElement('div');
    div.className = 'admin-item';
    if (c.status === 'pending') div.style.borderLeft = '3px solid #f0c060';
    div.dataset.claimId = c.id;
    div.dataset.targetId = c.targetId;
    div.dataset.targetType = c.targetType;
    div.dataset.claimantEmail = c.claimantEmail;
    div.dataset.targetName = c.targetName || '';
    div.innerHTML =
      '<div style="flex:1;min-width:180px;">'
      + '<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap;">'
      + '<span style="font-weight:700;">' + (c.targetType==='vendor'?'üì∏':'üé≠') + ' ' + (c.targetName||'‚Äî') + '</span>'
      + '<span style="padding:2px 9px;border-radius:20px;font-size:11px;font-weight:700;color:' + sc + ';border:1px solid ' + sc + '44;">' + (c.status||'').toUpperCase() + '</span>'
      + '<span style="font-size:11px;color:var(--muted);">' + date + '</span>'
      + '</div>'
      + '<div style="font-size:13px;color:var(--muted);line-height:1.7;">'
      + 'üôã <strong style="color:var(--text);">' + (c.claimantName||'') + '</strong> (' + (c.claimantEmail||'') + ')<br>'
      + 'üìã Current owner: ' + (c.targetOwner||'‚Äî') + '<br>'
      + 'üí¨ <em style="color:var(--text);">"' + (c.reason||'') + '"</em>'
      + '</div></div>'
      + '<div style="display:flex;flex-direction:column;gap:8px;flex-shrink:0;">'
      + (c.status === 'pending'
        ? '<button onclick="approveClaimFromDiv(this)" style="padding:8px 16px;background:rgba(92,184,92,0.15);color:#7ed37e;border:1px solid rgba(92,184,92,0.35);border-radius:8px;font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;white-space:nowrap;">‚úÖ Approve</button>'
        + '<button onclick="rejectClaimFromDiv(this)" style="padding:8px 16px;background:transparent;color:var(--danger);border:1px solid rgba(224,92,92,0.3);border-radius:8px;font-family:inherit;font-size:13px;cursor:pointer;">‚ùå Reject</button>'
        : '<span style="font-size:12px;color:' + sc + ';font-weight:600;">' + c.status + '</span>')
      + '<button onclick="deleteClaimFromDiv(this)" class="btn-danger btn-sm">üóë Delete</button>'
      + '</div>';
    el.appendChild(div);
  });
}

function approveClaimFromDiv(btn) {
  const d = btn.closest('[data-claim-id]');
  approveClaim(d.dataset.claimId, d.dataset.targetId, d.dataset.targetType, d.dataset.claimantEmail, d.dataset.targetName);
}
function rejectClaimFromDiv(btn) {
  rejectClaim(btn.closest('[data-claim-id]').dataset.claimId);
}
function deleteClaimFromDiv(btn) {
  deleteClaimRequest(btn.closest('[data-claim-id]').dataset.claimId);
}

async function approveClaim(claimId, targetId, targetType, newEmail, targetName) {
  if (!confirm('Approve: "' + targetName + '" ka ownership "' + newEmail + '" ko transfer karo?\nAdmin ka access hamesha rahega.')) return;
  try {
    const col = targetType === 'vendor' ? 'vendors' : 'organizers';
    const snap = await db.collection(col).doc(targetId).get();
    await db.collection(col).doc(targetId).update({ owner: newEmail, previousOwner: snap.data()?.owner||'', transferredBy: ADMIN_EMAIL, transferredAt: new Date() });
    await db.collection('claimRequests').doc(claimId).update({ status:'approved', approvedAt: new Date(), approvedBy: ADMIN_EMAIL });
    const others = await db.collection('claimRequests').where('targetId','==',targetId).where('status','==','pending').get();
    if (!others.empty) {
      const batch = db.batch();
      others.forEach(d => { if (d.id !== claimId) batch.update(d.ref, { status:'rejected', rejectedAt: new Date() }); });
      await batch.commit();
    }
    showToast('‚úÖ Approved! ' + newEmail + ' ab owner hai.');
    loadAdminClaims('all');
    loadAdminStats();
  } catch(ex) { showToast('Error: ' + ex.message, 'error'); }
}

async function rejectClaim(claimId) {
  if (!confirm('Yeh claim reject karo?')) return;
  await db.collection('claimRequests').doc(claimId).update({ status:'rejected', rejectedAt: new Date(), rejectedBy: ADMIN_EMAIL });
  showToast('‚ùå Claim reject kar diya.');
  loadAdminClaims('all');
}

async function deleteClaimRequest(id) {
  if (!confirm('Delete this claim request?')) return;
  await db.collection('claimRequests').doc(id).delete();
  showToast('üóë Deleted.');
  loadAdminClaims('all');
}

async function loadAdminClaimsCount() {
  try {
    const snap = await db.collection('claimRequests').where('status','==','pending').get();
    const btn = document.getElementById('claimTabBtn');
    if (btn) btn.innerHTML = snap.size > 0
      ? 'üîî Claims <span style="background:#e05c5c;color:#fff;border-radius:20px;padding:1px 7px;font-size:11px;font-weight:700;margin-left:4px;">' + snap.size + '</span>'
      : 'üîî Claims';
  } catch(e) {}
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üè† HOME ROLE POPUP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showRolePopup(type) {
  const configs = {
    organizer: {
      icon: 'üé≠',
      title: 'Organizer',
      a: { label: "I'm an Organizer", desc: 'List your business & get enquiries', action: () => showSection('organizer') },
      b: { label: 'Book an Organizer', desc: 'Find & contact event organizers', action: () => { showSection('customer'); } }
    },
    customer: {
      icon: 'üîç',
      title: 'Customer',
      a: { label: "I'm a Customer", desc: 'Browse events & find organizers', action: () => showSection('customer') },
      b: { label: 'Book an Organizer', desc: 'Find & contact event organizers', action: () => showSection('customer') }
    },
    photographer: {
      icon: 'üì∏',
      title: 'Photographer',
      a: { label: "I'm a Photographer", desc: 'List your photography services', action: () => { showSection('vendor'); } },
      b: { label: 'Book a Photographer', desc: 'Find photographers near you', action: () => { closeModalDirect(); showSection('customer'); setTimeout(() => { switchCustTab('vendors', null); setTimeout(() => { document.querySelectorAll('#vendorFilterBtns .vendor-type-btn').forEach(b=>b.classList.remove('active')); const pb=document.querySelector('#vendorFilterBtns [onclick*="photographer"]'); if(pb){pb.classList.add('active'); loadVendors('photographer');} }, 100); }, 300); } }
    },
    makeup: {
      icon: 'üíÑ',
      title: 'Makeup Artist',
      a: { label: "I'm a Makeup Artist", desc: 'Showcase your makeup work', action: () => showSection('vendor') },
      b: { label: 'Book a Makeup Artist', desc: 'Find makeup artists near you', action: () => { closeModalDirect(); showSection('customer'); setTimeout(() => { switchCustTab('vendors', null); setTimeout(() => { document.querySelectorAll('#vendorFilterBtns .vendor-type-btn').forEach(b=>b.classList.remove('active')); const mb=document.querySelector('#vendorFilterBtns [onclick*="makeup"]'); if(mb){mb.classList.add('active'); loadVendors('makeup');} }, 100); }, 300); } }
    },
    gifts: {
      icon: 'üéÅ',
      title: 'Return Gifts',
      a: { label: 'I Sell Return Gifts', desc: 'List your gift & hamper services', action: () => showSection('vendor') },
      b: { label: 'Book Return Gifts', desc: 'Find wedding favors & hampers', action: () => { closeModalDirect(); showSection('customer'); setTimeout(() => { switchCustTab('vendors', null); setTimeout(() => { document.querySelectorAll('#vendorFilterBtns .vendor-type-btn').forEach(b=>b.classList.remove('active')); const gb=document.querySelector('#vendorFilterBtns [onclick*="gifts"]'); if(gb){gb.classList.add('active'); loadVendors('gifts');} }, 100); }, 300); } }
    }
  };

  const c = configs[type];
  if (!c) return;

  document.getElementById('modalContainer').innerHTML = `
  <div class="modal-overlay" onclick="closeModal(event)">
    <div class="modal" style="max-width:420px;">
      <div class="modal-body" style="padding:32px 28px;">
        <div style="text-align:center;margin-bottom:28px;">
          <div style="font-size:48px;margin-bottom:12px;">${c.icon}</div>
          <div style="font-family:'Playfair Display',serif;font-size:22px;font-weight:900;color:var(--text);">${c.title}</div>
          <div style="font-size:13px;color:var(--muted);margin-top:6px;">What would you like to do?</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:12px;">
          <button onclick="rolePopupAction('${type}','a')" style="width:100%;padding:18px 20px;background:var(--surface2);border:1px solid var(--border);border-radius:14px;cursor:pointer;text-align:left;transition:border-color 0.2s;" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">
            <div style="font-weight:700;font-size:15px;color:var(--text);margin-bottom:4px;">‚ú¶ ${c.a.label}</div>
            <div style="font-size:12px;color:var(--muted);">${c.a.desc}</div>
          </button>
          <button onclick="rolePopupAction('${type}','b')" style="width:100%;padding:18px 20px;background:linear-gradient(135deg,rgba(201,168,76,0.08),rgba(201,168,76,0.04));border:1px solid rgba(201,168,76,0.25);border-radius:14px;cursor:pointer;text-align:left;transition:border-color 0.2s;" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='rgba(201,168,76,0.25)'">
            <div style="font-weight:700;font-size:15px;color:var(--accent);margin-bottom:4px;">üîç ${c.b.label}</div>
            <div style="font-size:12px;color:var(--muted);">${c.b.desc}</div>
          </button>
        </div>
        <button onclick="closeModalDirect()" style="width:100%;margin-top:14px;padding:10px;background:transparent;border:none;color:var(--muted);font-family:inherit;font-size:13px;cursor:pointer;">Cancel</button>
      </div>
    </div>
  </div>`;

  // Store actions for retrieval
  window._roleActions = { a: c.a.action, b: c.b.action };
}

function rolePopupAction(type, which) {
  closeModalDirect();
  if (window._roleActions && window._roleActions[which]) {
    window._roleActions[which]();
  }
}


function getCatColor(cat) {
  const map = {Wedding:'', Corporate:'blue', Birthday:'purple', Concert:'green', Sports:'blue', Conference:'blue', Social:'purple'};
  return map[cat] || '';
}
</script>

<!-- FOOTER -->
<footer style="position:relative;z-index:5;border-top:1px solid var(--border);background:var(--surface);padding:32px 40px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px;">
  <div style="display:flex;align-items:center;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 520 160" height="36" width="117">
      <defs>
        <linearGradient id="ifIG" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#FF6B6B"/><stop offset="70%" style="stop-color:#FFC837"/><stop offset="100%" style="stop-color:#FF6B9D"/></linearGradient>
        <linearGradient id="ifTG" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:#FF6B6B"/><stop offset="50%" style="stop-color:#FFC837"/><stop offset="100%" style="stop-color:#FF6B9D"/></linearGradient>
        <filter id="ifG"><feGaussianBlur stdDeviation="3" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>
      <circle cx="78" cy="80" r="44" fill="none" stroke="url(#ifIG)" stroke-width="1.5" opacity="0.9"/>
      <circle cx="78" cy="80" r="44" fill="url(#ifIG)" opacity="0.1"/>
      <circle cx="78" cy="34" r="2.5" fill="url(#ifIG)"/><circle cx="78" cy="126" r="2.5" fill="url(#ifIG)"/><circle cx="32" cy="80" r="2.5" fill="url(#ifIG)"/><circle cx="124" cy="80" r="2.5" fill="url(#ifIG)"/>
      <path d="M 55 52 L 55 88 Q 55 108 78 108 Q 101 108 101 88 L 101 52" fill="none" stroke="url(#ifIG)" stroke-width="7" stroke-linecap="round" filter="url(#ifG)"/>
      <g transform="translate(52,46)" filter="url(#ifG)"><path d="M0,-6 L1.5,-1.5 L6,0 L1.5,1.5 L0,6 L-1.5,1.5 L-6,0 L-1.5,-1.5 Z" fill="#FFC837"/></g>
      <g transform="translate(104,46)" filter="url(#ifG)"><path d="M0,-5 L1.2,-1.2 L5,0 L1.2,1.2 L0,5 L-1.2,1.2 L-5,0 L-1.2,-1.2 Z" fill="#FF6B9D"/></g>
      <text x="168" y="95" font-family="Georgia,serif" font-size="58" font-weight="700" letter-spacing="4" fill="url(#ifTG)">UTSAAV</text>
      <text x="170" y="118" font-family="Georgia,serif" font-size="12" letter-spacing="5" fill="#555">EVENT MANAGEMENT</text>
    </svg>
  </div>
  <div style="text-align:center;font-size:13px;color:var(--muted);line-height:1.8;">
    <div>Event Management Platform ‚Äî <a href="landing.html" style="color:var(--accent);text-decoration:none;font-weight:600;">Organizers ke liye free listing ‚Üí</a></div>
    <div style="margin-top:4px;">
      CEO &amp; Founder ‚Äî <strong style="color:var(--text);">Ritam Mitra</strong> &nbsp;|&nbsp;
      <a href="tel:7384949090" style="color:var(--accent);text-decoration:none;">üìû 7384949090</a> &nbsp;|&nbsp;
      <a href="/cdn-cgi/l/email-protection#0f627d7d667b6e6262667b7d6e4f68626e6663216c6062" style="color:var(--accent);text-decoration:none;">‚úâ <span class="__cf_email__" data-cfemail="e8859a9a819c898585819c9a89a88f85898184c68b8785">[email&#160;protected]</span></a>
    </div>
  </div>
</footer>

<!-- PROFILE PAGE -->
<div class="hidden" id="profilePage" style="position:relative;z-index:5;min-height:calc(100vh - 67px);padding:0 0 80px;">
  <div id="profileHero" style="position:relative;height:300px;overflow:hidden;background:var(--surface2);">
    <img id="profileHeroImg" src="" alt="" style="width:100%;height:100%;object-fit:cover;filter:brightness(0.45);">
    <div style="position:absolute;inset:0;background:linear-gradient(to bottom,transparent 20%,var(--bg) 100%);"></div>
    <button onclick="closeProfilePage()" style="position:absolute;top:20px;left:20px;background:rgba(0,0,0,0.55);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.15);color:#fff;padding:10px 20px;border-radius:10px;font-family:'DM Sans',sans-serif;font-size:14px;cursor:pointer;">‚Üê Back</button>
    <div id="profileThumbs" style="position:absolute;bottom:16px;right:20px;display:flex;gap:8px;"></div>
  </div>
  <div style="max-width:940px;margin:0 auto;padding:0 20px;">
    <div style="display:flex;align-items:flex-end;justify-content:space-between;flex-wrap:wrap;gap:16px;margin-top:-40px;position:relative;z-index:2;margin-bottom:26px;">
      <div>
        <div id="profileCategory" style="margin-bottom:10px;"></div>
        <div id="profileName" style="font-family:'Playfair Display',serif;font-size:38px;font-weight:900;line-height:1.05;margin-bottom:10px;"></div>
        <div style="display:flex;align-items:center;gap:14px;flex-wrap:wrap;">
          <div id="profileLocation" style="font-size:13px;color:var(--muted);"></div>
          <div id="profileExp" style="font-size:13px;color:var(--muted);"></div>
          <div id="profileStars"></div>
        </div>
      </div>
      <div id="profilePriceBadge" style="background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:16px 24px;text-align:center;">
        <div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);margin-bottom:6px;">Budget Range</div>
        <div id="profilePriceText" style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;color:var(--accent);"></div>
      </div>
    </div>
    <div id="profileActions" style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:28px;"></div>
    <div style="display:grid;grid-template-columns:1fr 320px;gap:22px;align-items:start;">
      <div>
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:22px;margin-bottom:18px;">
          <h3 style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;margin-bottom:12px;">About</h3>
          <p id="profileBio" style="font-size:14px;color:var(--muted);line-height:1.8;"></p>
        </div>
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:22px;margin-bottom:18px;">
          <h3 style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;margin-bottom:14px;">üé≠ Specialization</h3>
          <div id="profileServices" style="display:flex;flex-wrap:wrap;gap:8px;"></div>
        </div>
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:22px;margin-bottom:18px;">
          <h3 style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;margin-bottom:14px;">üì∏ Work Gallery</h3>
          <div id="profileGallery" style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;"></div>
          <div id="profileNoGallery" style="display:none;font-size:13px;color:var(--muted);">No photos uploaded yet.</div>
        </div>
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:22px;">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px;">
            <h3 style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;">‚≠ê Reviews</h3>
            <div id="profileRatingBig" style="font-family:'Playfair Display',serif;font-size:26px;font-weight:900;color:var(--accent);"></div>
          </div>
          <div id="profileReviews"></div>
          <div id="profileReviewForm"></div>
        </div>
      </div>
      <div style="position:sticky;top:90px;display:flex;flex-direction:column;gap:16px;">
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:22px;">
          <h3 style="font-family:'Playfair Display',serif;font-size:17px;font-weight:700;margin-bottom:16px;">üì© Send Enquiry</h3>
          <div id="profileEnquiryForm"></div>
        </div>
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:22px;">
          <h3 style="font-family:'Playfair Display',serif;font-size:17px;font-weight:700;margin-bottom:16px;">üìã Contact Info</h3>
          <div id="profileContactInfo"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
let currentProfileOrg = null;
function openProfilePage(o) {
  currentProfileOrg = o;
  trackEvent('view_profile', 'engagement', o.name);
  hideAllPages();
  document.getElementById('profilePage').classList.remove('hidden');
  window.scrollTo(0,0);
  document.getElementById('profileHeroImg').src = o.photo || '';
  const thumbs = document.getElementById('profileThumbs');
  thumbs.innerHTML = '';
  if (o.photos && o.photos.length > 1) {
    o.photos.forEach((p,i) => {
      const img = document.createElement('img');
      img.src = p;
      img.style.cssText = `width:52px;height:52px;object-fit:cover;border-radius:8px;cursor:pointer;border:2px solid ${i===0?'var(--accent)':'rgba(255,255,255,0.3)'};`;
      img.onclick = () => {
        document.getElementById('profileHeroImg').src = p;
        thumbs.querySelectorAll('img').forEach(t => t.style.borderColor = 'rgba(255,255,255,0.3)');
        img.style.borderColor = 'var(--accent)';
      };
      thumbs.appendChild(img);
    });
  }
  document.getElementById('profileCategory').innerHTML = o.category ? `<span class="badge">${o.category}</span>` : '';
  document.getElementById('profileName').textContent = o.name;
  document.getElementById('profileLocation').innerHTML = o.location ? `üìç ${o.location}` : '';
  document.getElementById('profileExp').innerHTML = o.experience ? `üèÜ ${o.experience} yrs experience` : '';
  const stars = renderStars(o.rating || 0);
  document.getElementById('profileStars').innerHTML = `<span style="color:var(--accent);font-size:15px;letter-spacing:2px;">${stars}</span> <span style="font-size:12px;color:var(--muted);">${o.rating?o.rating.toFixed(1)+' ('+o.reviewCount+' reviews)':'No reviews yet'}</span>`;
  const p = document.getElementById('profilePriceText');
  if (o.priceMin || o.priceMax) { p.textContent = `‚Çπ${Number(o.priceMin||0).toLocaleString()} ‚Äì ‚Çπ${Number(o.priceMax||0).toLocaleString()}`; }
  else { p.textContent = 'Contact for pricing'; p.style.fontSize = '14px'; }

  const isOwner = o.owner === currentUser?.email;
  const isAdmin = currentUser?.email === ADMIN_EMAIL;
  document.getElementById('profileActions').innerHTML = `
    ${!isOwner?`<button class="btn-primary btn-sm" onclick="document.getElementById('profileEnquiryForm').scrollIntoView({behavior:'smooth'})">üì© Send Enquiry</button>`:''}
    <a href="tel:${o.phone}" class="btn-secondary btn-sm" style="text-decoration:none;" onclick="trackEvent('call_click','engagement','${o.name}')">üìû Call Now</a>
    <a href="https://wa.me/91${waNumber(o.whatsapp||o.phone)}" target="_blank" class="btn-secondary btn-sm" style="background:rgba(37,211,102,0.1);border-color:rgba(37,211,102,0.3);color:#25d366;text-decoration:none;" onclick="trackEvent('whatsapp_click','engagement','${o.name}')">üí¨ WhatsApp</a>
    ${o.website?`<a href="${o.website}" target="_blank" class="btn-secondary btn-sm" style="text-decoration:none;">üåê Website</a>`:''}
    ${isOwner||isAdmin?`<button class="btn-danger btn-sm" onclick="deleteOrg('${o.id}')">üóë Delete</button>`:''}
    ${isAdmin&&!isOwner?`<button class="btn-admin btn-sm" onclick="adminEditOrg('${o.id}')">‚úèÔ∏è Edit (Admin)</button>`:''}`;

  document.getElementById('profileBio').textContent = o.bio || 'No description provided.';
  const allCats = ['Wedding','Corporate','Birthday','Concert','Sports','Conference','Social'];
  document.getElementById('profileServices').innerHTML = allCats.map(c => `
    <span style="padding:7px 16px;border-radius:20px;font-size:13px;font-weight:500;
      background:${c===o.category?'var(--accent)':'var(--surface2)'};
      color:${c===o.category?'#0a0a0f':'var(--muted)'};
      border:1px solid ${c===o.category?'var(--accent)':'var(--border)'};">${c}</span>`).join('');

  const gallery  = document.getElementById('profileGallery');
  const noGallery= document.getElementById('profileNoGallery');
  gallery.innerHTML = '';
  if (o.photos && o.photos.length > 0) {
    noGallery.style.display = 'none';
    o.photos.forEach(p => {
      const div = document.createElement('div');
      div.style.cssText = 'aspect-ratio:1;overflow:hidden;border-radius:10px;cursor:pointer;';
      div.innerHTML = `<img src="${p}" style="width:100%;height:100%;object-fit:cover;transition:transform 0.3s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'" onclick="document.getElementById('profileHeroImg').src='${p}';window.scrollTo(0,0);">`;
      gallery.appendChild(div);
    });
  } else { noGallery.style.display = 'block'; }

  document.getElementById('profileContactInfo').innerHTML = `
    <div style="display:flex;flex-direction:column;gap:12px;">
      <div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface2);border-radius:10px;"><span style="font-size:18px;">üìû</span><div><div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">Phone</div><div style="font-size:14px;font-weight:600;">${o.phone}</div></div></div>
      <div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface2);border-radius:10px;"><span style="font-size:18px;">üí¨</span><div><div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">WhatsApp</div><div style="font-size:14px;font-weight:600;color:#25d366;">${o.whatsapp||o.phone}</div></div></div>
      <div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface2);border-radius:10px;"><span style="font-size:18px;">‚úâ</span><div><div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">Email</div><div style="font-size:13px;font-weight:600;word-break:break-all;">${o.email}</div></div></div>
      ${o.location?`<div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface2);border-radius:10px;"><span style="font-size:18px;">üìç</span><div><div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">Location</div><div style="font-size:14px;font-weight:600;">${o.location}</div></div></div>`:''}
      ${o.website?`<a href="${o.website}" target="_blank" style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface2);border-radius:10px;text-decoration:none;color:var(--text);border:1px solid rgba(201,168,76,0.2);"><span style="font-size:18px;">üåê</span><div><div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">Website</div><div style="font-size:13px;font-weight:600;color:var(--accent);word-break:break-all;">${o.website}</div></div></a>`:''}      ${o.instagram?`<a href="${o.instagram}" target="_blank" style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface2);border-radius:10px;text-decoration:none;color:var(--text);"><span style="font-size:18px;">üì∏</span><div><div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">Instagram</div><div style="font-size:13px;font-weight:600;color:#e1306c;">${o.instagram.replace('https://','')}</div></div></a>`:''}      ${o.facebook?`<a href="${o.facebook}" target="_blank" style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface2);border-radius:10px;text-decoration:none;color:var(--text);"><span style="font-size:18px;">üìò</span><div><div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">Facebook</div><div style="font-size:13px;font-weight:600;color:#4267B2;">${o.facebook.replace('https://','')}</div></div></a>`:''}      ${o.driveLink?`<a href="${o.driveLink}" target="_blank" style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface2);border-radius:10px;text-decoration:none;color:var(--text);"><span style="font-size:18px;">üìÇ</span><div><div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;">Portfolio (Drive)</div><div style="font-size:13px;font-weight:600;color:var(--accent);">View Portfolio ‚Üí</div></div></a>`:''}    </div>`;

  loadProfileReviews(o);

  if (!isOwner) {
    document.getElementById('profileEnquiryForm').innerHTML = `
      <div class="form-group"><input type="text" id="penqName" placeholder="Your name" value="${currentUser.displayName || currentUser.email.split('@')[0]}" style="width:100%;padding:11px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;outline:none;"></div>
      <div class="form-group" style="margin-top:10px;"><input type="tel" id="penqPhone" placeholder="Your phone / WhatsApp" style="width:100%;padding:11px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;outline:none;"></div>
      <div class="form-group" style="margin-top:10px;"><textarea id="penqMsg" rows="4" placeholder="Describe your event ‚Äî date, type, guests..." style="width:100%;padding:11px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;outline:none;resize:vertical;"></textarea></div>
      <button class="btn-primary" style="margin-top:12px;" onclick="sendProfileEnquiry('${o.id}','${o.owner}','${o.name}')">Send Message ‚Üí</button>`;
  } else {
    document.getElementById('profileEnquiryForm').innerHTML = `<p style="font-size:13px;color:var(--muted);">This is your own listing.</p>`;
  }
}

async function loadProfileReviews(o) {
  const isOwner = o.owner === currentUser?.email;
  const snap    = await db.collection('reviews').where('orgId','==',o.id).orderBy('createdAt','desc').limit(10).get();
  const reviews = []; snap.forEach(d => reviews.push(d.data()));
  document.getElementById('profileRatingBig').textContent = o.rating ? o.rating.toFixed(1) + ' ‚òÖ' : '‚Äî';
  const rv = document.getElementById('profileReviews');
  rv.innerHTML = reviews.length ? reviews.map(r => `
    <div style="background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:10px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;">
        <span style="font-size:13px;font-weight:600;">${r.authorName||r.authorEmail.split('@')[0]}</span>
        <span style="color:var(--accent);font-size:13px;">${'‚òÖ'.repeat(r.rating)}${'‚òÜ'.repeat(5-r.rating)} <span style="color:var(--muted);font-size:11px;">${r.createdAt?.toDate?.()?.toLocaleDateString()||''}</span></span>
      </div>
      <div style="font-size:13px;color:var(--muted);line-height:1.6;">${r.text}</div>
    </div>`).join('')
  : '<p style="font-size:13px;color:var(--muted);margin-bottom:16px;">No reviews yet.</p>';

  if (!isOwner) {
    document.getElementById('profileReviewForm').innerHTML = `
      <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border);">
        <div style="font-size:13px;font-weight:600;margin-bottom:10px;">Leave a Review</div>
        <div style="display:flex;gap:6px;margin-bottom:10px;font-size:24px;cursor:pointer;" id="pStarPicker">
          <span onclick="setPStar(1)" style="opacity:0.3;">‚òÖ</span><span onclick="setPStar(2)" style="opacity:0.3;">‚òÖ</span>
          <span onclick="setPStar(3)" style="opacity:0.3;">‚òÖ</span><span onclick="setPStar(4)" style="opacity:0.3;">‚òÖ</span>
          <span onclick="setPStar(5)" style="opacity:0.3;">‚òÖ</span>
        </div>
        <textarea id="pReviewText" rows="3" placeholder="Share your experience..." style="width:100%;padding:11px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;outline:none;resize:vertical;margin-bottom:10px;"></textarea>
        <button class="btn-purple btn-sm" onclick="submitProfileReview('${o.id}','${o.owner}','${o.name}')">Submit Review</button>
      </div>`;
  }
}

let pSelectedStar = 0;
function setPStar(n) {
  pSelectedStar = n;
  document.querySelectorAll('#pStarPicker span').forEach((s,i) => { s.style.opacity = i<n?'1':'0.3'; s.style.color = i<n?'var(--accent)':'var(--text)'; });
}

async function submitProfileReview(orgId, orgOwner, orgName) {
  if (!pSelectedStar) { showToast('Please select a star rating', 'error'); return; }
  const text = document.getElementById('pReviewText').value.trim();
  if (!text) { showToast('Please write something', 'error'); return; }
  await db.collection('reviews').add({orgId, orgOwner, orgName, rating: pSelectedStar, text, authorEmail: currentUser.email, authorName: currentUser.email.split('@')[0], createdAt: new Date()});
  const allRev = await db.collection('reviews').where('orgId','==',orgId).get();
  let total = 0; allRev.forEach(d => total += d.data().rating);
  await db.collection('organizers').doc(orgId).update({rating: total/allRev.size, reviewCount: allRev.size});
  showToast('‚≠ê Review submitted!');
  const updated = {...currentProfileOrg, rating: total/allRev.size, reviewCount: allRev.size};
  currentProfileOrg = updated;
  loadProfileReviews(updated); loadOrganizers();
}

async function sendProfileEnquiry(orgId, toEmail, toName) {
  const msg = document.getElementById('penqMsg').value.trim();
  if (!msg) { showToast('Please write a message', 'error'); return; }
  await db.collection('enquiries').add({orgId, toEmail, toName, fromEmail: currentUser.email, fromName: document.getElementById('penqName').value.trim(), fromPhone: document.getElementById('penqPhone').value.trim(), message: msg, createdAt: new Date()});
  trackEvent('enquiry_sent', 'engagement', toName);
  showToast('üì© Enquiry sent!');
  document.getElementById('penqMsg').value = '';
  document.getElementById('penqPhone').value = '';
}

function closeProfilePage() {
  document.getElementById('profilePage').classList.add('hidden');
  document.getElementById('customer').classList.remove('hidden');
  window.scrollTo(0,0);
}
</script>

<!-- VENDOR PAGE -->
<div class="hidden" id="vendor" style="position:relative;z-index:5;padding:20px 12px 80px;display:flex;justify-content:center;">
  <div style="width:100%;max-width:720px;">
    <div class="panel-header">
      <div class="panel-back" onclick="showSection('home')">‚Üê</div>
      <div><div class="panel-title">Creative <span>Professionals</span></div></div>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:24px;">
      <button class="vendor-type-btn active" onclick="selectVendorType('photographer',this)">üì∏ Photographer</button>
      <button class="vendor-type-btn" onclick="selectVendorType('makeup',this)">üíÑ Makeup Artist</button>
      <button class="vendor-type-btn" onclick="selectVendorType('gifts',this)">üéÅ Return Gifts</button>
    </div>
    <div class="glass-card">
      <div class="cloudinary-info">‚òÅÔ∏è Photos stored on Cloudinary ‚Äî unlimited, fast CDN delivery worldwide</div>
      <div id="vendorTypeLabel" style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;margin-bottom:18px;color:var(--accent);">üì∏ Photographer Registration</div>
      <form id="vendorForm">
        <div class="form-row">
          <div class="form-group"><label>Your Name</label><input type="text" id="vName" placeholder="Full name" required></div>
          <div class="form-group"><label>Company / Brand Name</label><input type="text" id="vCompany" placeholder="Studio / brand name"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Phone Number</label><input type="tel" id="vPhone" placeholder="+91 00000 00000" required></div>
          <div class="form-group"><label>WhatsApp Number</label><input type="tel" id="vWhatsapp" placeholder="+91 WhatsApp number"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Email</label><input type="email" id="vEmail" placeholder="your@email.com" required></div>
          <div class="form-group"><label>Existing Website</label><input type="url" id="vWebsite" placeholder="https://yourwebsite.com"></div>
        </div>
        <div class="form-group"><label>Location / City</label><input type="text" id="vLocation" placeholder="e.g. Midnapore, Kolkata..." required></div>
        <div class="form-group"><label>Bio / Description</label><textarea id="vBio" rows="3" placeholder="Tell clients about your work..."></textarea></div>
        <div class="form-row">
          <div class="form-group"><label>Years of Experience</label><input type="number" id="vExp" placeholder="e.g. 3" min="0"></div>
          <div class="form-group" id="vSpecialtyGroup"><label id="vSpecialtyLabel">Specialty</label><input type="text" id="vSpecialty" placeholder="e.g. Wedding, Portrait"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Min Price (‚Çπ)</label><input type="number" id="vPriceMin" placeholder="e.g. 5000" min="0"></div>
          <div class="form-group"><label>Max Price (‚Çπ)</label><input type="number" id="vPriceMax" placeholder="e.g. 50000" min="0"></div>
        </div>
        <div style="background:var(--surface2);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px;">
          <div style="font-size:13px;font-weight:600;color:var(--accent);margin-bottom:12px;">üîó Portfolio & Social Links <span style="font-size:11px;color:var(--muted);font-weight:400;">(optional ‚Äî fill whichever you have)</span></div>
          <div class="form-row">
            <div class="form-group" style="margin:0;">
              <label style="display:flex;align-items:center;gap:6px;"><span style="font-size:16px;">üìÇ</span> Google Drive Portfolio</label>
              <input type="url" id="vDriveLink" placeholder="https://drive.google.com/...">
            </div>
            <div class="form-group" style="margin:0;">
              <label style="display:flex;align-items:center;gap:6px;"><span style="font-size:16px;">üì∏</span> Instagram Profile</label>
              <input type="url" id="vInstagram" placeholder="https://instagram.com/yourprofile">
            </div>
          </div>
          <div class="form-group" style="margin-top:12px;margin-bottom:0;">
            <label style="display:flex;align-items:center;gap:6px;"><span style="font-size:16px;">üìò</span> Facebook Page</label>
            <input type="url" id="vFacebook" placeholder="https://facebook.com/yourpage">
          </div>
        </div>
        <div class="form-group" id="vPhotoGroup">
          <label>Work Photos <span style="font-size:11px;color:var(--muted);">(multiple allowed ‚Äî Cloudinary)</span></label>
          <div id="vPhotoDropzone" onclick="document.getElementById('vPhotos').click()" style="border:2px dashed var(--border);border-radius:14px;padding:28px;text-align:center;cursor:pointer;background:var(--surface2);" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">
            <div style="font-size:32px;margin-bottom:8px;">üì∑</div>
            <div style="font-size:14px;font-weight:600;margin-bottom:4px;">Click to select photos</div>
            <div style="font-size:12px;color:var(--muted);">JPG, PNG ‚Äî unlimited photos via Cloudinary</div>
            <input type="file" id="vPhotos" accept="image/*" multiple style="display:none;" onchange="previewVendorPhotos(this)">
          </div>
          <div id="vPhotosPreview" style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:12px;"></div>
          <div id="vPhotoCount" style="font-size:12px;color:var(--muted);margin-top:6px;"></div>
          <div class="upload-progress-wrap" id="vUploadProgress">
            <div class="upload-progress-text">
              <span id="vUploadStatusText">‚òÅÔ∏è Uploading to Cloudinary...</span>
              <span class="upload-status-icon" id="vUploadIcon">‚è≥</span>
            </div>
            <div class="upload-progress-bar-bg">
              <div class="upload-progress-bar" id="vUploadBar"></div>
            </div>
          </div>
        </div>
        <button type="submit" class="btn-primary" style="margin-top:8px;">‚ú¶ Publish Profile</button>
      </form>
    </div>
    <div style="margin-top:28px;">
      <div style="font-family:'Playfair Display',serif;font-size:18px;font-weight:700;margin-bottom:14px;">My Listings</div>
      <div id="myVendorList"><div class="loading-dots"><span></span><span></span><span></span></div></div>
    </div>
  </div>
</div>

<script>
let currentVendorType = 'photographer';

function selectVendorType(type, btn) {
  currentVendorType = type;
  document.querySelectorAll('#vendor .vendor-type-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  const labels = {
    photographer: {title:'üì∏ Photographer Registration',    specialty:'Specialty',       sp:'e.g. Wedding, Portrait'},
    makeup:       {title:'üíÑ Makeup Artist Registration',    specialty:'Makeup Specialty',sp:'e.g. Bridal, HD Makeup'},
    gifts:        {title:'üéÅ Return Gifts / Wedding Favors', specialty:'Products Offered',sp:'e.g. Gift hampers, Dry fruits'}
  };
  const l = labels[type];
  document.getElementById('vendorTypeLabel').textContent = l.title;
  document.getElementById('vSpecialtyLabel').textContent = l.specialty;
  document.getElementById('vSpecialty').placeholder = l.sp;
  const pg = document.getElementById('vPhotoGroup');
  if (pg) pg.style.display = type === 'gifts' ? 'none' : 'block';
  loadMyVendorListings();
}

function previewVendorPhotos(input) {
  const files   = Array.from(input.files);
  const preview = document.getElementById('vPhotosPreview');
  const count   = document.getElementById('vPhotoCount');
  preview.innerHTML = '';
  count.textContent = `${files.length} photo${files.length>1?'s':''} selected ‚Äî will be uploaded to Cloudinary`;
  files.forEach((file, i) => {
    const r = new FileReader();
    r.onload = e => {
      const wrap = document.createElement('div');
      wrap.style.cssText = 'position:relative;aspect-ratio:1;overflow:hidden;border-radius:10px;border:2px solid var(--border);';
      wrap.innerHTML = `<img src="${e.target.result}" style="width:100%;height:100%;object-fit:cover;">${i===0?'<div style="position:absolute;bottom:3px;left:50%;transform:translateX(-50%);background:var(--accent);color:#000;font-size:9px;font-weight:700;padding:2px 6px;border-radius:4px;white-space:nowrap;">COVER</div>':''}`;
      preview.appendChild(wrap);
    };
    r.readAsDataURL(file);
  });
}

document.getElementById('vendorForm').addEventListener('submit', async e => {
  e.preventDefault();
  const btn = e.target.querySelector('button[type=submit]');
  btn.disabled = true; btn.textContent = '‚òÅÔ∏è Uploading photos...';

  let photos = [];
  const photoFiles = document.getElementById('vPhotos').files;
  if (photoFiles.length > 0 && currentVendorType !== 'gifts') {
    try {
      photos = await uploadMultipleToCloudinary(
        Array.from(photoFiles), 'vUploadProgress', 'vUploadBar', 'vUploadStatusText', 'vUploadIcon'
      );
    } catch(err) {
      showToast('Photo upload failed: ' + err.message, 'error');
      btn.disabled = false; btn.textContent = '‚ú¶ Publish Profile';
      return;
    }
  }

  btn.textContent = 'üíæ Saving...';
  await db.collection('vendors').add({
    type:       currentVendorType,
    name:       document.getElementById('vName').value,
    company:    document.getElementById('vCompany').value || '',
    phone:      document.getElementById('vPhone').value,
    whatsapp:   document.getElementById('vWhatsapp').value || document.getElementById('vPhone').value,
    email:      document.getElementById('vEmail').value,
    website:    document.getElementById('vWebsite').value || '',
    location:   document.getElementById('vLocation').value,
    bio:        document.getElementById('vBio').value || '',
    experience: document.getElementById('vExp').value || '',
    specialty:  document.getElementById('vSpecialty').value || '',
    priceMin:   document.getElementById('vPriceMin').value || 0,
    priceMax:   document.getElementById('vPriceMax').value || 0,
    driveLink:  document.getElementById('vDriveLink').value || '',
    instagram:  document.getElementById('vInstagram').value || '',
    facebook:   document.getElementById('vFacebook').value || '',
    photos, photo: photos[0] || '',
    owner: currentUser.email,
    rating: 0, reviewCount: 0, createdAt: new Date()
  });

  document.getElementById('vendorForm').reset();
  document.getElementById('vInstagram').value = '';
  document.getElementById('vFacebook').value  = '';
  document.getElementById('vPhotosPreview').innerHTML = '';
  document.getElementById('vPhotoCount').textContent  = '';
  btn.textContent = '‚ú¶ Publish Profile'; btn.disabled = false;
  showToast('‚ú¶ Profile published!');
  loadMyVendorListings();
});

async function loadMyVendorListings() {
  const el = document.getElementById('myVendorList');
  if (!el) return;
  el.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
  const snap = await db.collection('vendors').where('owner','==',currentUser.email).get();
  if (snap.empty) { el.innerHTML = '<p style="color:var(--muted);font-size:14px;">No listings yet.</p>'; return; }
  el.innerHTML = '';
  snap.forEach(doc => {
    const v = {id: doc.id, ...doc.data()};
    const typeIcon = {photographer:'üì∏', makeup:'üíÑ', gifts:'üéÅ'}[v.type] || '‚ú®';
    const div = document.createElement('div');
    div.style.cssText = 'background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:12px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;';
    div.innerHTML = `
      <div>
        <div style="font-size:13px;color:var(--accent);font-weight:600;margin-bottom:4px;">${typeIcon} ${v.type.charAt(0).toUpperCase()+v.type.slice(1)}</div>
        <div style="font-family:'Playfair Display',serif;font-weight:700;font-size:16px;">${v.name}${v.company?' ‚Äî '+v.company:''}</div>
        <div style="font-size:13px;color:var(--muted);margin-top:3px;">üìç ${v.location} &nbsp;|&nbsp; üìû ${v.phone}</div>
        ${v.photos&&v.photos.length>0?`<div style="display:flex;gap:4px;flex-wrap:wrap;margin-top:6px;">${v.photos.slice(0,5).map(p=>`<img src="${p}" style="width:36px;height:36px;object-fit:cover;border-radius:6px;border:1px solid var(--border);">`).join('')}</div>`:''}
        <div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:4px;">
        ${v.driveLink?`<a href="${v.driveLink}" target="_blank" style="font-size:11px;color:#4ecb71;text-decoration:none;background:rgba(78,203,113,0.08);border:1px solid rgba(78,203,113,0.2);padding:3px 10px;border-radius:20px;font-weight:600;">üìÇ Portfolio</a>`:''}
        ${v.instagram?`<a href="${v.instagram}" target="_blank" style="font-size:11px;color:#e1306c;text-decoration:none;background:rgba(225,48,108,0.08);border:1px solid rgba(225,48,108,0.2);padding:3px 10px;border-radius:20px;font-weight:600;">üì∏ Instagram</a>`:''}
        ${v.facebook?`<a href="${v.facebook}" target="_blank" style="font-size:11px;color:#1877f2;text-decoration:none;background:rgba(24,119,242,0.08);border:1px solid rgba(24,119,242,0.2);padding:3px 10px;border-radius:20px;font-weight:600;">üìò Facebook</a>`:''}
      </div>
      </div>
      <button onclick="deleteVendor('${v.id}')" class="btn-danger btn-sm">Delete</button>`;
    el.appendChild(div);
  });
}

async function deleteVendor(id) {
  if (!confirm('Delete this listing?')) return;
  await db.collection('vendors').doc(id).delete();
  showToast('Deleted!');
  loadMyVendorListings();
}

let allVendors = [];
function filterVendors(type, btn) {
  document.querySelectorAll('#vendorFilterBtns .vendor-type-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  loadVendors(type);
}

async function loadVendors(type) {
  const el = document.getElementById('vendorList');
  el.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
  const snap = await db.collection('vendors').get();
  allVendors = [];
  snap.forEach(doc => allVendors.push({id: doc.id, ...doc.data()}));
  const filtered = type === 'all' ? allVendors : allVendors.filter(v => v.type === type);
  renderVendors(filtered);
}

function renderVendors(list) {
  const el = document.getElementById('vendorList');
  el.innerHTML = '';
  if (!list.length) { el.innerHTML = '<div class="empty-state"><span class="empty-icon">üîç</span><p>No listings found.</p></div>'; return; }
  const typeIcon  = {photographer:'üì∏', makeup:'üíÑ', gifts:'üéÅ'};
  const typeColor = {photographer:'rgba(201,168,76,0.1)', makeup:'rgba(232,101,74,0.1)', gifts:'rgba(78,203,113,0.1)'};
  list.forEach(v => {
    const card = document.createElement('div');
    card.style.cssText = 'background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:20px;margin-bottom:14px;transition:all 0.2s;cursor:pointer;';
    card.onmouseover = () => card.style.borderColor = 'rgba(201,168,76,0.3)';
    card.onmouseout  = () => card.style.borderColor = 'rgba(255,255,255,0.07)';
    card.onclick = (e) => { if (e.target.tagName === 'A' || e.target.closest('a')) return; openVendorProfile(v); };
    const stars = '‚òÖ'.repeat(Math.round(v.rating||0)) + '‚òÜ'.repeat(5-Math.round(v.rating||0));
    card.innerHTML = `
      <div style="display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:10px;">
        <div style="flex:1;">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap;">
            <span style="padding:4px 12px;border-radius:20px;font-size:11px;font-weight:700;background:${typeColor[v.type]||'rgba(201,168,76,0.1)'};color:var(--accent);">${typeIcon[v.type]||'‚ú®'} ${v.type.charAt(0).toUpperCase()+v.type.slice(1)}</span>
            ${v.specialty?`<span style="padding:4px 10px;border-radius:20px;font-size:11px;background:var(--surface2);color:var(--muted);">${v.specialty}</span>`:''}
          </div>
          <div style="font-family:'Playfair Display',serif;font-size:20px;font-weight:700;margin-bottom:4px;">${v.name}${v.company?` <span style="font-size:14px;font-weight:400;color:var(--muted);">‚Äî ${v.company}</span>`:''}</div>
          <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;font-size:13px;color:var(--muted);margin-bottom:10px;">
            <span>üìç ${v.location}</span>${v.experience?`<span>üèÜ ${v.experience} yrs</span>`:''}
            <span style="color:var(--accent);">${stars} <span style="color:var(--muted);">${v.reviewCount?'('+v.reviewCount+')':'No reviews'}</span></span>
          </div>
          ${v.bio?`<p style="font-size:13px;color:var(--muted);line-height:1.6;margin-bottom:12px;">${v.bio.slice(0,120)}${v.bio.length>120?'...':''}</p>`:''}
          ${v.photos&&v.photos.length>0?`<div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;">${v.photos.slice(0,5).map((p,i)=>`<img src="${p}" style="width:56px;height:56px;object-fit:cover;border-radius:8px;border:2px solid ${i===0?'var(--accent)':'var(--border)'};">`).join('')}</div>`:''}
          <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
            ${v.priceMin||v.priceMax?`<span style="font-size:13px;font-weight:600;color:var(--accent);">‚Çπ${Number(v.priceMin||0).toLocaleString()} ‚Äì ‚Çπ${Number(v.priceMax||0).toLocaleString()}</span>`:''}
            ${v.driveLink?`<a href="${v.driveLink}" target="_blank" onclick="event.stopPropagation()" style="font-size:12px;color:#4ecb71;text-decoration:none;background:rgba(78,203,113,0.1);border:1px solid rgba(78,203,113,0.25);padding:5px 14px;border-radius:20px;font-weight:600;">üìÇ Portfolio ‚Üí</a>`:''}
            ${v.instagram?`<a href="${v.instagram}" target="_blank" onclick="event.stopPropagation()" style="font-size:12px;color:#e1306c;text-decoration:none;background:rgba(225,48,108,0.1);border:1px solid rgba(225,48,108,0.25);padding:5px 14px;border-radius:20px;font-weight:600;">üì∏ Instagram ‚Üí</a>`:''}
            ${v.facebook?`<a href="${v.facebook}" target="_blank" onclick="event.stopPropagation()" style="font-size:12px;color:#1877f2;text-decoration:none;background:rgba(24,119,242,0.1);border:1px solid rgba(24,119,242,0.25);padding:5px 14px;border-radius:20px;font-weight:600;">üìò Facebook ‚Üí</a>`:''}
            ${v.website?`<a href="${v.website}" target="_blank" onclick="event.stopPropagation()" style="font-size:12px;color:var(--muted);text-decoration:none;background:var(--surface2);border:1px solid var(--border);padding:5px 14px;border-radius:20px;">üåê Website</a>`:''}
          </div>
        </div>
        <div style="display:flex;flex-direction:column;gap:8px;min-width:120px;">
          <a href="tel:${v.phone}" onclick="event.stopPropagation()" style="padding:8px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;font-size:12px;font-weight:600;text-decoration:none;color:var(--text);text-align:center;">üìû Call</a>
          <a href="https://wa.me/91${waNumber(v.whatsapp||v.phone)}" target="_blank" onclick="event.stopPropagation()" style="padding:8px 16px;background:rgba(37,211,102,0.1);border:1px solid rgba(37,211,102,0.25);border-radius:8px;font-size:12px;font-weight:600;text-decoration:none;color:#25d366;text-align:center;">üí¨ WhatsApp</a>
          ${v.email?`<a href="mailto:${v.email}" onclick="event.stopPropagation()" style="padding:8px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;font-size:12px;font-weight:600;text-decoration:none;color:var(--text);text-align:center;">‚úâ Email</a>`:''}
          ${currentUser && currentUser.email !== v.owner && currentUser.email !== ADMIN_EMAIL ? `<button onclick="event.stopPropagation();openClaimModal('${v.id}','vendor','${v.name}','${v.owner}')" style="padding:8px 14px;background:rgba(92,184,92,0.1);color:#7ed37e;border:1px solid rgba(92,184,92,0.3);border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;">üîë Claim</button>` : ''}
        </div>
      </div>`;
    el.appendChild(card);
  });
}

let currentVendorProfile = null;
function openVendorProfile(v) {
  currentVendorProfile = v;
  hideAllPages();
  const typeIcon = {photographer:'üì∏', makeup:'üíÑ', gifts:'üéÅ'};
  const stars    = '‚òÖ'.repeat(Math.round(v.rating||0)) + '‚òÜ'.repeat(5-Math.round(v.rating||0));
  let page = document.getElementById('vendorProfilePage');
  if (!page) {
    page = document.createElement('div');
    page.id = 'vendorProfilePage';
    page.style.cssText = 'position:relative;z-index:5;padding:20px 12px 80px;display:flex;justify-content:center;min-height:100vh;';
    document.body.appendChild(page);
  }
  page.style.display = 'flex';
  const photosHtml = v.photos && v.photos.length > 0 ? `
    <div style="margin-bottom:24px;">
      <img id="vpMainPhoto" src="${v.photos[0]}" style="width:100%;max-height:360px;object-fit:cover;border-radius:16px;margin-bottom:10px;">
      <div style="display:flex;gap:8px;flex-wrap:wrap;">${v.photos.map((p,i)=>`<img src="${p}" onclick="document.getElementById('vpMainPhoto').src='${p}'" style="width:70px;height:70px;object-fit:cover;border-radius:10px;border:2px solid ${i===0?'var(--accent)':'var(--border)'};cursor:pointer;">`).join('')}</div>
    </div>` : '';
  page.innerHTML = `
  <div style="width:100%;max-width:780px;">
    <div class="panel-header">
      <div class="panel-back" onclick="closeVendorProfile()">‚Üê</div>
      <div><div class="panel-title">${typeIcon[v.type]||'‚ú®'} <span>${v.type.charAt(0).toUpperCase()+v.type.slice(1)} Profile</span></div></div>
    </div>
    ${photosHtml}
    <div class="glass-card" style="margin-bottom:16px;">
      <div style="display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:12px;margin-bottom:16px;">
        <div>
          <div style="font-family:'Playfair Display',serif;font-size:28px;font-weight:900;margin-bottom:4px;">${v.name}</div>
          ${v.company?`<div style="font-size:14px;color:var(--muted);margin-bottom:8px;">${v.company}</div>`:''}
          <div style="display:flex;gap:12px;flex-wrap:wrap;font-size:13px;color:var(--muted);">
            <span>üìç ${v.location}</span>${v.experience?`<span>üèÜ ${v.experience} years exp</span>`:''}${v.specialty?`<span>üéØ ${v.specialty}</span>`:''}
          </div>
        </div>
        ${v.priceMin||v.priceMax?`<div style="text-align:right;"><div style="font-size:11px;color:var(--muted);margin-bottom:2px;">Price Range</div><div style="font-family:'Playfair Display',serif;font-size:20px;font-weight:700;color:var(--accent);">‚Çπ${Number(v.priceMin||0).toLocaleString()} ‚Äì ‚Çπ${Number(v.priceMax||0).toLocaleString()}</div></div>`:''}
      </div>
      <div style="color:var(--accent);font-size:16px;margin-bottom:4px;">${stars} <span style="font-size:13px;color:var(--muted);">${v.reviewCount?'('+v.reviewCount+' reviews)':'No reviews yet'}</span></div>
      ${v.bio?`<p style="font-size:14px;color:var(--muted);line-height:1.7;margin-top:12px;padding-top:12px;border-top:1px solid var(--border);">${v.bio}</p>`:''}
    </div>
    <div class="glass-card" style="margin-bottom:16px;">
      <div style="font-family:'Playfair Display',serif;font-weight:700;font-size:16px;margin-bottom:16px;">Contact</div>
      <div style="display:flex;flex-direction:column;gap:10px;">
        <a href="tel:${v.phone}" style="display:flex;align-items:center;gap:10px;padding:12px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;text-decoration:none;color:var(--text);"><span style="font-size:18px;">üìû</span><div><div style="font-size:11px;color:var(--muted);">Phone</div><div style="font-weight:600;">${v.phone}</div></div></a>
        <a href="https://wa.me/91${waNumber(v.whatsapp||v.phone)}" target="_blank" style="display:flex;align-items:center;gap:10px;padding:12px 16px;background:rgba(37,211,102,0.08);border:1px solid rgba(37,211,102,0.2);border-radius:10px;text-decoration:none;color:#25d366;"><span style="font-size:18px;">üí¨</span><div><div style="font-size:11px;color:var(--muted);">WhatsApp</div><div style="font-weight:600;">${v.whatsapp||v.phone}</div></div></a>
        ${v.email?`<a href="mailto:${v.email}" style="display:flex;align-items:center;gap:10px;padding:12px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;text-decoration:none;color:var(--text);"><span style="font-size:18px;">‚úâ</span><div><div style="font-size:11px;color:var(--muted);">Email</div><div style="font-weight:600;">${v.email}</div></div></a>`:''}
        ${v.driveLink?`<a href="${v.driveLink}" target="_blank" style="display:flex;align-items:center;gap:10px;padding:12px 16px;background:rgba(78,203,113,0.08);border:1px solid rgba(78,203,113,0.25);border-radius:10px;text-decoration:none;color:#4ecb71;"><span style="font-size:18px;">üìÇ</span><div><div style="font-size:11px;color:var(--muted);">Portfolio</div><div style="font-weight:600;">View on Google Drive ‚Üí</div></div></a>`:''}
        ${v.instagram?`<a href="${v.instagram}" target="_blank" style="display:flex;align-items:center;gap:10px;padding:12px 16px;background:rgba(225,48,108,0.08);border:1px solid rgba(225,48,108,0.25);border-radius:10px;text-decoration:none;color:#e1306c;"><span style="font-size:18px;">üì∏</span><div><div style="font-size:11px;color:var(--muted);">Instagram</div><div style="font-weight:600;">View Profile ‚Üí</div></div></a>`:''}
        ${v.facebook?`<a href="${v.facebook}" target="_blank" style="display:flex;align-items:center;gap:10px;padding:12px 16px;background:rgba(24,119,242,0.08);border:1px solid rgba(24,119,242,0.25);border-radius:10px;text-decoration:none;color:#1877f2;"><span style="font-size:18px;">üìò</span><div><div style="font-size:11px;color:var(--muted);">Facebook</div><div style="font-weight:600;">View Page ‚Üí</div></div></a>`:''}
        ${v.website?`<a href="${v.website}" target="_blank" style="display:flex;align-items:center;gap:10px;padding:12px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;text-decoration:none;color:var(--text);"><span style="font-size:18px;">üåê</span><div><div style="font-size:11px;color:var(--muted);">Website</div><div style="font-weight:600;">${v.website}</div></div></a>`:''}
      </div>
    </div>
    <!-- REVIEWS SECTION FOR PROFESSIONAL -->
    <div class="glass-card" id="vpReviewsCard" style="margin-bottom:16px;">
      <div style="font-family:'Playfair Display',serif;font-weight:700;font-size:16px;margin-bottom:16px;">‚≠ê Reviews</div>
      <div id="vpReviewList"><div class="loading-dots"><span></span><span></span><span></span></div></div>
      <div id="vpReviewFormWrap" style="margin-top:18px;padding-top:18px;border-top:1px solid var(--border);">
        <div style="font-size:14px;font-weight:600;margin-bottom:12px;">Leave a Review</div>
        <div style="display:flex;gap:8px;margin-bottom:12px;" id="vpStarRow">
          ${[1,2,3,4,5].map(n=>`<button type="button" onclick="setVpStar(${n})" id="vpStar${n}" style="width:40px;height:40px;border-radius:50%;border:2px solid var(--border);background:var(--surface2);font-size:18px;cursor:pointer;transition:all 0.15s;">‚òÜ</button>`).join('')}
        </div>
        <input type="hidden" id="vpRating" value="0">
        <textarea id="vpReviewText" rows="3" placeholder="Share your experience..." style="width:100%;padding:12px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:inherit;font-size:14px;resize:vertical;outline:none;margin-bottom:10px;"></textarea>
        <button class="btn-primary btn-sm" onclick="submitVendorReview('${v.id}','${v.name.replace(/'/g,"\'")}','${v.owner||''}')">Submit Review</button>
      </div>
    </div>
  </div>`;
  loadVendorProfileReviews('${v.id}');
  window.scrollTo(0,0);
}

function closeVendorProfile() {
  const page = document.getElementById('vendorProfilePage');
  if (page) page.style.display = 'none';
  showSection('customer');
  setTimeout(() => {
    const tabs = document.querySelectorAll('#customer .tab');
    tabs.forEach(t => { if (t.textContent.includes('Photographers')) t.click(); });
  }, 100);
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROFESSIONAL (VENDOR) REVIEWS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

let vpSelectedStar = 0;
function setVpStar(n) {
  vpSelectedStar = n;
  document.getElementById('vpRating').value = n;
  for (let i = 1; i <= 5; i++) {
    const b = document.getElementById('vpStar' + i);
    if (!b) continue;
    b.textContent       = i <= n ? '‚òÖ' : '‚òÜ';
    b.style.color       = i <= n ? 'var(--accent)' : '';
    b.style.borderColor = i <= n ? 'var(--accent)' : 'var(--border)';
    b.style.background  = i <= n ? 'rgba(201,168,76,0.12)' : 'var(--surface2)';
  }
}

async function loadVendorProfileReviews(vendorId) {
  const el = document.getElementById('vpReviewList');
  if (!el) return;
  el.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
  let snap;
  try { snap = await db.collection('reviews').where('vendorId','==',vendorId).orderBy('createdAt','desc').get(); }
  catch(e) { snap = await db.collection('reviews').where('vendorId','==',vendorId).get(); }
  if (snap.empty) { el.innerHTML = '<p style="color:var(--muted);font-size:13px;">No reviews yet ‚Äî be the first!</p>'; return; }
  el.innerHTML = '';
  snap.forEach(doc => {
    const r = doc.data();
    const filled = '‚òÖ'.repeat(r.rating||0);
    const empty  = '‚òÜ'.repeat(5-(r.rating||0));
    const date   = r.createdAt?.toDate ? r.createdAt.toDate().toLocaleDateString('en-IN') : '';
    const div = document.createElement('div');
    div.style.cssText = 'padding:14px 0;border-bottom:1px solid var(--border);';
    div.innerHTML = `
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;flex-wrap:wrap;">
        <span style="color:var(--accent);font-size:14px;">${filled}<span style="color:var(--muted);">${empty}</span></span>
        <span style="font-size:13px;font-weight:600;">${r.reviewer||'Anonymous'}</span>
        ${date?`<span style="font-size:11px;color:var(--muted);">${date}</span>`:''}
      </div>
      <div style="font-size:13px;color:var(--muted);line-height:1.6;font-style:italic;">"${r.comment||r.text||''}"</div>`;
    el.appendChild(div);
  });
}

async function submitVendorReview(vendorId, vendorName, vendorOwner) {
  const rating = vpSelectedStar;
  const text   = document.getElementById('vpReviewText')?.value?.trim();
  if (!rating)  { showToast('‚ö† Please select a star rating', 'error'); return; }
  if (!text)    { showToast('‚ö† Please write a review', 'error');       return; }
  const authorName = currentUser.displayName || currentUser.email.split('@')[0];
  await db.collection('reviews').add({
    vendorId, vendorOwner, vendorName,
    reviewer: authorName,
    rating, comment: text, text,
    authorEmail: currentUser.email,
    type: 'vendor',
    createdAt: new Date()
  });
  // Update vendor rating
  const allRevs = await db.collection('reviews').where('vendorId','==',vendorId).get();
  let total = 0, count = 0;
  allRevs.forEach(d => { total += (d.data().rating||0); count++; });
  const avg = count > 0 ? Math.round((total/count)*10)/10 : 0;
  await db.collection('vendors').doc(vendorId).update({ rating: avg, reviewCount: count });
  showToast('‚≠ê Review submitted!');
  document.getElementById('vpReviewText').value = '';
  vpSelectedStar = 0;
  for (let i = 1; i <= 5; i++) {
    const b = document.getElementById('vpStar' + i);
    if (b) { b.textContent='‚òÜ'; b.style.color=''; b.style.borderColor='var(--border)'; b.style.background='var(--surface2)'; }
  }
  loadVendorProfileReviews(vendorId);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN EDIT VENDOR / PROFESSIONAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function adminEditVendor(id) {
  const doc = await db.collection('vendors').doc(id).get();
  const v = doc.data();
  document.getElementById('modalContainer').innerHTML = `
  <div class="modal-overlay" onclick="closeModal(event)">
    <div class="modal" style="max-width:680px;">
      <div class="modal-body">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
          <div style="font-family:'Playfair Display',serif;font-size:22px;font-weight:900;">‚úèÔ∏è Edit: ${v.name}</div>
          <div class="modal-close" style="position:static;width:32px;height:32px;" onclick="closeModalDirect()">‚úï</div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Name</label><input type="text" id="evName" value="${v.name||''}"></div>
          <div class="form-group"><label>Company / Brand</label><input type="text" id="evCompany" value="${v.company||''}"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Phone</label><input type="tel" id="evPhone" value="${v.phone||''}"></div>
          <div class="form-group"><label>WhatsApp</label><input type="tel" id="evWhatsapp" value="${v.whatsapp||''}"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Email</label><input type="email" id="evEmail" value="${v.email||''}"></div>
          <div class="form-group"><label>Location</label><input type="text" id="evLocation" value="${v.location||''}"></div>
        </div>
        <div class="form-group"><label>Bio</label><textarea id="evBio" rows="3">${v.bio||''}</textarea></div>
        <div class="form-row">
          <div class="form-group"><label>Specialty</label><input type="text" id="evSpecialty" value="${v.specialty||''}"></div>
          <div class="form-group"><label>Experience (years)</label><input type="number" id="evExp" value="${v.experience||''}"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Min Price (‚Çπ)</label><input type="number" id="evPriceMin" value="${v.priceMin||0}"></div>
          <div class="form-group"><label>Max Price (‚Çπ)</label><input type="number" id="evPriceMax" value="${v.priceMax||0}"></div>
        </div>
        <div style="background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:14px;">
          <div style="font-size:12px;font-weight:700;color:var(--accent);margin-bottom:10px;">üîó Portfolio & Social Links</div>
          <div class="form-group"><label>üìÇ Google Drive Portfolio</label><input type="url" id="evDriveLink" value="${v.driveLink||''}"></div>
          <div class="form-row">
            <div class="form-group"><label>üì∏ Instagram</label><input type="url" id="evInstagram" value="${v.instagram||''}"></div>
            <div class="form-group"><label>üìò Facebook</label><input type="url" id="evFacebook" value="${v.facebook||''}"></div>
          </div>
        </div>
        <div style="display:flex;gap:10px;margin-top:8px;">
          <button class="btn-primary btn-sm" onclick="saveEditVendor('${id}')">üíæ Save Changes</button>
          <button class="btn-secondary btn-sm" onclick="closeModalDirect()">Cancel</button>
        </div>
      </div>
    </div>
  </div>`;
}

async function saveEditVendor(id) {
  try {
    await db.collection('vendors').doc(id).update({
      name:       document.getElementById('evName').value,
      company:    document.getElementById('evCompany').value || '',
      phone:      document.getElementById('evPhone').value,
      whatsapp:   document.getElementById('evWhatsapp').value || '',
      email:      document.getElementById('evEmail').value,
      location:   document.getElementById('evLocation').value,
      bio:        document.getElementById('evBio').value || '',
      specialty:  document.getElementById('evSpecialty').value || '',
      experience: document.getElementById('evExp').value || '',
      priceMin:   Number(document.getElementById('evPriceMin').value) || 0,
      priceMax:   Number(document.getElementById('evPriceMax').value) || 0,
      driveLink:  document.getElementById('evDriveLink').value || '',
      instagram:  document.getElementById('evInstagram').value || '',
      facebook:   document.getElementById('evFacebook').value || '',
    });
    showToast('‚úÖ Professional updated!');
    closeModalDirect();
    loadAdminVendors();
  } catch(err) { showToast('Error: ' + err.message, 'error'); }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN REVIEWS ‚Äî Full control: edit, star, delete
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function filterAdminReviews(type, btn) {
  document.querySelectorAll('#adminTabReviews .vendor-type-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  loadAdminReviews(type);
}

async function loadAdminReviews(filterType) {
  filterType = filterType || 'all';
  const el = document.getElementById('adminReviewList');
  el.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
  let snap;
  try {
    let q = db.collection('reviews');
    if (filterType === 'vendor')    q = q.where('type','==','vendor');
    if (filterType === 'organizer') q = q.where('type','!=','vendor');
    try { snap = await q.orderBy('createdAt','desc').get(); }
    catch(e) { snap = await q.get(); }
  } catch(e2) { snap = await db.collection('reviews').get(); }
  el.innerHTML = '';
  if (snap.empty) {
    el.innerHTML = '<div class="empty-state"><span class="empty-icon">‚≠ê</span><p>No reviews yet.</p></div>';
    return;
  }
  snap.forEach(doc => {
    const r = {id: doc.id, ...doc.data()};
    const filled = '‚òÖ'.repeat(r.rating||0);
    const empty  = '‚òÜ'.repeat(5-(r.rating||0));
    const date   = r.createdAt?.toDate ? r.createdAt.toDate().toLocaleDateString('en-IN') : '‚Äî';
    const div = document.createElement('div');
    div.className = 'admin-item';
    div.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:flex-start;width:100%;gap:12px;flex-wrap:wrap;">
        <div style="flex:1;min-width:200px;">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;flex-wrap:wrap;">
            <span style="color:var(--accent);font-size:18px;letter-spacing:2px;">${filled}<span style="color:var(--border2);">${empty}</span></span>
            <span style="font-size:13px;font-weight:700;color:var(--text);">${r.reviewer||'Anonymous'}</span>
            ${r.type==='vendor'
              ? `<span class="badge" style="font-size:10px;padding:2px 8px;margin:0;background:rgba(76,154,201,0.15);color:#4c9ac9;border-color:rgba(76,154,201,0.3);">üì∏ Professional: ${r.vendorName||'‚Äî'}</span>`
              : `<span class="badge" style="font-size:10px;padding:2px 8px;margin:0;background:rgba(123,94,167,0.15);color:#a88fd4;border-color:rgba(123,94,167,0.3);">üé≠ Organizer: ${r.orgName||'‚Äî'}</span>`}
            <span style="font-size:11px;color:var(--muted);">${date}</span>
          </div>
          <div style="font-size:13px;color:var(--muted);font-style:italic;line-height:1.6;padding-left:4px;">"${r.comment||'‚Äî'}"</div>
        </div>
        <div style="display:flex;gap:8px;flex-shrink:0;">
          <button class="btn-secondary btn-sm" onclick="adminEditReview('${r.id}')">‚úèÔ∏è Edit</button>
          <button class="btn-danger btn-sm" onclick="adminDeleteReview('${r.id}','${(r.reviewer||'review').replace(/'/g,"\\'")}','${r.orgId||''}')">üóë</button>
        </div>
      </div>`;
    el.appendChild(div);
  });
}

async function adminEditReview(id, vendorId) {
  const doc = await db.collection('reviews').doc(id).get();
  const r   = doc.data();
  vendorId  = vendorId || r.vendorId || '';
  const curRating = r.rating || 5;
  document.getElementById('modalContainer').innerHTML = `
  <div class="modal-overlay" onclick="closeModal(event)">
    <div class="modal" style="max-width:500px;">
      <div class="modal-body">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
          <div style="font-family:'Playfair Display',serif;font-size:20px;font-weight:900;">‚≠ê Edit Review</div>
          <div class="modal-close" style="position:static;width:32px;height:32px;" onclick="closeModalDirect()">‚úï</div>
        </div>
        <div class="form-group">
          <label>Reviewer Name</label>
          <input type="text" id="erName" value="${r.reviewer||''}">
        </div>
        <div class="form-group">
          <label>Rating</label>
          <div style="display:flex;gap:6px;margin-top:8px;">
            ${[1,2,3,4,5].map(n=>`<button type="button" onclick="setErStar(${n})" id="erStar${n}" style="width:44px;height:44px;border-radius:50%;border:2px solid ${n<=curRating?'var(--accent)':'var(--border)'};background:${n<=curRating?'rgba(201,168,76,0.12)':'var(--surface2)'};font-size:20px;cursor:pointer;transition:all 0.15s;color:${n<=curRating?'var(--accent)':''}">${n<=curRating?'‚òÖ':'‚òÜ'}</button>`).join('')}
          </div>
          <input type="hidden" id="erRating" value="${curRating}">
        </div>
        <div class="form-group">
          <label>Review Text</label>
          <textarea id="erComment" rows="4">${r.comment||''}</textarea>
        </div>
        <div style="font-size:12px;color:var(--muted);margin-bottom:14px;padding:8px 12px;background:var(--surface2);border-radius:8px;">
          ${r.type==='vendor'
            ? `üì∏ Professional: <strong style="color:var(--text);">${r.vendorName||vendorId||'‚Äî'}</strong>`
            : `üé≠ Organizer: <strong style="color:var(--text);">${r.orgName||r.orgId||'‚Äî'}</strong>`}
        </div>
        <div style="display:flex;gap:10px;">
          <button class="btn-primary btn-sm" onclick="saveEditReview('${id}','${r.orgId||''}',vendorId)">üíæ Save Changes</button>
          <button class="btn-secondary btn-sm" onclick="closeModalDirect()">Cancel</button>
        </div>
      </div>
    </div>
  </div>`;
}

function setErStar(n) {
  document.getElementById('erRating').value = n;
  for (let i = 1; i <= 5; i++) {
    const b = document.getElementById('erStar' + i);
    if (!b) continue;
    b.textContent    = i <= n ? '‚òÖ' : '‚òÜ';
    b.style.color    = i <= n ? 'var(--accent)' : '';
    b.style.borderColor = i <= n ? 'var(--accent)' : 'var(--border)';
    b.style.background  = i <= n ? 'rgba(201,168,76,0.12)' : 'var(--surface2)';
  }
}

async function saveEditReview(id, orgId, vendorId) {
  try {
    const rating = Number(document.getElementById('erRating').value) || 5;
    const name   = document.getElementById('erName').value.trim();
    const text   = document.getElementById('erComment').value.trim();
    if (!name) { showToast('Name required', 'error'); return; }
    await db.collection('reviews').doc(id).update({ reviewer: name, rating, comment: text, text });
    // Recalculate organizer average
    if (orgId) {
      const allRevs = await db.collection('reviews').where('orgId','==',orgId).get();
      let total = 0, count = 0;
      allRevs.forEach(d => { total += (d.data().rating||0); count++; });
      const avg = count > 0 ? Math.round((total/count)*10)/10 : 0;
      await db.collection('organizers').doc(orgId).update({ rating: avg, reviewCount: count });
    }
    // Recalculate professional/vendor average
    if (vendorId) {
      const allRevs = await db.collection('reviews').where('vendorId','==',vendorId).get();
      let total = 0, count = 0;
      allRevs.forEach(d => { total += (d.data().rating||0); count++; });
      const avg = count > 0 ? Math.round((total/count)*10)/10 : 0;
      await db.collection('vendors').doc(vendorId).update({ rating: avg, reviewCount: count });
    }
    showToast('‚úÖ Review saved!');
    closeModalDirect();
    loadAdminReviews();
  } catch(err) { showToast('Error: ' + err.message, 'error'); }
}

async function adminDeleteReview(id, name, orgId, vendorId) {
  if (!confirm('Delete review by "' + name + '"?')) return;
  await db.collection('reviews').doc(id).delete();
  if (orgId) {
    const allRevs = await db.collection('reviews').where('orgId','==',orgId).get();
    let total = 0, count = 0;
    allRevs.forEach(d => { total += (d.data().rating||0); count++; });
    const avg = count > 0 ? Math.round((total/count)*10)/10 : 0;
    await db.collection('organizers').doc(orgId).update({ rating: avg, reviewCount: count });
  }
  if (vendorId) {
    const allRevs = await db.collection('reviews').where('vendorId','==',vendorId).get();
    let total = 0, count = 0;
    allRevs.forEach(d => { total += (d.data().rating||0); count++; });
    const avg = count > 0 ? Math.round((total/count)*10)/10 : 0;
    await db.collection('vendors').doc(vendorId).update({ rating: avg, reviewCount: count });
  }
}
</script>
</body>
</html>
