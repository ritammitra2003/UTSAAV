<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event Organizer Hub</title>

<style>
body {font-family: Arial, sans-serif; margin:0; background:#f5f5f5;}
header {background:#222; color:#fff; padding:15px; text-align:center;}
.container {padding:20px; text-align:center;}
button {padding:12px 20px; margin:10px; font-size:16px; cursor:pointer;}
form {max-width:400px; margin:auto; text-align:left;}
input {width:100%; padding:8px; margin:6px 0;}
.card {background:#fff; padding:15px; margin:10px auto; max-width:400px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.2);} 
img {max-width:100%; border-radius:10px;}
.hidden {display:none;}
.error{color:red;font-size:14px;margin-top:5px}
.switch{color:blue;cursor:pointer;text-decoration:underline}
</style>
</head>
<body>

<header>
<h2>Event Organizer Hub</h2>
</header>

<!-- AUTH SECTION -->
<div class="container" id="auth">
<h3 id="authTitle">Register First</h3>
<form id="authForm">
<input type="email" id="authEmail" placeholder="Email" required>
<input type="password" id="authPass" placeholder="Password (Use only 6+ characters)" required>
<div class="error" id="errorMsg"></div>
<button type="submit" id="authBtn">Register</button>
</form>
<p class="switch" onclick="toggleAuth()" id="switchText">Already registered? Login</p>
</div>

<!-- HOME -->
<div class="container hidden" id="home">
<h3>Select Option</h3>
<button onclick="showOrganizer()">Organizer Panel</button>
<button onclick="showCustomer()">Customer View</button>
<button onclick="logout()">Logout</button>
</div>

<!-- ORGANIZER PANEL -->
<div class="container hidden" id="organizer">
<h3>Organizer Upload</h3>
<form id="orgForm">
<input type="text" id="name" placeholder="Organizer Name" required>
<input type="tel" id="phone" placeholder="Phone Number" required>
<input type="email" id="email" placeholder="Email" required>
<input type="file" id="photo" accept="image/*" required>
<button type="submit">Upload</button>
</form>
<button onclick="goHome()">Back</button>
</div>

<!-- CUSTOMER VIEW -->
<div class="container hidden" id="customer">
<h3>Organizers List</h3>
<div id="list"></div>
<button onclick="goHome()">Back</button>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>

const firebaseConfig = {
 apiKey: "AIzaSyBNW3y2zR8xQmhrOWqXzu8dmFRMYdSRSFM",
 authDomain: "rd-eventsphere.firebaseapp.com",
 projectId: "rd-eventsphere",
 storageBucket: "rd-eventsphere.firebasestorage.app",
 messagingSenderId: "9010232288",
 appId: "1:9010232288:web:f5e77bb53311acef97c985"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const authDiv = document.getElementById('auth');
const home = document.getElementById('home');
const organizer = document.getElementById('organizer');
const customer = document.getElementById('customer');

let isLogin=false;

function toggleAuth(){
 isLogin=!isLogin;
 document.getElementById('authTitle').innerText=isLogin?"Login":"Register First";
 document.getElementById('authBtn').innerText=isLogin?"Login":"Register";
 document.getElementById('switchText').innerText=isLogin?
 "New user? Register first":"Already registered? Login";
 document.getElementById('errorMsg').innerText="";
}

firebase.auth().onAuthStateChanged(user=>{
 if(user){
  authDiv.classList.add('hidden');
  home.classList.remove('hidden');
 }else{
  authDiv.classList.remove('hidden');
  home.classList.add('hidden');
 }
});

// AUTH FORM

document.getElementById('authForm').addEventListener('submit',async e=>{
 e.preventDefault();
 const email=authEmail.value;
 const pass=authPass.value;
 const error=document.getElementById('errorMsg');

 if(pass.length<6){
  error.innerText="Use minimum 6 characters password";
  return;
 }

 try{
  if(isLogin){
   await auth.signInWithEmailAndPassword(email,pass);
   alert("Login successful");
  }else{
   await auth.createUserWithEmailAndPassword(email,pass);
   alert("Registration successful. Now login.");
   toggleAuth();
  }
 }catch(err){
  error.innerText="Invalid email or password format";
 }
});

function logout(){ auth.signOut(); }

function goHome(){
 home.classList.remove('hidden');
 organizer.classList.add('hidden');
 customer.classList.add('hidden');
}

function showOrganizer(){
 home.classList.add('hidden');
 organizer.classList.remove('hidden');
}

function showCustomer(){
 home.classList.add('hidden');
 customer.classList.remove('hidden');
 loadOrganizers();
}

// ORGANIZER UPLOAD

document.getElementById('orgForm').addEventListener('submit',e=>{
 e.preventDefault();
 const reader=new FileReader();
 reader.onload=async()=>{
  await db.collection('organizers').add({
   name:name.value,
   phone:phone.value,
   email:email.value,
   photo:reader.result,
   owner:auth.currentUser.email
  });
  alert('Uploaded Successfully');
  goHome();
 };
 reader.readAsDataURL(photo.files[0]);
});

// LOAD ORGANIZERS
async function loadOrganizers(){
 list.innerHTML='';
 const snap=await db.collection('organizers').get();
 snap.forEach(doc=>{
  const o=doc.data();
  list.innerHTML+=`
   <div class='card'>
    <img src='${o.photo}'>
    <h4>${o.name}</h4>
    <p>${o.phone}</p>
    <p>${o.email}</p>
   </div>`;
 });
}

</script>

</body>
</html>
